<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Ubuntu 18.04 修复与 Windows 共享文件及打印机</title>
      <link href="/2018/11/08/Ubuntu-18-04-%E4%BF%AE%E5%A4%8D%E4%B8%8E-Windows-%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%8F%8A%E6%89%93%E5%8D%B0%E6%9C%BA/"/>
      <url>/2018/11/08/Ubuntu-18-04-%E4%BF%AE%E5%A4%8D%E4%B8%8E-Windows-%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%8F%8A%E6%89%93%E5%8D%B0%E6%9C%BA/</url>
      <content type="html"><![CDATA[<p>Ubuntu 升级到 18.04 后，在网络共享中看不到同一局域网内 Windows<br>共享的文件，同时 Windows<br>上共享的打印机也不能正常工作，表现为“需要身份认证”，但是输入对应用户名密码之后毫无反应。</p><p>修复方法：<a href="https://www.dedoimedo.com/computers/ubuntu-beaver-samba-shares.html" target="_blank" rel="noopener">https://www.dedoimedo.com/computers/ubuntu-beaver-samba-shares.html</a></p><figure class="hljs highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo vi /etc/samba/smb.conf</span><br><span class="hljs-meta"><br>#</span><span class="bash"> Add a line</span><br>client max protocol = NT1<br><span class="hljs-meta"><br>$</span><span class="bash"> sudo systemctl restart smbd.service</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Cpp Template Meta Programming MergeSort</title>
      <link href="/2018/05/11/Cpp-Template-Meta-Programming-MergeSort/"/>
      <url>/2018/05/11/Cpp-Template-Meta-Programming-MergeSort/</url>
      <content type="html"><![CDATA[<p>C++ 模板元编程之编译时归并排序，源自水木社区 ilovecpp</p><p>Cpp Template Meta Programming MergeSort</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/vector.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/vector_c.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/eval_if.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/identity.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/empty.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/less.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/front.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/pop_front.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/push_front.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/size.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/iterator_range.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/int.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/mpl/for_each.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> boost::mpl;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> V1, <span class="hljs-keyword">typename</span> V2&gt;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Merge</span> &#123;</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T1, <span class="hljs-keyword">typename</span> T2&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">F</span> &#123;</span><br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> push_front&lt;<br>            <span class="hljs-keyword">typename</span> Merge&lt;<span class="hljs-keyword">typename</span> pop_front&lt;T1&gt;::type, T2&gt;::type,<br>            <span class="hljs-keyword">typename</span> front&lt;T1&gt;::type<br>            &gt;::type type;<br>    &#125;;<br>        <br>    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> eval_if&lt;<br>        empty&lt;V1&gt;,<br>        identity&lt;V2&gt;,<br>        eval_if&lt;<br>            empty&lt;V2&gt;,<br>            identity&lt;V1&gt;,<br>            eval_if&lt;<br>                less&lt;<span class="hljs-keyword">typename</span> front&lt;V1&gt;::type, <span class="hljs-keyword">typename</span> front&lt;V2&gt;::type&gt;,<br>                F&lt;V1, V2&gt;,<br>                F&lt;V2, V1&gt;<br>                &gt;<br>            &gt;<br>        &gt;::type type;<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> V&gt;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MergeSort</span> &#123;</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">F</span> &#123;</span><br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> begin&lt;T&gt;::type t0;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> advance&lt;t0, int_&lt;size&lt;T&gt;::value/<span class="hljs-number">2</span>&gt;&gt;::type t1;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> end&lt;T&gt;::type t2;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> Merge&lt;<br>            <span class="hljs-keyword">typename</span> MergeSort&lt;iterator_range&lt;t0, t1&gt;&gt;::type,<br>            <span class="hljs-keyword">typename</span> MergeSort&lt;iterator_range&lt;t1, t2&gt;&gt;::type<br>            &gt;::type type;<br>    &#125;;<br>    <br>    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> eval_if&lt;<br>        empty&lt;V&gt;,<br>        identity&lt;<span class="hljs-built_in">vector</span>&lt;&gt;&gt;,<br>        eval_if&lt;<br>            less&lt;size&lt;V&gt;, int_&lt;<span class="hljs-number">2</span>&gt;&gt;,<br>            identity&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">typename</span> front&lt;V&gt;::type&gt;&gt;,<br>            F&lt;V&gt;<br>            &gt;<br>        &gt;::type type;<br>&#125;;<br><br><span class="hljs-keyword">typedef</span> vector_c&lt;<span class="hljs-keyword">int</span>, <span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>&gt; t1;<br><span class="hljs-keyword">typedef</span> MergeSort&lt;t1&gt;::type t10;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">print</span> &#123;</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">( T t )</span> <span class="hljs-keyword">const</span> </span>&#123;<br>       <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; T::value &lt;&lt; <span class="hljs-string">" "</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    for_each&lt;t10&gt;(print());<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><a id="more"></a><p>顺便说一下怎么读这类代码。困难主要来自不熟悉编译时的这套完全不同的语法，而概念和运行其实没多大差别。</p><ul><li><p>所有的typename关键字都是C++的语法限制，没有意义，先删掉。</p></li><li><p>形如</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T1, <span class="hljs-keyword">typename</span> T2&gt;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">F</span> &#123;</span><br>    <span class="hljs-keyword">typedef</span> ... type;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><p>的是编译时函数，相当于运行时的<br><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">F(T1, T2) &#123;<br>    <span class="hljs-keyword">return</span> ...;<br>&#125;<br></code></pre></td></tr></table></figure></p><ul><li>形如<code>F&lt;T1, T2&gt;::type</code> 的是编译时的函数调用，相当于运行时的 <code>F(T1, T2)</code></li></ul><p>如果没有<code>::type</code>，形如<code>F&lt;T1, T2&gt;</code>则是lazy的函数，相当于运行时的 function object，例如<code>bind(F, T1, T2)</code>。</p><ul><li><p><code>eval_if&lt;C, T1, T2&gt;</code>相当于运行时的if，根据C的真值决定对T1或T2 lazy求值。由于C++对模板实参是eager求值的，我们递归的话就不能用<code>T1::type</code>这种函数调用的形式，而只能把T1传进去让eval_if做lazy求值，否则会无穷递归。</p></li><li><p><code>typedef foo bar</code>相当于运行时的<code>bar=foo</code></p></li><li><p>类型相当于运行时的值。所以像2这样的常数需要用<code>int_&lt;2&gt;</code>包装成类型。</p></li></ul><p>好，我按照上述几条规则翻译一下代码：</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Merge(V1, V2) &#123;<br>    F(T1, T2) &#123;<br>        <span class="hljs-keyword">return</span> push_front(Merge(pop_front(T1), T2), front(T1));<br>    &#125;;<br><br>    <span class="hljs-keyword">if</span> (empty(V1))<br>        <span class="hljs-keyword">return</span> V2;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (empty(V2))<br>        <span class="hljs-keyword">return</span> V1;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (front(V1)&lt;front(V2))<br>        <span class="hljs-keyword">return</span> F(V1, V2);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> F(V2, V1);<br>&#125;<br><br>MergeSort(V) &#123;<br>    F(T) &#123;<br>        t0 = begin(T);<br>        t1 = advance(t0, size(T)/<span class="hljs-number">2</span>);<br>        t2 = end(T);<br>        <span class="hljs-keyword">return</span> Merge(MergeSort(iterator_range(t0, t1)),<br>                     MergeSort(iterator_range(t1, t2)));<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (empty(V))<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">vector</span>();<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (size(V)&lt;<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">vector</span>(front(V));<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> F&lt;V&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>VSCode cquery(lsp) 实现 C/C++ 补全</title>
      <link href="/2018/05/04/VSCode-cquery-lsp-%E5%AE%9E%E7%8E%B0-C-C-%E8%A1%A5%E5%85%A8/"/>
      <url>/2018/05/04/VSCode-cquery-lsp-%E5%AE%9E%E7%8E%B0-C-C-%E8%A1%A5%E5%85%A8/</url>
      <content type="html"><![CDATA[<p><a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">LSP</a>（Language-Server-Protocol）开源的语言服务器协定，微软出品，语言服务端提供索引代码的服务，编辑器直接调用。套用官话就是，可以让不同的程序编辑器与集成开发环境（IDE）方便嵌入各种程序语言，允许开发人员在最喜爱的工具中使用各种语言来撰写程序。</p><p>目前语言与编辑器支持情况见 <a href="https://langserver.org/" target="_blank" rel="noopener">https://langserver.org/</a></p><p><a href="https://github.com/cquery-project/cquery" target="_blank" rel="noopener">cquery</a> 就是 C/C++/Objective-C 的 language server，VSCode, Vim, Emacs 等只要安装了 lsp 插件，就可调用它来实现 C/C++/Objective-C 语法补全等功能。</p><p>下面以 Visual Studio Code 为例来实现 C/C++ 补全。<a id="more"></a></p><h2 id="build-cquery"><a href="#build-cquery" class="headerlink" title="build cquery"></a>build cquery</h2><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/cquery-project/cquery --single-branch --depth=1<br><span class="hljs-built_in">cd</span> cquery<br>git submodule update --init &amp;&amp; ./waf configure build<br></code></pre></td></tr></table></figure><h2 id="VSCode-配置"><a href="#VSCode-配置" class="headerlink" title="VSCode 配置"></a>VSCode 配置</h2><p>首先在插件商店安装 cquery 插件，用户配置中加入以下配置：</p><figure class="hljs highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"cquery.launch.workingDirectory"</span>: <span class="hljs-string">"/YOUR_PATH_TO/cquery/build"</span>,<br>    <span class="hljs-attr">"cquery.launch.command"</span>: <span class="hljs-string">"release/bin/cquery"</span>,<br>    <span class="hljs-attr">"cquery.cacheDirectory"</span>: <span class="hljs-string">"/tmp/vscode-cquery"</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="项目编译选项配置"><a href="#项目编译选项配置" class="headerlink" title="项目编译选项配置"></a>项目编译选项配置</h2><p>推荐 <a href="https://github.com/cquery-project/cquery/wiki/compile_commands.json" target="_blank" rel="noopener">compile_commands.json</a></p><p>例如，如果使用 CMake，用以下命令生成 <code>compile_commands.json</code> 文件。</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">CMake<br>mkdir build<br>(<span class="hljs-built_in">cd</span> build; cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=YES ..)<br>ln -s build/compile_commands.json<br></code></pre></td></tr></table></figure><p>或者新建一个 <code>.cquery</code> 文件，内容示例：</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs undefined">%clang<br>%c -std=gnu11<br>%cpp -std=gnu++14<br>-pthread<br><br># Includes<br>-I/work/cquery/third_party<br>-I/work/cquery/another_third_party<br># -I space_is_not_allowed<br></code></pre></td></tr></table></figure><p>最终效果</p><p><img src="/img/vscode_cquery.png" alt="vscode-cquery"></p><p>参考：<a href="http://maskray.me/blog/2017-12-03-c++-language-server-cquery" target="_blank" rel="noopener">http://maskray.me/blog/2017-12-03-c++-language-server-cquery</a></p>]]></content>
      
      
        <tags>
            
            <tag> lsp </tag>
            
            <tag> editor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ubuntu awesome terminal</title>
      <link href="/2018/04/28/ubuntu-awesome-terminal/"/>
      <url>/2018/04/28/ubuntu-awesome-terminal/</url>
      <content type="html"><![CDATA[<h2 id="gnome-terminal-theme"><a href="#gnome-terminal-theme" class="headerlink" title="gnome-terminal theme"></a>gnome-terminal theme</h2><p><a href="https://github.com/aaron-williamson/base16-gnome-terminal" target="_blank" rel="noopener">base16 gnome terminal</a></p><p>选择一个，运行相应的 <code>.sh</code><br><a id="more"></a></p><p>下面是 Old Way，不再推荐</p><p><a href="https://github.com/Anthony25/gnome-terminal-colors-solarized" target="_blank" rel="noopener">Solarized Colorscheme for Gnome Terminal</a></p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/Anthony25/gnome-terminal-colors-solarized.git<br><span class="hljs-built_in">cd</span> gnome-terminal-colors-solarized<br>./install.sh<br></code></pre></td></tr></table></figure><p>按提示选择 <code>dark</code> 或 <code>light</code> 主题。为了使 <code>ls</code> 命令显示色彩与之相配，中间会提示是否下载 <code>dircolors</code>（由于伟大的墙的问题，有可能下载不成功），手动安装方式如下：</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget --no-check-certificate https://raw.github.com/seebi/dircolors-solarized/master/dircolors.ansi-dark<br>mv dircolors.ansi-dark .dircolors<br><span class="hljs-built_in">eval</span> `dircolors ~/.dircolors`<br><br><span class="hljs-comment"># or light</span><br>wget --no-check-certificate https://raw.github.com/seebi/dircolors-solarized/master/dircolors.ansi-light<br>mv dircolors.ansi-light .dircolors<br><span class="hljs-built_in">eval</span> `dircolors ~/.dircolors`<br></code></pre></td></tr></table></figure><h2 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h2><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install zsh<br>chsh -s /usr/bin/zsh<br></code></pre></td></tr></table></figure><h2 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h2><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sh -c <span class="hljs-string">"<span class="hljs-variable">$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>"</span><br></code></pre></td></tr></table></figure><h2 id="omz-powerlevel9k-theme"><a href="#omz-powerlevel9k-theme" class="headerlink" title="omz powerlevel9k theme"></a>omz powerlevel9k theme</h2><p>安装</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k<br></code></pre></td></tr></table></figure><p>配置 ~/.zshrc</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">ZSH_THEME=<span class="hljs-string">"powerlevel9k/powerlevel9k"</span><br><br>POWERLEVEL9K_MODE=<span class="hljs-string">'awesome-fontconfig'</span><br>POWERLEVEL9K_SHORTEN_DIR_LENGTH=2<br>POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(os_icon dir vcs)<br>POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=()<br><br>POWERLEVEL9K_VIRTUALENV_BACKGROUND=107<br>POWERLEVEL9K_VIRTUALENV_FOREGROUND=<span class="hljs-string">'white'</span><br>POWERLEVEL9K_CUSTOM_NOW_PLAYING_BACKGROUND=<span class="hljs-string">'blue'</span><br>POWERLEVEL9K_CUSTOM_NOW_PLAYING_FOREGROUND=<span class="hljs-string">'black'</span><br>POWERLEVEL9K_OS_ICON_BACKGROUND=<span class="hljs-string">'white'</span><br>POWERLEVEL9K_OS_ICON_FOREGROUND=<span class="hljs-string">'black'</span><br>POWERLEVEL9K_TIME_BACKGROUND=<span class="hljs-string">'white'</span><br>POWERLEVEL9K_TIME_FOREGROUND=<span class="hljs-string">'black'</span><br></code></pre></td></tr></table></figure><h2 id="powerline-与-awesome-字体"><a href="#powerline-与-awesome-字体" class="headerlink" title="powerline 与 awesome 字体"></a>powerline 与 awesome 字体</h2><p>显示 git 分支等一些特殊 awesome glyph 字符</p><p>直接使用 <a href="https://nerdfonts.com/" target="_blank" rel="noopener">nerdfonts</a>，在 <code>gnome-terminal -&gt; Edit -&gt; Preferences</code> 里选 <code>Custom font</code>，设置想要的字体</p><p>下面是 Old Way，不再推荐</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install fonts-powerline<br></code></pre></td></tr></table></figure><p>如果有问题的话，手动安装打好补丁的字体 <a href="https://github.com/powerline/fonts" target="_blank" rel="noopener">powerline font</a> </p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/powerline/fonts.git --depth=1<br><span class="hljs-built_in">cd</span> fonts<br>./install.sh<br></code></pre></td></tr></table></figure><p>然后在 <code>gnome-terminal -&gt; Edit -&gt; Preferences</code> 里选 <code>Custom font</code>，设置想要的字体，我这里选择 <code>Source Code Pro for Powerline Medium</code></p><p>为了配合上面的 powerlevel9k 显示出一些更 awesome 的字符，需要 <a href="https://github.com/gabrielelana/awesome-terminal-fonts" target="_blank" rel="noopener">awesome-terminal-fonts</a></p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/gabrielelana/awesome-terminal-fonts.git --depth=1<br><span class="hljs-built_in">cd</span> awesome-terminal-fonts<br>cp build/* ~/.<span class="hljs-built_in">local</span>/share/fonts/<br><span class="hljs-built_in">fc</span>-cache -fv<br>cp config/10-symbols.conf ~/.config/fontconfig/conf.d/<br></code></pre></td></tr></table></figure><p>修改 <code>.zshrc</code> 添加一行 <code>source $HOME/.local/share/fonts/*.sh</code></p><p>修改 <code>~/.config/fontconfig/conf.d/10-symbols.conf</code></p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">fontconfig</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">alias</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Source Code Pro for Powerline<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">prefer</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Pomodoro<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>FontAwesome<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Octicons<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Icomoon<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">prefer</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">alias</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">fontconfig</span>&gt;</span><br></code></pre></td></tr></table></figure><p>最终效果</p><p><img src="/img/awesome-terminal.png" alt="awesome-terminal"></p>]]></content>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PyCharm 使用 Windows 10 WSL Ubuntu 子系统中的 Python</title>
      <link href="/2016/08/18/PyCharm-%E4%BD%BF%E7%94%A8-Windows-10-WSL-Ubuntu-%E5%AD%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84-Python/"/>
      <url>/2016/08/18/PyCharm-%E4%BD%BF%E7%94%A8-Windows-10-WSL-Ubuntu-%E5%AD%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84-Python/</url>
      <content type="html"><![CDATA[<p>首先升级 Windows 10 Anniversary 周年纪念版，又称 RedStone1。如果没有收到推送，可以到这个网址 <a href="https://support.microsoft.com/en-us/help/12387/windows-10-update-history" target="_blank" rel="noopener">https://support.microsoft.com/en-us/help/12387/windows-10-update-history</a> 手动升级。</p><h2 id="Step-0-安装-WSL-Ubuntu"><a href="#Step-0-安装-WSL-Ubuntu" class="headerlink" title="Step 0: 安装 WSL Ubuntu"></a>Step 0: 安装 WSL Ubuntu</h2><p>在设置中开启开发人员模式，添加 Windows Subsystem for Linux (Beta)，嗯，目前还是 Beta。</p><p>Win + X 打开 CMD 管理员，输入 <code>bash</code> 或者 <code>lxrun /install</code>,会有提示是否安装 Ubuntu，完成之后会提示输入用户名和密码。<a id="more"></a></p><h2 id="Step-1-修改-etc-ssh-sshd-config"><a href="#Step-1-修改-etc-ssh-sshd-config" class="headerlink" title="Step 1: 修改 /etc/ssh/sshd_config"></a>Step 1: 修改 <code>/etc/ssh/sshd_config</code></h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">PasswordAuthentication yes<br>UsePrivilegeSeparation no<br></code></pre></td></tr></table></figure><h2 id="Step-2-生成密钥"><a href="#Step-2-生成密钥" class="headerlink" title="Step 2: 生成密钥"></a>Step 2: 生成密钥</h2><p>执行 <code>sudo dpkg-reconfigure openssh-server</code></p><h2 id="Step-3-sshd-无密码运行"><a href="#Step-3-sshd-无密码运行" class="headerlink" title="Step 3: sshd 无密码运行"></a>Step 3: sshd 无密码运行</h2><p>执行 <code>sudo visudo</code></p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined"># $USER 是你 Step0 中设置的用户名<br>$USER ALL = (root) NOPASSWD: /usr/sbin/sshd<br></code></pre></td></tr></table></figure><h2 id="Step-4-开启-ssh"><a href="#Step-4-开启-ssh" class="headerlink" title="Step 4: 开启 ssh"></a>Step 4: 开启 ssh</h2><p>执行 <code>sudo /usr/sbin/sshd -d</code>，确认无误后 <code>sudo /usr/sbin/sshd</code></p><p>可以写成一个脚本 wsl_ssh.bat <code>bash.exe -c &quot;sudo service ssh start &amp;&amp;&amp; sleep 999d&quot;</code></p><h2 id="Step-5-配置-PyCharm"><a href="#Step-5-配置-PyCharm" class="headerlink" title="Step 5: 配置 PyCharm"></a>Step 5: 配置 PyCharm</h2><p><a href="https://www.jetbrains.com/help/pycharm/2016.1/configuring-remote-interpreters-via-ssh.html" target="_blank" rel="noopener">https://www.jetbrains.com/help/pycharm/2016.1/configuring-remote-interpreters-via-ssh.html</a></p><h2 id="Step-X-完善"><a href="#Step-X-完善" class="headerlink" title="Step X: 完善"></a>Step X: 完善</h2><p>cmd 替代品 <a href="http://conemu.github.io/" target="_blank" rel="noopener">ConEmu</a>，最新版内置支持 wsl bash。</p><p>也可以用 XShell ssh 上去。</p><p>apt 源替换为 aliyun, <code>sudo sed -i &#39;s/archive.ubuntu/mirrors.aliyun/g&#39; /etc/apt/sources.list</code></p><p>安装新版 git, <code>sudo add-apt-repository ppa:git-core/ppa</code></p><p>安装新版 pip， <code>curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;</code>, <code>sudo python get-pip.py</code></p><p><img src="/img/pycharm02.png" alt="pycharm"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Django之路: Python Decouple</title>
      <link href="/2016/08/05/Django%E4%B9%8B%E8%B7%AF-Python-Decouple/"/>
      <url>/2016/08/05/Django%E4%B9%8B%E8%B7%AF-Python-Decouple/</url>
      <content type="html"><![CDATA[<p>Django settings 中存有很多私密信息，如 database url, password, secret key, allowed hosts 等，我们还可能有 Debug / Deploy 两套不同的运行环境，<a href="https://pypi.python.org/pypi/python-decouple" target="_blank" rel="noopener">python-decouple</a> 可以让这些环境变量与代码分离。<a id="more"></a></p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>例如 <code>settings.py</code> 内容如下</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))<br>SECRET_KEY = <span class="hljs-string">'3izb^ryglj(bvrjb2_y1fZvcnbky#358_l6-nn#i8fkug4mmz!'</span><br>DEBUG = <span class="hljs-keyword">True</span><br>DATABASES = &#123;<br>    <span class="hljs-string">'default'</span>: &#123;<br>        <span class="hljs-string">'ENGINE'</span>: <span class="hljs-string">'django.db.backends.postgresql_psycopg2'</span>,<br>        <span class="hljs-string">'NAME'</span>: <span class="hljs-string">'HELLO_DJANGO'</span>,<br>        <span class="hljs-string">'USER'</span>: <span class="hljs-string">'U_HELLO'</span>,<br>        <span class="hljs-string">'PASSWORD'</span>: <span class="hljs-string">'hA8(scA@!fg3*sc&amp;xaGh&amp;6%-l&lt;._&amp;xCf'</span>,<br>        <span class="hljs-string">'HOST'</span>: <span class="hljs-string">'127.0.0.1'</span>,<br>        <span class="hljs-string">'PORT'</span>: <span class="hljs-string">''</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在项目根目录下创建一个 <code>.env</code> 文件，内容如下</p><figure class="hljs highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">SECRET_KEY</span>=<span class="hljs-number">3</span>izb^ryglj(bvrjb2_y1fZvcnbky#<span class="hljs-number">358</span>_l6-nn#i8fkug4mmz!<br><span class="hljs-attr">DEBUG</span>=<span class="hljs-literal">True</span><br><span class="hljs-attr">DB_NAME</span>=HELLO_DJANGO<br><span class="hljs-attr">DB_USER</span>=U_HELLO<br><span class="hljs-attr">DB_PASSWORD</span>=hA8(scA@!fg3*sc&amp;xaGh&amp;<span class="hljs-number">6</span>%-l&lt;._&amp;xCf<br><span class="hljs-attr">DB_HOST</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br></code></pre></td></tr></table></figure><p>将 <code>.env</code> 加入到 <code>.gitignore</code>，修改 <code>settings.py</code></p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> decouple <span class="hljs-keyword">import</span> config<br><br>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))<br>SECRET_KEY = config(<span class="hljs-string">'SECRET_KEY'</span>)<br>DEBUG = config(<span class="hljs-string">'DEBUG'</span>, cast=bool)<br>DATABASES = &#123;<br>    <span class="hljs-string">'default'</span>: &#123;<br>        <span class="hljs-string">'ENGINE'</span>: <span class="hljs-string">'django.db.backends.postgresql_psycopg2'</span>,<br>        <span class="hljs-string">'NAME'</span>: config(<span class="hljs-string">'DB_NAME'</span>),<br>        <span class="hljs-string">'USER'</span>: config(<span class="hljs-string">'DB_USER'</span>),<br>        <span class="hljs-string">'PASSWORD'</span>: config(<span class="hljs-string">'DB_PASSWORD'</span>),<br>        <span class="hljs-string">'HOST'</span>: config(<span class="hljs-string">'DB_HOST'</span>),<br>        <span class="hljs-string">'PORT'</span>: <span class="hljs-string">''</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p><code>.env</code> 内容</p><figure class="hljs highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">DEBUG</span>=<span class="hljs-literal">True</span><br><span class="hljs-attr">EMAIL_PORT</span>=<span class="hljs-number">25</span><br><span class="hljs-attr">ALLOWED_HOSTS</span>=.localhost, .herokuapp.com<br></code></pre></td></tr></table></figure><p><code>settings.py</code> 内容</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> decouple <span class="hljs-keyword">import</span> config, Csv<br><br>DEBUG = config(<span class="hljs-string">'DEBUG'</span>, default=<span class="hljs-keyword">True</span>, cast=bool)<br>EMAIL_PORT = config(<span class="hljs-string">'EMAIL_PORT'</span>, cast=int)<br>ALLOWED_HOSTS = config(<span class="hljs-string">'ALLOWED_HOSTS'</span>, cast=Csv())<br></code></pre></td></tr></table></figure><p>也可用外部环境变量</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DEBUG=False python manage.py<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux驱动开发之一 Hello World</title>
      <link href="/2015/07/19/Linux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E4%B9%8B%E4%B8%80-Hello-World/"/>
      <url>/2015/07/19/Linux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E4%B9%8B%E4%B8%80-Hello-World/</url>
      <content type="html"><![CDATA[<p>完整的 Hello World 内核模块 hello.c</p><figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/module.h&gt;</span></span><br>MODULE_LICENSE(<span class="hljs-string">"Dual BSD/GPL"</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hello_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span><br></span>&#123;<br>    printk(KERN_ALERT <span class="hljs-string">"Hello, world\n"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello_exit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span><br></span>&#123;<br>    printk(KERN_ALERT <span class="hljs-string">"Goodbye, cruel world\n"</span>);<br>&#125;<br><br>module_init(hello_init);<br>module_exit(hello_exit);<br></code></pre></td></tr></table></figure><p>Makefile</p><figure class="hljs highlight Makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Makefile">obj-m +=hello.o<br><br>KDIR = /usr/src/linux-headers-3.19.0-21-generic<br><br><span class="hljs-section">all:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KDIR)</span> SUBDIRS=<span class="hljs-variable">$(PWD)</span> modules<br><br><span class="hljs-section">clean:</span><br>rm -rf *.o *.ko *.mod.* *.symvers *.order<br></code></pre></td></tr></table></figure><p>To run the code</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$sudo</span> insmod hello.ko<br><span class="hljs-variable">$dmesg</span><br>u will get the output<br><span class="hljs-variable">$sudo</span> rmmod hello.ko<br><span class="hljs-variable">$dmesg</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> LinuxDriver </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux/Ubuntu 下为 Android 创建无线分享热点</title>
      <link href="/2015/06/24/Linux-Ubuntu-%E4%B8%8B%E4%B8%BA-Android-%E5%88%9B%E5%BB%BA%E6%97%A0%E7%BA%BF%E5%88%86%E4%BA%AB%E7%83%AD%E7%82%B9/"/>
      <url>/2015/06/24/Linux-Ubuntu-%E4%B8%8B%E4%B8%BA-Android-%E5%88%9B%E5%BB%BA%E6%97%A0%E7%BA%BF%E5%88%86%E4%BA%AB%E7%83%AD%E7%82%B9/</url>
      <content type="html"><![CDATA[<p>create ap hotspot for ubuntu linux</p><p>准备</p><p><a href="https://w1.fi/hostapd/" target="_blank" rel="noopener">https://w1.fi/hostapd/</a></p><p><a href="https://github.com/oblique/create_ap" target="_blank" rel="noopener">https://github.com/oblique/create_ap</a></p><p>编译 hostapd</p><pre><code>sudo apt-get install libnl-3-dev libnl-gen-3-devmake &amp;&amp; sudo make install</code></pre><p>安装 create_ap</p><pre><code>git clone https://github.com/oblique/create_ap.gitcd create_ap &amp;&amp; make install</code></pre><p>创建无线热点</p><pre><code>sudo create_ap wlan0 ppp0 hotspot password</code></pre>]]></content>
      
      
        <tags>
            
            <tag> android </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记10 AJAX 图片上传</title>
      <link href="/2014/09/04/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-AJAX-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/"/>
      <url>/2014/09/04/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-AJAX-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/</url>
      <content type="html"><![CDATA[<p>Spring MVC AJAX 方式图片上传，采用 base64 编码图片。</p><p>pom.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-codec<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-codec<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></p><a id="more"></a><p>注：如果使用了 Spring security，其中也有 Base64 类，可以不需要 commons-codec</p><p>applicationContext.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.html<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.htm<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.json<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">"/resources/**"</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"/resources/"</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.mooc"</span> /&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewResolver"</span><br>  <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewClass"</span><br>    <span class="hljs-attr">value</span>=<span class="hljs-string">"org.springframework.web.servlet.view.JstlView"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prefix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/views/"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"suffix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">".jsp"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"order"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"multipartResolver"</span><br>  <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxUploadSize"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"500000"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>UploadController.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"upload"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UploadController</span> </span>&#123;<br><br>  <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET)<br>  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">showUpload</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"ajaxupload"</span>;<br>  &#125;<br><br>  <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.POST, produces = MediaType.APPLICATION_JSON_VALUE)<br>  <span class="hljs-meta">@ResponseBody</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> JsonLogo <span class="hljs-title">doUpload</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"logo"</span>)</span> MultipartFile logo,<br>      MultipartHttpServletRequest request) </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      JsonLogo jsonLogo = <span class="hljs-keyword">new</span> JsonLogo();<br><br>      <span class="hljs-keyword">if</span> (!logo.isEmpty()) &#123;<br>        jsonLogo.setImage(<span class="hljs-keyword">new</span> String(Base64.encodeBase64(logo<br>            .getBytes())));<br><br>        String logoPathDir = <span class="hljs-string">"/upload"</span>;<br>        String logoRealPathDir = request.getSession()<br>            .getServletContext().getRealPath(logoPathDir);<br>        File logoSaveFile = <span class="hljs-keyword">new</span> File(logoRealPathDir);<br>        <span class="hljs-keyword">if</span> (!logoSaveFile.exists())<br>          logoSaveFile.mkdirs();<br><br>        String suffix = logo.getOriginalFilename().substring(<br>            logo.getOriginalFilename().lastIndexOf(<span class="hljs-string">"."</span>));<br>        String logoImageName = String.valueOf(System<br>            .currentTimeMillis()) + suffix;<br>        String fileName = logoRealPathDir + File.separator<br>            + logoImageName;<br>        File file = <span class="hljs-keyword">new</span> File(fileName);<br>        logo.transferTo(file);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> jsonLogo;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>      e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>JsonLogo.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JsonLogo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1165407268915529059L</span>;<br>  <br>  <span class="hljs-meta">@JsonProperty</span><br>  <span class="hljs-keyword">private</span> String image;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getImage</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> image;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setImage</span><span class="hljs-params">(String image)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.image = image;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ajaxupload.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html; charset=UTF-8"</span><br>    <span class="hljs-attr">pageEncoding</span>=<span class="hljs-string">"UTF-8"</span>%&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">UTF-8</span>"&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/resources/js/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Ajax Upload<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"uploadLogoForm"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Logo:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"imagePlaceHolder"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"logo"</span>&gt;</span>Choose your logo:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logo"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"logo"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>   <br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"uploadLogoButton"</span>&gt;</span>Upload Logo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml"><br>  $(document).ready(function()&#123;<br>    $('#uploadLogoButton').on('click', function () &#123;<br>      var form = new FormData(document.getElementById('uploadLogoForm'));<br>      $.ajax(&#123;<br>        url: "upload.json",<br>        data: form,<br>        dataType: 'text',<br>        processData: false,<br>        contentType: false,<br>        type: 'POST',<br>        <br>        success: function (response) &#123;<br>          var data = jQuery.parseJSON(response);   <br>          $('#imagePlaceHolder').html('<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/jpg;base64,' + data.image + '"</span>/&gt;</span>');   <br>        &#125;,<br>        error: function (jqXHR) &#123;<br>          //Error handling<br>        &#125;<br>      &#125;);<br>    &#125;);    <br>  &#125;);<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记9 JQuery 验证</title>
      <link href="/2014/09/01/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-JQuery-%E9%AA%8C%E8%AF%81/"/>
      <url>/2014/09/01/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-JQuery-%E9%AA%8C%E8%AF%81/</url>
      <content type="html"><![CDATA[<p>前面我们已经学习过了在服务器端进行验证，这次学习 JQuery Validator 客户端验证。客户端验证虽然可以被用户绕过，但是可以作为辅助手段，对于一般用户可以减少一定的服务器通讯。</p><p>以注册页面为例，实现一般化的验证，并且加上二次输入密码、用户名字段唯一性验证。<a id="more"></a></p><p>首先添加 jquery.min.js, jquery.validate.js。</p><p>register.jsp，jquery, bootstrap 在之前的 sitemesh 基础模板内。<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sf"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags/form"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"spring"</span>%&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">sf:form</span> <span class="hljs-attr">commandName</span>=<span class="hljs-string">"user"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"form-horizontal registrationForm"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">c:if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"$&#123;param.success eq true &#125;"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success"</span>&gt;</span>Registration successful!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">c:if</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"userName"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2 control-label"</span>&gt;</span>Name:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-10"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"userName"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userName"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"form-control"</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"userName"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2 control-label"</span>&gt;</span>Nickname:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-10"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"form-control"</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"fullname"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2 control-label"</span>&gt;</span>Email:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-10"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"form-control"</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2 control-label"</span>&gt;</span>Password:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-10"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"form-control"</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2 control-label"</span>&gt;</span>Password again:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-10"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password_again"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"password_again"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-2"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-lg btn-primay"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">sf:form</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml"><br>    $(document).ready(function()&#123;<br>        $('ul.navbar-nav li').removeClass("active");<br>        $('ul.navbar-nav li:nth-child(4)').addClass("active");<br>        $(".registrationForm").validate(<br>            &#123;<br>                rules: &#123;<br>                    userName: &#123;<br>                        required : true,<br>                        minlength : 3,<br>                        remote : &#123;<br>                            url: "<span class="hljs-tag">&lt;<span class="hljs-name">spring:url</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'/register/available'</span> /&gt;</span>",<br>                            type: "get",<br>                            data: &#123;<br>                                username: function() &#123;<br>                                    return $("#userName").val();<br>                                &#125;<br>                            &#125;<br>                        &#125;<br>                    &#125;,<br>                    email: &#123;<br>                        required : true,<br>                        email : email<br>                    &#125;,<br>                    password: &#123;<br>                        required : true,<br>                        minlength : 5<br>                    &#125;,<br>                    password_again: &#123;<br>                        required : true,<br>                        minlength : 5,<br>                        equalTo: '#password'<br>                    &#125;<br>                &#125;,<br>                highlight: function(element) &#123;<br>                    $(element).closest('.form-group').removeClass('has-success').addClass('has-error');<br>                &#125;,<br>                unhighlight: function(element) &#123;<br>                    $(element).closest('.form-group').removeClass('has-error').addClass('has-success');<br>                &#125;,<br>                messages: &#123;<br>                    userName: &#123;<br>                        remote: "Such username already exists!"<br>                    &#125;<br>                &#125;<br>            &#125;<br>        );<br>    &#125;);<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>重点在 remote</p><p>UniqueUsername 注解类<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target</span>(&#123; FIELD&#125;)<br><span class="hljs-meta">@Retention</span>(RUNTIME)<br><span class="hljs-meta">@Constraint</span>(validatedBy = &#123;UniqueUsernameValidator.class &#125;)<br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> UniqueUsername &#123;<br>    <span class="hljs-function">String <span class="hljs-title">message</span><span class="hljs-params">()</span></span>;<br><br>    Class&lt;?&gt;[] groups() <span class="hljs-keyword">default</span> &#123; &#125;;<br><br>    Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword">default</span> &#123; &#125;;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UniqueUsernameValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ConstraintValidator</span>&lt;<span class="hljs-title">UniqueUsername</span>, <span class="hljs-title">String</span>&gt; </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibUserService hibUserService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(UniqueUsername constraintAnnotation)</span> </span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isValid</span><span class="hljs-params">(String username, ConstraintValidatorContext context)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (hibUserService == <span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">return</span> hibUserService.findUserByName(username) == <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>User 类 userName 字段加上注解。</p><p>RegisterController.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"register"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibUserService hibUserService;<br><br>    <span class="hljs-meta">@ModelAttribute</span>(<span class="hljs-string">"user"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">constructUser</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User();<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">showRegister</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"register"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(method= RequestMethod.POST)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">register</span><span class="hljs-params">(@ModelAttribute(<span class="hljs-string">"user"</span>)</span> @Valid User user,<br>                           BindingResult result,<br>                           HttpServletRequest request) </span>&#123;<br><br>        <span class="hljs-keyword">if</span> (result.hasErrors()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">"register"</span>;<br>        &#125;<br><br>        user.setLastIp(request.getRemoteAddr());<br>        user.setLastVisit(<span class="hljs-keyword">new</span> Date());<br>        hibUserService.save(user);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:register?success=true"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/available"</span>)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">available</span><span class="hljs-params">(@RequestParam String username)</span> </span>&#123;<br>        Boolean available = (hibUserService.findUserByName(username) == <span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">return</span> available.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记8 Spring Security</title>
      <link href="/2014/08/31/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-Spring-Security/"/>
      <url>/2014/08/31/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-Spring-Security/</url>
      <content type="html"><![CDATA[<p>Spring Security 是为基于 Spring 的应用程序提供声明式安全保护的安全性框架，基于 Spring AOP 和 Servlet 过滤器实现，能够在 Web 请求级别和方法调用级别处理身份验证和授权。它使用 Servlet 过滤器保护 Web 请求和限制 URL 级别的访问，也可以使用 Spring AOP 保护方法调用——借助于对象代理和使用通知，能够确保只有具备适当权限的用户才能访问安全保护的方法。<a id="more"></a></p><p>web.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>security.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">beans:beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/security"</span><br>             <span class="hljs-attr">xmlns:beans</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>             <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>             <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans<br>           http://www.springframework.org/schema/beans/spring-beans.xsd<br>           http://www.springframework.org/schema/security<br>           http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">global-method-security</span> <span class="hljs-attr">pre-post-annotations</span>=<span class="hljs-string">"enabled"</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">http</span> <span class="hljs-attr">auto-config</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">use-expressions</span>=<span class="hljs-string">"true"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intercept-url</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">"/u**"</span> <span class="hljs-attr">access</span>=<span class="hljs-string">"hasRole('ROLE_USER')"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intercept-url</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">"/u/**"</span> <span class="hljs-attr">access</span>=<span class="hljs-string">"hasRole('ROLE_USER')"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intercept-url</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">"/admin**"</span> <span class="hljs-attr">access</span>=<span class="hljs-string">"hasRole('ROLE_ADMIN')"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">form-login</span> <span class="hljs-attr">login-page</span>=<span class="hljs-string">"/index"</span> <span class="hljs-attr">default-target-url</span>=<span class="hljs-string">"/userhome"</span> <span class="hljs-attr">authentication-failure-url</span>=<span class="hljs-string">"/index?error=true"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logout</span> <span class="hljs-attr">logout-url</span>=<span class="hljs-string">"/logout"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">http</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">authentication-manager</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">authentication-provider</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">password-encoder</span> <span class="hljs-attr">hash</span>=<span class="hljs-string">"bcrypt"</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">jdbc-user-service</span> <span class="hljs-attr">data-source-ref</span>=<span class="hljs-string">"dataSource"</span><br>                <span class="hljs-attr">authorities-by-username-query</span>=<span class="hljs-string">"select user_tbl.user_name, role_tbl.name from user_tbl<br>join user_tbl_role_tbl on user_tbl.user_id=user_tbl_role_tbl.users_user_id<br>join role_tbl on user_tbl_role_tbl.roles_role_id = role_tbl.role_id<br>where user_tbl.user_name = ?"</span><br>                <span class="hljs-attr">users-by-username-query</span>=<span class="hljs-string">"select user_name, password, true from user_tbl where user_name = ?"</span> /&gt;</span><br><br>                <span class="hljs-comment">&lt;!--&lt;user-service&gt;--&gt;</span><br>                    <span class="hljs-comment">&lt;!--&lt;user name="admin" password="admin" authorities="ROLE_USER, ROLE_ADMIN" /&gt;--&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;/user-service&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">authentication-provider</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">authentication-manager</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans:beans</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>User.java, Role.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"user_tbl"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"user_id"</span>)<br>    <span class="hljs-meta">@GeneratedValue</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"user_name"</span>)<br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">private</span> String userName;<br><br>    <span class="hljs-keyword">private</span> String fullname;<br><br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">1</span>)<br>    <span class="hljs-meta">@Email</span><br>    <span class="hljs-keyword">private</span> String email;<br><br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">3</span>)<br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"password"</span>)<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@ManyToMany</span>(fetch = FetchType.EAGER)<br>    <span class="hljs-meta">@JoinTable</span><br>    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;<br>&#125;<br><br><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"role_tbl"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span> </span>&#123;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"role_id"</span>)<br>    <span class="hljs-meta">@GeneratedValue</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-meta">@ManyToMany</span>(mappedBy = <span class="hljs-string">"roles"</span>)<br>    <span class="hljs-keyword">private</span> List&lt;User&gt; users;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>HomeController.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = (Logger) LoggerFactory.getLogger(HomeController.class);<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibUserService hibUserService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibSpittleService hibSpittleService;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"index"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>        List&lt;Spittle&gt; spittleList = hibSpittleService.getRecentSpittles(<span class="hljs-number">5</span>);<br>        model.addAttribute(<span class="hljs-string">"spittleList"</span>, spittleList);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"userhome"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">loginSuccess</span><span class="hljs-params">(HttpServletRequest request, Principal principal)</span> </span>&#123;<br>        String username = principal.getName();<br>        User user = hibUserService.findUserByName(username);<br>        user.setLastIp(request.getRemoteAddr());<br>        user.setLastVisit(<span class="hljs-keyword">new</span> java.sql.Timestamp((<span class="hljs-keyword">new</span> java.util.Date()).getTime()));<br>        hibUserService.loginSuccess(user);<br>        request.getSession().setAttribute(<span class="hljs-string">"currentUser"</span>, user);<br><br>        logger.info(<span class="hljs-string">"User id: "</span> + user.getUserId().toString());<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:u/"</span> + username;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>现在不登录访问 /u, /admin url 路径，都会跳到首页。</p><p>实现一个 Spittle 只有管理员和其作者才可以删除，在 Service 类上应用方法级安全措施</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HibSpittleService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibSpittleDao hibSpittleDao;<br>    <span class="hljs-comment">//...</span><br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-meta">@PreAuthorize</span>(<span class="hljs-string">"#spittle.user.userName == authentication.name or hasRole('ROLE_ADMIN')"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(@P(<span class="hljs-string">"spittle"</span>)</span> Spittle spittle) </span>&#123;<br>        hibSpittleDao.delSpittle(spittle);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在与 AJAX 技术结合时，如果出现 Could not write JSON: failed to lazily initialize a collection of role，参考</p><p><a href="https://github.com/FasterXML/jackson-datatype-hibernate" target="_blank" rel="noopener">https://github.com/FasterXML/jackson-datatype-hibernate</a></p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.hibernate4.Hibernate4Module;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HibernateAwareObjectMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ObjectMapper</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HibernateAwareObjectMapper</span><span class="hljs-params">()</span> </span>&#123;<br>        Hibernate4Module hm = <span class="hljs-keyword">new</span> Hibernate4Module();<br>        hm.configure(Hibernate4Module.Feature.FORCE_LAZY_LOADING, <span class="hljs-keyword">false</span>);<br>        registerModule(hm);<br>        configure(SerializationFeature.INDENT_OUTPUT, <span class="hljs-keyword">true</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记7 表现层 Tiles Sitemesh</title>
      <link href="/2014/08/30/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-%E8%A1%A8%E7%8E%B0%E5%B1%82-Tiles-Sitemesh/"/>
      <url>/2014/08/30/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-%E8%A1%A8%E7%8E%B0%E5%B1%82-Tiles-Sitemesh/</url>
      <content type="html"><![CDATA[<p>表现层为了减少手工写 jsp 页面代码的工作量，出现了许多不同的技术方案，Tiles, SiteMesh, Velocity, FreeMarker 等。这里选用 Tiles3/Sitemesh 负责自定义的 header, body, footer 组装，jsp 页面加入 bootstrap, jQuery ，暂时不用 Velocity/FreeMarker 模板。<a id="more"></a></p><h2 id="Tiles"><a href="#Tiles" class="headerlink" title="Tiles"></a>Tiles</h2><p>applicationContext.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"tilesConfigurer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.tiles3.TilesConfigurer"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"definitions"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/general.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"urlViewResolver"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewClass"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"org.springframework.web.servlet.view.tiles3.TilesView"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"order"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">"/resources/**"</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"/resources/"</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>注：不同的 ViewResolver 可以添加 order 属性值，运行时从小到大查找。TilesView 2/3 内置 JSTL 支持。css/js 放在 webapp/resources 目录下。</p><p>general.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt;<br><span class="hljs-meta">&lt;!DOCTYPE tiles-definitions PUBLIC<br>        "-//Apache Software Foundation//DTD Tiles Configuration 3.0//EN"<br>        "http://tiles.apache.org/dtds/tiles-config_3_0.dtd"&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">tiles-definitions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">definition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"common"</span> <span class="hljs-attr">template</span>=<span class="hljs-string">"/WEB-INF/layout/classic.jsp"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">put-attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"footer"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/layout/footer.jsp"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">definition</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">definition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">"common"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">put-attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Java Blog Aggregator"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">put-attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"body"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/jsp/index.jsp"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">put-attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"index"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">definition</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tiles-definitions</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>classic.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"spring"</span>%&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Type"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"text/html; charset=UTF-8"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/resources/css/bootstrap.min.css"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/resources/js/jquery-1.11.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/resources/js/bootstrap.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tiles:getAsString</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"title"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Static navbar --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-default"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"navigation"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggle collapsed"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">".navbar-collapse"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sr-only"</span>&gt;</span>Toggle navigation<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;spring:url value="</span>/" /&gt;</span>"&gt;Spitter<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-collapse collapse"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;spring:url value="</span>/" /&gt;</span>"&gt;Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown"</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span>Dropdown <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"menu"</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Action<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Another action<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Something else here<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-header"</span>&gt;</span>Nav header<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Separated link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>One more separated link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav navbar-right"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./"</span>&gt;</span>Default<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../navbar-static-top/"</span>&gt;</span>Static top<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../navbar-fixed-top/"</span>&gt;</span>Fixed top<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--/.nav-collapse --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--/.container-fluid --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <span class="hljs-comment">&lt;!-- /container --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">tiles:insertAttribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"body"</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">tiles:insertAttribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"footer"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>footer.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>@copyright Joseph Pei 2014<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>index.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello world<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>然后 index 页面就可以看到 bootstrap navbar 了</p><p>上面的活动条目跟随页面不同而不同，注意 general.xml 的 current 属性，页面中设置如下</p><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tilesx:useAttribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"current"</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"$&#123;current == 'index' ? 'active' : '' &#125;"</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Sitemesh"><a href="#Sitemesh" class="headerlink" title="Sitemesh"></a>Sitemesh</h2><p>pom.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>opensymphony<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sitemesh<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>web.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>sitemesh<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.opensymphony.sitemesh.webapp.SiteMeshFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>sitemesh<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>WEB-INF 目录下新建 decorators.xml 和 decorators 目录</p><p>decorators.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br><br><span class="hljs-tag">&lt;<span class="hljs-name">decorators</span> <span class="hljs-attr">defaultdir</span>=<span class="hljs-string">"/WEB-INF/decorators"</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Any urls that are excluded will never be decorated by Sitemesh --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>/about.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>/static/*<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">decorator</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main-layout"</span> <span class="hljs-attr">page</span>=<span class="hljs-string">"main-layout.jsp"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">decorator</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">decorators</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>decorators/main-layout.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.opensymphony.com/sitemesh/decorator"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sitemesh"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">c:set</span> <span class="hljs-attr">var</span>=<span class="hljs-string">"ctx"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;pageContext.request.contextPath&#125;"</span> /&gt;</span><br><br><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sitemesh:title</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/css/bootstrap.min.css"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.11.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery.validate.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/bootstrap.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">sitemesh:head</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/WEB-INF/decorators/navbar.jsp"</span>%&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sitemesh:body</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/WEB-INF/decorators/footer.jsp"</span>%&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>navbar.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-comment">&lt;!-- Static navbar --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-default"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"navigation"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggle collapsed"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">".navbar-collapse"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sr-only"</span>&gt;</span>Toggle navigation<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Spitter<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-collapse collapse"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span>Dropdown <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"menu"</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Action<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Another action<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Something else here<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-header"</span>&gt;</span>Nav header<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Separated link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>One more separated link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--/.nav-collapse --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--/.container-fluid --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>index.jsp 示例，可以看到几乎感觉不到 sitemesh 的存在<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sf"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags/form"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h1"</span>&gt;</span>Welcome to Spitter<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-8"</span>&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-3"</span>&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记6 SLF4J Logback 日志</title>
      <link href="/2014/08/25/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-SLF4J-Logback-%E6%97%A5%E5%BF%97/"/>
      <url>/2014/08/25/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-SLF4J-Logback-%E6%97%A5%E5%BF%97/</url>
      <content type="html"><![CDATA[<p>Simple Logging Facade for Java(SL4J)</p><p>SLF4J 提供了一组抽象接口，在部署应用时后端可以选择不同的日志框架，而无需更改已有代码。</p><p>Logback 是项目 Log4j 的后继。它由三个模块组成：logback-core, logback-classic, logback-access。其中 logback-core 是基础模块。logback-classic 是 log4j 的改良版，是 slf4j api 的原生实现，可以方便地更换成其它日志框架。logback-access 模块与 Servlet 容器集成提供Http-access 日志的功能。 <a id="more"></a></p><p>Spring 默认使用 Jakarta Commons Logging，但可以切换成其它日志框架。</p><p>首先移除 spring-core 对 commons-logging 依赖，添加 logback 模块。<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1$&#123;jcloverslf4j.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>基本参考配置<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"consoleAppender"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>.%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg %n<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>TRACE<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dailyRollingFileAppender"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>/tmp/spring-demo.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- daily rollover --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>spring-demo.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br><br>            <span class="hljs-comment">&lt;!-- keep 30 days' worth of history --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; - %msg %n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"errorFileAppender"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">OnMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">OnMismatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">OnMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">OnMatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>/tmp/spring-err.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.FixedWindowRollingPolicy"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>spring-err.log.%i.bak<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MinIndex</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">MinIndex</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MaxIndex</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">MaxIndex</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.EXAMPLE"</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">"false"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">level</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"DEBUG"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dailyRollingFileAppender"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"errorFileAppender"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"consoleAppender"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">level</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"INFO"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"consoleAppender"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>logback 将记录日志任务委托给 appender，有几种不同的日志级别 TRACE, DEBUG, INFO, WARN, ERROR 。</p><p>static final Logger logger = LoggerFactory.getLogger(MyClassName.class);</p><p>参考</p><p><a href="http://www.codingpedia.org/ama/how-to-log-in-spring-with-slf4j-and-logback/" target="_blank" rel="noopener">http://www.codingpedia.org/ama/how-to-log-in-spring-with-slf4j-and-logback/</a></p><p><a href="http://logback.qos.ch/documentation.html" target="_blank" rel="noopener">http://logback.qos.ch/documentation.html</a></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记5 REST与AJAX</title>
      <link href="/2014/08/24/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-REST%E4%B8%8EAJAX/"/>
      <url>/2014/08/24/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-REST%E4%B8%8EAJAX/</url>
      <content type="html"><![CDATA[<p>近来，以信息为中心的表述性状态转移(Representational State Transfer, REST)已成为替换传统 SOAP Web 服务的流行方案，Spring MVC 封装了对 REST 的良好支持。</p><p>当谈论REST时，有一种常见的错误就是将其视为“基于 URL 的 Web 服务”，将 REST 作为另一种类型的远程过程调用(RPC)机制。恰好相反，REST 与 RPC 几乎没有任何关系，RPC 是面向服务的，并关注于行为和动作，而 REST 是面向资源的，强调描述应用程序的事物和名词。REST 就是将资源的状态以最合适的形式从服务器端转移到客户端（或者反之）。</p><p>本节应用 @ResponseBody 注解实现简单的 RESTless URL，并与 JQuery AJAX 结合。<a id="more"></a></p><p>用户登录之后，转到 /u/USERNAME 页面，显示用户微博列表，每条微博后面有 Delete URL。使用RESTless URL and AJAX 实现添加新微博和删除旧微博。</p><p>需要添加 jackson 包，有 1.x 和 2.x 两种版本，1.x 已不在开发新功能，只维护 bug。这里使用 2.x 版本。</p><p>servlet.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Configure to plugin JSON as request and response in method handler --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"messageConverters"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">"jsonMessageConverter"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Configure bean to convert JSON to POJO and vice versa --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"jsonMessageConverter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>微博条目 Spittle.java，Date 类型的序列化使用 jackson 2.x 版本新增的 JsonFormat 注解<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"spittle_tbl"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Spittle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-comment">//omit getter and setter</span><br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)<br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"spittle_id"</span>)<br>    <span class="hljs-keyword">private</span> Long spittleId;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"text"</span>)<br>    <span class="hljs-keyword">private</span> String text;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"push_time"</span>)<br>    <span class="hljs-meta">@JsonFormat</span>(shape=JsonFormat.Shape.STRING, pattern = <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>)<br>    <span class="hljs-keyword">private</span> Date pushTime;<br><br>    <span class="hljs-meta">@JoinColumn</span>(name=<span class="hljs-string">"user_id"</span>, referencedColumnName = <span class="hljs-string">"user_id"</span>)<br>    <span class="hljs-meta">@ManyToOne</span>(optional = <span class="hljs-keyword">false</span>)<br>    <span class="hljs-keyword">private</span> User user;<br><br>&#125;<br></code></pre></td></tr></table></figure></p><p>用户页面 Controller<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/u/&#123;username&#125;"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpitterController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibSpittleService hibSpittleService;<br><br>    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">userPage</span><span class="hljs-params">(@PathVariable String username, HttpServletRequest request, Model model)</span> </span>&#123;<br>        User user = (User) request.getSession().getAttribute(<span class="hljs-string">"user"</span>);<br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"redirect:/"</span>);<br><br>        List&lt;Spittle&gt; spittles = hibSpittleService.getSpittlesForUser(user);<br>        model.addAttribute(<span class="hljs-string">"spittle"</span>, <span class="hljs-keyword">new</span> Spittle());<br>        model.addAttribute(<span class="hljs-string">"spittles"</span>, spittles);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"user_page"</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(method=RequestMethod.POST, produces = <span class="hljs-string">"application/json; charset=utf-8"</span>)<br>    <span class="hljs-meta">@ResponseStatus</span>(HttpStatus.CREATED)<br>    <span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function">Spittle <span class="hljs-title">pushSpittle</span><span class="hljs-params">(@PathVariable String username, @RequestBody Spittle spittle,<br>                              HttpServletRequest request )</span> </span>&#123;<br>        User user = (User) request.getSession().getAttribute(<span class="hljs-string">"user"</span>);<br><br>        spittle.setPushTime(<span class="hljs-keyword">new</span> java.sql.Timestamp((<span class="hljs-keyword">new</span> java.util.Date()).getTime()));<br>        spittle.setUser(user);<br>        hibSpittleService.addSpittle(spittle);<br><br>        <span class="hljs-keyword">return</span> spittle;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/delete/&#123;id&#125;"</span>, method = RequestMethod.DELETE)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">delSpittleByID</span><span class="hljs-params">(@PathVariable String username, @PathVariable Long id)</span> </span>&#123;<br>        hibSpittleService.delSpittleById(id);<br><br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"logout"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<br>        request.getSession().invalidate();<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/"</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>用户页面 jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sf"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags/form"</span>%&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Success<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/js/jquery-1.11.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="xml"><br><br>        $(document).ready(function() &#123;<br>            $('#newSpittle').submit(function(event) &#123;<br><br>                var mess = $('#text').val();<br>                var formData = &#123; "text" : mess&#125;;<br><br>                $.ajax(&#123;<br>                    url: $("#newSpittle").attr( "action"),<br>                    type: "POST",<br>                    contentType: 'application/json; charset=utf-8',<br>                    dataType: 'json',<br>                    async: false,<br>                    data: JSON.stringify(formData),<br><br>                    success: function(spittle) &#123;<br>                        var respContent = "";<br>                        var delLink = "/u/" + spittle.user.userName + "/delete/" + spittle.spittleId;<br><br>                        respContent += "<span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>";<br>                        respContent += spittle.user.userName + ", ";<br>                        respContent += spittle.pushTime + ", " ;<br>                        respContent += spittle.text;<br>                        respContent += '<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"' + delLink + '"</span>&gt;</span>Delete<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>';<br>                        respContent += "<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>";<br><br>                        $('#mblog').prepend(respContent);<br>                    &#125;,<br>                    error: function(jqXHR, textStatus, errorThrown) &#123;<br>                        var respBody = $.parseJSON(jqXHR.responseText);<br>                        alert("Error: " + respBody.message);<br>                    &#125;<br>                &#125;);<br><br>                event.preventDefault();<br>            &#125;);<br><br>            var deleteLink = $("a:contains('Delete')");<br><br>            $(deleteLink).click(function(event) &#123;<br><br>                $.ajax(&#123;<br>                    url: $(event.target).attr("href"),<br>                    type: "DELETE",<br><br>                    success: function(id) &#123;<br>                        alert("delete" + id);<br>                        var rowToDelete = $(event.target).closest("li");<br><br>                        rowToDelete.remove();<br>                    &#125;<br>                &#125;);<br><br>                event.preventDefault();<br>            &#125;);<br><br>        &#125;);<br>    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="undefined"><br>        html,body&#123;margin:10px; padding: 10px;&#125;<br>        .left,.right,.center &#123; height: 600px; &#125;<br><br>        .left &#123;float:left; width: 200px; background-color: #ccc;&#125;<br>        .right &#123;float:right; width: 200px; background-color: #ccc;&#125;<br>        .center &#123; margin: 0 210px; background-color: #666;&#125;<br><br>        ul.navbar &#123;<br>            list-style-type: none;<br>            padding: 0;<br>            margin: 0 &#125;<br>        ul.navbar li &#123;<br>            background: white;<br>            margin: 0.5em 0;<br>            padding: 0.3em;<br>            border-left: 1em solid black &#125;<br>        ul.navbar a &#123;<br>            text-decoration: none &#125;<br>        a:link &#123;<br>            color: blue &#125;<br>        a:visited &#123;<br>            color: purple &#125;<br><br>        ul.mblog li &#123;<br>            background: #ccc;<br>            margin-bottom: 0.5em;<br>            margin-right: 1em;<br>        &#125;<br><br>    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome, <span class="hljs-tag">&lt;<span class="hljs-name">c:out</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;sessionScope.user.getUserName()&#125;"</span> /&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span>左<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">c:out</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;sessionScope.user.getUserName()&#125;"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../static/img/default.jpg"</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- Site navigation menu --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"index.html"</span>&gt;</span>Home page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"musings.html"</span>&gt;</span>Musings<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"town.html"</span>&gt;</span>My town<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/u/$&#123;sessionScope.user.getUserName()&#125;/logout"</span>&gt;</span>Logout<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sf:form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"newSpittle"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">modelAttribute</span>=<span class="hljs-string">"spittle"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">sf:textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">"100"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"commit"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Push"</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">sf:form</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"newWeibo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"mblog"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mblog"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">c:forEach</span> <span class="hljs-attr">var</span>=<span class="hljs-string">"spittle"</span> <span class="hljs-attr">items</span>=<span class="hljs-string">"$&#123;spittles&#125;"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br>                $&#123;spittle.user.userName&#125;, $&#123;spittle.pushTime&#125;, $&#123;spittle.text&#125;<br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/u/$&#123;sessionScope.user.getUserName()&#125;/delete/$&#123;spittle.spittleId&#125;"</span>&gt;</span>Delete<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">c:forEach</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>参考</p><p><a href="http://www.journaldev.com/2552/spring-restful-web-service-example-with-json-jackson-and-client-program" target="_blank" rel="noopener">http://www.journaldev.com/2552/spring-restful-web-service-example-with-json-jackson-and-client-program</a></p><p><a href="http://www.codingpedia.org/ama/tutorial-rest-api-design-and-implementation-in-java-with-jersey-and-spring/" target="_blank" rel="noopener">http://www.codingpedia.org/ama/tutorial-rest-api-design-and-implementation-in-java-with-jersey-and-spring/</a></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记4 数据库之整合Hibernate</title>
      <link href="/2014/08/20/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E6%95%B4%E5%90%88Hibernate/"/>
      <url>/2014/08/20/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E6%95%B4%E5%90%88Hibernate/</url>
      <content type="html"><![CDATA[<p>整合 Spring MVC 与 Hibernate</p><p>pom.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></p><a id="more"></a><p>servlet.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">"close"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.driverClassName&#125;"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.url&#125;"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.username&#125;"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.password&#125;"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initialSize"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"5"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxActive"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"10"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"packagesToScan"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>io.github.josephpei.domain<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernateProperties"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.PostgreSQL82Dialect<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"hibernate.use_sql_comments"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"current_session_context_class"</span>&gt;</span>org.springframework.orm.hibernate4.SpringSessionContext<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"transactionManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sessionFactory"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"sessionFactory"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"transactionAdvice"</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">"transactionManager"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"get*"</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">"REQUIRED"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"*"</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">"REQUIRED"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>User.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"user_tbl"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"user_id"</span>)<br>    <span class="hljs-meta">@GeneratedValue</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"user_name"</span>)<br>    <span class="hljs-keyword">private</span> String userName;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"password"</span>)<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"last_ip"</span>)<br>    <span class="hljs-keyword">private</span> String lastIp;<br><br>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"last_visit"</span>)<br>    <span class="hljs-keyword">private</span> Date lastVisit;<br><br>    <span class="hljs-comment">// omit getter and setter</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>HibUserDao.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HibUserDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getMatchCount</span><span class="hljs-params">(String userName, String password)</span> </span>&#123;<br>        String hql = <span class="hljs-string">"select count(*) from User where userName=:name and password=:pass"</span>;<br><br>        Query q = sessionFactory.getCurrentSession().createQuery(hql);<br>        q.setParameter(<span class="hljs-string">"name"</span>, userName);<br>        q.setParameter(<span class="hljs-string">"pass"</span>, password);<br><br>        Long row = <span class="hljs-number">0L</span>;<br>        <span class="hljs-keyword">for</span> (Iterator it = q.iterate(); it.hasNext(); )<br>            row = (Long) it.next();<br>        <span class="hljs-keyword">return</span> row;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">findUserByName</span><span class="hljs-params">(String userName)</span> </span>&#123;<br>        Query q = sessionFactory.getCurrentSession().createQuery(<span class="hljs-string">"from User where userName=:name"</span>);<br>        q.setParameter(<span class="hljs-string">"name"</span>, userName);<br>        List&lt;User&gt; users = q.list();<br>        <span class="hljs-keyword">return</span> (users.isEmpty() ? <span class="hljs-keyword">null</span> : users.get(<span class="hljs-number">0</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateLoginInfo</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        sessionFactory.getCurrentSession().update(user);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        sessionFactory.getCurrentSession().save(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>HibUserService.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HibUserService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HibUserDao hibUserDao;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasMatchUser</span><span class="hljs-params">(String userName, String password)</span> </span>&#123;<br>        Long count = hibUserDao.getMatchCount(userName, password);<br>        <span class="hljs-keyword">return</span> count &gt; <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">findUserByName</span><span class="hljs-params">(String userName)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hibUserDao.findUserByName(userName);<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loginSuccess</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        hibUserDao.updateLoginInfo(user);<br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        hibUserDao.insertUser(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记3 验证Validator</title>
      <link href="/2014/08/18/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E9%AA%8C%E8%AF%81Validator/"/>
      <url>/2014/08/18/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E9%AA%8C%E8%AF%81Validator/</url>
      <content type="html"><![CDATA[<p>Spring Framework 验证有两种方式，一是 Spring 传统的，对需要验证的 POJO 对象编写一个对应的验证类（实现Validator接口）；二是标准的 JSR-303/349 Bean Validation API，需要第三方的实现（Hibernate-validator）；三是使用 JSR-349 中的 ScriptAssert。</p><p>下面以注册页面验证为例，用 JSR Bean Validation 实现基本字段验证，应用不同手段实现密码校验。<br><a id="more"></a></p><p>要实现验证的注册页面<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sf"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags/form"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="undefined"><br>        .error &#123; color: red; font-size: 0.9em; font-weight: bold; &#125;<br>    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">sf:form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"register.do"</span> <span class="hljs-attr">modelAttribute</span>=<span class="hljs-string">"registerCommand"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">"0"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"username"</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"15"</span> <span class="hljs-attr">maxlength</span>=<span class="hljs-string">"15"</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"error"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"fullname"</span>&gt;</span>Nickname<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"15"</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"error"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"password"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:password</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"30"</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"error"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"confirmation"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:password</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"confirmation"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"confirmation"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"30"</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"confirmation"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"error"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"email"</span>&gt;</span>Email<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"30"</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">"error"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"commit"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"I accept. Create my account."</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">sf:form</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><p>pom.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.0.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>servlet.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"validator"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messageSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basename"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"errormess"</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>resources 目录下 errormess.properties<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined">Size=the &#123;0&#125; field must be between &#123;2&#125; and &#123;1&#125; characters long<br>Size.loginCommand.name=Name must be between &#123;2&#125; and &#123;1&#125; characters<br>password.confirmation.error=Password don&apos;t confirm<br>password.null=Field cannot be left blank<br>password.confirmation.null=Field cannot be left blank<br><br>NotEmpty=Field cannot be left blank<br>NotNull=Field cannot be left blank<br></code></pre></td></tr></table></figure></p><p>验证对象<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterCommand</span> </span>&#123;<br>    <span class="hljs-comment">// omit getter and setter</span><br><br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">5</span>, max=<span class="hljs-number">20</span>)<br>    <span class="hljs-meta">@Pattern</span>(regexp=<span class="hljs-string">"^[a-zA-Z0-9]+$"</span>, message=<span class="hljs-string">"Username must be alphanumeric with no spaces"</span>)<br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">private</span> String fullname;<br><br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">6</span>, max=<span class="hljs-number">20</span>)<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Size</span>(min=<span class="hljs-number">6</span>, max=<span class="hljs-number">20</span>)<br>    <span class="hljs-keyword">private</span> String confirmation;<br><br>    <span class="hljs-meta">@Email</span><br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="方法一，编写自定义-Validator"><a href="#方法一，编写自定义-Validator" class="headerlink" title="方法一，编写自定义 Validator"></a>方法一，编写自定义 Validator</h2><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegistrationValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Validator</span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; aClass)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> RegistrationValidator.class.isAssignableFrom(aClass);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">validate</span><span class="hljs-params">(Object o, Errors errors)</span> </span>&#123;<br>        RegisterCommand registerCommand = (RegisterCommand) o;<br>        <span class="hljs-keyword">if</span> (!registerCommand.getConfirmation().equals(registerCommand.getPassword()))<br>            errors.rejectValue(<span class="hljs-string">"confirmation"</span>, <span class="hljs-string">"password.confirmation.error"</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>控制器注入自定义的Validator，HomeController.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String salt = <span class="hljs-string">"SECRET"</span>;<br>    <span class="hljs-comment">//private static final int DEFAULT_SPITTERS_PER_PAGE = 25;</span><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RegistrationValidator registrationValidator;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/"</span>, method = RequestMethod.GET)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">loginCommand</span><span class="hljs-params">(Model model)</span></span>&#123;<br>        model.addAttribute(<span class="hljs-string">"loginCommand"</span>, <span class="hljs-keyword">new</span> LoginCommand());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"home"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/"</span>, method = RequestMethod.POST)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">loginCheck</span><span class="hljs-params">(@ModelAttribute(<span class="hljs-string">"loginCommand"</span>)</span> @Valid LoginCommand loginCommand,<br>                                   BindingResult result,<br>                                   HttpServletRequest request, Model model) </span>&#123;<br>        String name = loginCommand.getUsername();<br>        String pass = loginCommand.getPassword();<br><br>        <span class="hljs-keyword">if</span> (result.hasErrors()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"home"</span>);<br>        &#125;<br><br>        String secretPass = DigestUtils.md5Hex(salt + pass);<br>        <span class="hljs-keyword">boolean</span> valid = userService.hasMatchUser(name, secretPass);<br>        <span class="hljs-keyword">if</span> (!valid) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"redirect:/"</span>, <span class="hljs-string">"fatal"</span>, <span class="hljs-string">"Username or password error!"</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            User user = userService.findUserByName(name);<br>            user.setLastIp(request.getRemoteAddr());<br>            user.setLastVisit(<span class="hljs-keyword">new</span> Date());<br>            userService.loginSuccess(user);<br>            request.getSession().setAttribute(<span class="hljs-string">"user"</span>, user);<br>            String userPage = <span class="hljs-string">"redirect:user/"</span> + name;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(userPage);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/user/&#123;name&#125;"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">userPage</span><span class="hljs-params">(@PathVariable String name, HttpServletRequest request, Model model)</span> </span>&#123;<br>        model.addAttribute(<span class="hljs-string">"name"</span>, name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"sucess"</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"register.html"</span>, method=RequestMethod.GET)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">register</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>        model.addAttribute(<span class="hljs-string">"registerCommand"</span>, <span class="hljs-keyword">new</span> RegisterCommand());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"register"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"register.do"</span>, method=RequestMethod.POST)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">register</span><span class="hljs-params">(@ModelAttribute(<span class="hljs-string">"registerCommand"</span>)</span> @Valid RegisterCommand registerCommand,<br>                           BindingResult result,<br>                           HttpServletRequest request, Model model) </span>&#123;<br>        registrationValidator.validate(registerCommand, result);<br><br>        <span class="hljs-keyword">if</span> (result.hasErrors()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">"register"</span>;<br>        &#125;<br><br>        User user = <span class="hljs-keyword">new</span> User();<br>        user.setUserName(registerCommand.getUsername());<br>        user.setPassword(DigestUtils.md5Hex(salt + registerCommand.getPassword()));<br>        user.setLastIp(request.getRemoteAddr());<br>        user.setLastVisit(<span class="hljs-keyword">new</span> Date());<br>        userService.insertUser(user);<br><br>        model.addAttribute(<span class="hljs-string">"loginCommand"</span>, <span class="hljs-keyword">new</span> LoginCommand());<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"home"</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="方法二，编写注解类"><a href="#方法二，编写注解类" class="headerlink" title="方法二，编写注解类"></a>方法二，编写注解类</h2><p>CheckPassword<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target</span>(&#123; TYPE, ANNOTATION_TYPE&#125;)<br><span class="hljs-meta">@Retention</span>(RUNTIME)<br><span class="hljs-meta">@Constraint</span>(validatedBy = CheckPasswordValidator.class)<br><span class="hljs-meta">@Documented</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CheckPassword &#123;<br><br>    <span class="hljs-comment">//默认错误消息</span><br>    <span class="hljs-function">String <span class="hljs-title">message</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ""</span>;<br><br>    <span class="hljs-comment">//分组</span><br>    Class&lt;?&gt;[] groups() <span class="hljs-keyword">default</span> &#123; &#125;;<br><br>    <span class="hljs-comment">//负载</span><br>    Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword">default</span> &#123; &#125;;<br><br>    <span class="hljs-comment">//指定多个时使用</span><br>    <span class="hljs-meta">@Target</span>(&#123; FIELD, METHOD, PARAMETER, ANNOTATION_TYPE &#125;)<br>    <span class="hljs-meta">@Retention</span>(RUNTIME)<br>    <span class="hljs-meta">@Documented</span><br>    <span class="hljs-meta">@interface</span> List &#123;<br>        CheckPassword[] value();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CheckPasswordValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ConstraintValidator</span>&lt;<span class="hljs-title">CheckPassword</span>, <span class="hljs-title">RegisterCommand</span>&gt; </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(CheckPassword constraintAnnotation)</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isValid</span><span class="hljs-params">(RegisterCommand user, ConstraintValidatorContext context)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(user == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//两次密码不一样</span><br>        <span class="hljs-keyword">if</span> (!user.getPassword().trim().equals(user.getConfirmation().trim())) &#123;<br>            context.disableDefaultConstraintViolation();<br>            context.buildConstraintViolationWithTemplate(<span class="hljs-string">"&#123;password.confirmation.error&#125;"</span>)<br>                    .addPropertyNode(<span class="hljs-string">"confirmation"</span>)<br>                    .addConstraintViolation();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>现在只需要在验证对象 RegisterCommand 上加上注解 @CheckPassword 即可</p><p>这里 <a href="https://github.com/jirutka/validator-spring" target="_blank" rel="noopener">https://github.com/jirutka/validator-spring</a> ，有人写了一个更加通用的解决方案，可以在注解中自定义验证方法</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpELAssert</span>(value = <span class="hljs-string">"password.equals(passwordVerify)"</span>,<br>            applyIf = <span class="hljs-string">"password || passwordVerify"</span>,<br>            message = <span class="hljs-string">"&#123;validator.passwords_not_same&#125;"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String passwordVerify;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="方法三，使用SpELAssert"><a href="#方法三，使用SpELAssert" class="headerlink" title="方法三，使用SpELAssert"></a>方法三，使用SpELAssert</h2><p>JSR-349 Bean Validation API 1.1</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ScriptAssert</span>(script = <span class="hljs-string">"_this.confirmation==_this.password"</span>, lang = <span class="hljs-string">"javascript"</span>, alias = <span class="hljs-string">"_this"</span>,<br>message=<span class="hljs-string">"Password don't confirm"</span>)<br></code></pre></td></tr></table></figure><p>参考</p><p><a href="http://codetutr.com/2013/05/28/spring-mvc-form-validation/" target="_blank" rel="noopener">http://codetutr.com/2013/05/28/spring-mvc-form-validation/</a></p><p><a href="http://haohaoxuexi.iteye.com/blog/1812584" target="_blank" rel="noopener">http://haohaoxuexi.iteye.com/blog/1812584</a></p><p><a href="http://www.javacodegeeks.com/2013/06/spring-mvc-validator-and-initbinder.html" target="_blank" rel="noopener">http://www.javacodegeeks.com/2013/06/spring-mvc-validator-and-initbinder.html</a></p><p><a href="https://github.com/jirutka/validator-spring" target="_blank" rel="noopener">https://github.com/jirutka/validator-spring</a></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记2 数据库之JDBC</title>
      <link href="/2014/08/17/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BJDBC/"/>
      <url>/2014/08/17/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8BJDBC/</url>
      <content type="html"><![CDATA[<p>这一节为我们的登录模块添加数据库存储，使用Spring JdbcTemplate。<a id="more"></a></p><p>servlet.xml 定义 DataStore</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hljs-attr">destroy-</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"close"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.driverClassName&#125;"</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.url&#125;"</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.username&#125;"</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.password&#125;"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"jdbc.properties"</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"txManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"io.github.josephpei.DAO"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"io.github.josephpei.Service"</span> /&gt;</span><br><span class="hljs-comment">&lt;!--<br>1.&lt;jee:jndi-lookup id="dataSource" jndi-name="jdbc/jpetstore"/&gt;&lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager" /&gt;<br><br>2.#this is the service object that we want to make transactional&lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;<br>#the transactional semantics&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;<br>  &lt;tx:attributes&gt;<br>    &lt;tx:method name="get*" read-only="true"/&gt;<br>    &lt;tx:method name="*"/&gt;<br>  &lt;/tx:attributes&gt;<br>&lt;/tx:advice&gt;<br><br>#ensure that the above transactional advice runs for any execution of an operation defined by the FooService<br>&lt;aop:config&gt;<br>  &lt;aop:pointcut id="fooServiceOperation" expression="execution(* x.y.service.FooService.*(..))"/&gt;<br>  &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceOperation"/&gt;&lt;/aop:config&gt;3.#enable the configuration of transactional behavior based on annotations&lt;tx:annotation-driven transaction-manager="txManager"/&gt;<br>--&gt;</span><br></code></pre></td></tr></table></figure><p>User.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> userId;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String lastIp;<br>    <span class="hljs-keyword">private</span> Date lastVisit;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>&#123;<br><br>    &#125;<br>    <span class="hljs-comment">// getter and setter...</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>JdbcUserDao.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcUserDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getMatchCount</span><span class="hljs-params">(String userName, String password)</span> </span>&#123;<br>        String sql = <span class="hljs-string">"SELECT count(*) FROM user_tbl WHERE user_name=? and password=?"</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.queryForObject(sql, Integer.class, userName, password);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">findUserByName</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String userName)</span> </span>&#123;<br>        String sql = <span class="hljs-string">"select user_id, user_name from user_tbl where user_name=?"</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="hljs-keyword">new</span> Object[] &#123;userName&#125;,<br>                <span class="hljs-keyword">new</span> RowMapper&lt;User&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet resultSet, <span class="hljs-keyword">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                        User user = <span class="hljs-keyword">new</span> User();<br>                        user.setUserId(resultSet.getInt(<span class="hljs-string">"user_id"</span>));<br>                        user.setUserName(resultSet.getString(<span class="hljs-string">"user_name"</span>));<br>                        <span class="hljs-keyword">return</span> user;<br>                    &#125;<br>                &#125;);<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateLoginInfo</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        String sql = <span class="hljs-string">"update user_tbl set last_visit=?, last_ip=? where user_id=?"</span>;<br>        jdbcTemplate.update(sql, user.getLastVisit(), user.getLastIp());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>UserService.java<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcUserDao jdbcUserDao;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasMatchUser</span><span class="hljs-params">(String userName, String password)</span> </span>&#123;<br>        Integer count = jdbcUserDao.getMatchCount(userName, password);<br>        <span class="hljs-keyword">return</span> count &gt; <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">findUserByName</span><span class="hljs-params">(String userName)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> jdbcUserDao.findUserByName(userName);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loginSuccess</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        jdbcUserDao.updateLoginInfo(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>测试<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith</span>(SpringJUnit4ClassRunner.class)<br><span class="hljs-meta">@ContextConfiguration</span>(locations = &#123;<span class="hljs-string">"file:src/main/webapp/WEB-INF/spitter-servlet.xml"</span>&#125;)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestUserService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hasMatchUser</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">boolean</span> b1 = userService.hasMatchUser(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"123456"</span>);<br>        <span class="hljs-keyword">boolean</span> b2 = userService.hasMatchUser(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"1111"</span>);<br>        Assert.assertTrue(b1);<br>        Assert.assertFalse(b2);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">findUserByName</span><span class="hljs-params">()</span> </span>&#123;<br>        User user = userService.findUserByName(<span class="hljs-string">"admin"</span>);<br>        Assert.assertEquals(user.getUserName(), <span class="hljs-string">"admin"</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>验证码，参考 <a href="http://chenzhou123520.iteye.com/blog/1987636" target="_blank" rel="noopener">http://chenzhou123520.iteye.com/blog/1987636</a></p><p><img src="/img/h001.png" alt="home"></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring MVC 学习笔记1 入门</title>
      <link href="/2014/08/16/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E5%85%A5%E9%97%A8/"/>
      <url>/2014/08/16/Spring-MVC-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<p>Spring Web MVC是一种基于Java的实现了Web MVC设计模式的请求驱动类型的轻量级Web框架，前端控制器是DispatcherServlet；应用控制器其实拆为处理器映射器(Handler Mapping)进行处理器管理和视图解析器(View Resolver)进行视图管理；页面控制器/动作/处理器为Controller接口（仅包含ModelAndView handleRequest(request, response) 方法）的实现（也可以是任何的POJO类）；支持本地化（Locale）解析、主题（Theme）解析及文件上传等；提供了非常灵活的数据验证、格式化和数据绑定机制；提供了强大的约定大于配置（惯例优先原则）的契约式编程支持。</p><p>这里我们实现一个简单的登录模块，登录后地址转为 <a href="http://domain.com/USER_NAME" target="_blank" rel="noopener">http://domain.com/USER_NAME</a><br><a id="more"></a></p><p>采用 Maven 包管理系统，pom.xml 添加如下内容</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">spring.version</span>&gt;</span>3.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">spring.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>web.xml，这里我的工程名为 spitter<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://java.sun.com/xml/ns/javaee"</span><br>         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span><br>         <span class="hljs-attr">version</span>=<span class="hljs-string">"3.0"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>Spring MVC Spitter<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spitter<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spitter<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/spitter-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>spitter-servlet.xml<br><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"io.github.josephpei.Controller"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:default-servlet-handler</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewResolver"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewClass"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prefix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/views/"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"suffix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">".jsp"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"order"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>控制器 HomeController<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping</span>(value=&#123;<span class="hljs-string">"/"</span>, <span class="hljs-string">"/home"</span>&#125;, method = RequestMethod.GET)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"home"</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/login"</span>, method = RequestMethod.POST)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">loginCheck</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"name"</span>)</span> String name, @<span class="hljs-title">RequestParam</span><span class="hljs-params">(<span class="hljs-string">"pass"</span>)</span> String pass) </span>&#123;<br>        String userPage = <span class="hljs-string">"redirect:"</span> + name;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(userPage);<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping</span>(value=<span class="hljs-string">"/&#123;name&#125;"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">userPage</span><span class="hljs-params">(@PathVariable String name, Model model)</span> </span>&#123;<br>        model.addAttribute(<span class="hljs-string">"name"</span>, name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView(<span class="hljs-string">"success"</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>home.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span>%&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Login Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"login"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pass"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>success.jsp<br><figure class="hljs highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span> %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Success<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome, <span class="hljs-tag">&lt;<span class="hljs-name">c:out</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;name&#125;"</span>/&gt;</span>!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>动态规划 DP 应用之 01 背包</title>
      <link href="/2014/08/06/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-DP-%E5%BA%94%E7%94%A8%E4%B9%8B-01-%E8%83%8C%E5%8C%85/"/>
      <url>/2014/08/06/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-DP-%E5%BA%94%E7%94%A8%E4%B9%8B-01-%E8%83%8C%E5%8C%85/</url>
      <content type="html"><![CDATA[<p>问题描述：n 个不同的物品，每个物品只有一个，有价值 value 和重量 weight 两个属性；背包容量 w。求背包所能容纳的最大价值。</p><p>最优子结构：当我们把一件物品放进背包里时，会让总价值变高，并且让背包变重。对某一件物品来说，我们可以选择放或不放，然后移去这件物品所带来的影响。</p><p>c(n, w) = max( c(n-1, w), c(n-1, w-W[n]) + C[n] )<br>               ^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^<br>               不放 -&gt; 0         放 -&gt; 1</p><p>n：第1个到第n个物品要放进背包内。<br>w：背包负重上限。<br>c(n, w)：第1个到第n个物品尽量塞进负重限制为w的背包时，最大价值。<br>W[n]：第n个物品的重量。<br>C[n]：第n个物品的价值。 <a id="more"></a></p><h2 id="基本算法"><a href="#基本算法" class="headerlink" title="基本算法"></a>基本算法</h2><p>Bottom UP 递推</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 物品总数上限</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MaxN = <span class="hljs-number">100</span>;<br> <br><span class="hljs-comment">// 背包负重上限</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MaxW = <span class="hljs-number">100000</span>;<br> <br><span class="hljs-comment">// 物品</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Item</span> &#123;</span><span class="hljs-keyword">int</span> cost, weight;&#125; items[MaxN];<br> <br><span class="hljs-comment">// DP矩阵</span><br><span class="hljs-keyword">int</span> c[MaxN + <span class="hljs-number">1</span>][MaxW + <span class="hljs-number">1</span>];<br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">knapsack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> w)</span>             <span class="hljs-comment">// n 为物品数，w 为背包负重上限</span><br></span>&#123;<br>    <span class="hljs-built_in">memset</span>(c, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(c));<br> <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)         <span class="hljs-comment">// 每个物品都试试看</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt;= w; ++j)    <span class="hljs-comment">// 每个重量都试试看</span><br>            <span class="hljs-keyword">if</span> (j - items[i].weight &lt; <span class="hljs-number">0</span>)<br>                c[i+<span class="hljs-number">1</span>][j] = c[i][j];    <span class="hljs-comment">// 放不下</span><br>            <span class="hljs-keyword">else</span><br>                c[i+<span class="hljs-number">1</span>][j] = max( c[i][j], c[i][j - items[i].weight] + items[i].value );<br> <br>    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Max Value: "</span> &lt;&lt; c[n][w] &lt;&lt; <span class="hljs-built_in">endl</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Top Down 递归</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">knapsack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> W)</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> i, space, max, maxi, t;<br>    <span class="hljs-keyword">if</span> (maxKnow[W] != <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> maxKnown[W];<br>    <br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, max = <span class="hljs-number">0</span>; i &lt; N; i++)<br>        <span class="hljs-keyword">if</span> ((sapce = W - items[i].weight) &gt;= <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">if</span> ((t = knapsack(space) + items[i].value) &gt; max)<br>                &#123; max = t; maxi = i; &#125;<br>    maxKnown[W] = max; itemKnown[W] = items[maxi];<br>    <span class="hljs-keyword">return</span> max<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="空间优化"><a href="#空间优化" class="headerlink" title="空间优化"></a>空间优化</h2><p>因为计算时只需要用到上方和左上方的格子，所以只需要一个单行数组就可以了。不过计算次序需要改为由后向前，才不会覆盖掉需要用来计算的格子。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MaxN = <span class="hljs-number">100</span>, MaxW = <span class="hljs-number">100000</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Item</span> &#123;</span><span class="hljs-keyword">int</span> cost, weight;&#125; items[MaxN];<br><span class="hljs-keyword">int</span> c[MaxW + <span class="hljs-number">1</span>];<br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">knapsack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> w)</span><br></span>&#123;<br>    <span class="hljs-built_in">memset</span>(c, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(c));<br> <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)<br>    &#123;<br>        <span class="hljs-keyword">int</span> weight = items[i].weight, cost = items[i].cost;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = w; j - weight &gt;= <span class="hljs-number">0</span>; --j)<br>            c[j] = max( c[j], c[j - weight] + cost );<br>    &#125;<br> <br>    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Max Value: "</span> &lt;&lt; c[w] &lt;&lt; <span class="hljs-built_in">endl</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> *<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">knapsack_iter</span><span class="hljs-params">(W, items)</span>:</span><br>    A = zeros(<span class="hljs-number">2</span> * W).reshape(<span class="hljs-number">2</span>, W)<br>    i = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> (v, w) <span class="hljs-keyword">in</span> items:<br>        A[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">2</span>][:w] = A[i%<span class="hljs-number">2</span>][:w]<br>        A[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">2</span>][w:] = maximum(A[i%<span class="hljs-number">2</span>][w:], A[i%<span class="hljs-number">2</span>][:W-w] + v)<br>        i += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> A[i%<span class="hljs-number">2</span>][W<span class="hljs-number">-1</span>]<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">knapsack_recur</span><span class="hljs-params">(W, items)</span>:</span><br>    <span class="hljs-comment"># top-down solution with memoization via hashtable</span><br>    N = len(items)<br>    A = &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">A_</span><span class="hljs-params">(i, j)</span>:</span><br>        <span class="hljs-keyword">if</span> (str(i)+<span class="hljs-string">','</span>+str(j)) <span class="hljs-keyword">in</span> A: <span class="hljs-keyword">return</span> A[str(i)+<span class="hljs-string">','</span>+str(j)] <span class="hljs-comment"># memoization</span><br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        v, w = items[i]<br>        <span class="hljs-keyword">if</span> j-w &lt; <span class="hljs-number">0</span>:<br>            result = A_(i<span class="hljs-number">-1</span>, j)<br>            A[str(i)+<span class="hljs-string">','</span>+str(j)] = result <span class="hljs-comment"># memoization</span><br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">else</span>:<br>            result = max(A_(i<span class="hljs-number">-1</span>, j), A_(i<span class="hljs-number">-1</span>, j-w) + v)<br>            A[str(i)+<span class="hljs-string">','</span>+str(j)] = result <span class="hljs-comment"># memoization</span><br>            <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> A_(N<span class="hljs-number">-1</span>, W<span class="hljs-number">-1</span>)<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>动态规划 DP 应用 HamiltonPath 及 TSP</title>
      <link href="/2014/08/05/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-DP-%E5%BA%94%E7%94%A8-HamiltonPath-%E5%8F%8A-TSP/"/>
      <url>/2014/08/05/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-DP-%E5%BA%94%E7%94%A8-HamiltonPath-%E5%8F%8A-TSP/</url>
      <content type="html"><![CDATA[<p>Hamilton Path 及 TSP 都属于 NP 完全问题，目前理论上尚无多项式算法，穷举法的时间复杂度是 O(N!)，通过运用动态规划 DP，可以缩短至 O(2^N * N^2)。 </p><p>输入：无向图 G = (V, E)，点集 V = {0, 1, … , n-1}，起始点 0</p><p>最优子结构：考虑路径上的最后一条边</p><p>dp[s,j] = min ( dp[s-{j},i] + adj[i,j] )</p><p>dp[s+{j},j] = min ( dp[s,i] + adj[i,j] ) <a id="more"></a></p><p>i、j：点。</p><p>s：点集合。</p><p>dist[s,j]：经过 S 中所有点一次且最后一点是 j 的路径长度。</p><p>adj[i,j]：adjacency matrix。</p><p>递归</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">5</span>;    <span class="hljs-comment">// 点的数目</span><br><span class="hljs-keyword">int</span> dp[<span class="hljs-number">1</span> &lt;&lt; N][N];<br><span class="hljs-keyword">int</span> adj[N][N] = &#123; &#123; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span> &#125;, &#123; <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span> &#125;,<br>&#123; <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span> &#125; &#125;;<br><span class="hljs-keyword">int</span> answer;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TSP</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> s_size)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (s_size == N)<br>    &#123;<br>        <span class="hljs-comment">// 最后再加上一条回到原点的边，形成环状回路</span><br>        <span class="hljs-keyword">if</span> (dp[s][i] + adj[i][<span class="hljs-number">0</span>] &lt; answer)<br>            answer = dp[s][i] + adj[i][<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br> <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; N; ++j) <span class="hljs-comment">// 只走第0点以外的点</span><br>        <span class="hljs-keyword">if</span> (!(s &amp; (<span class="hljs-number">1</span> &lt;&lt; j)))<br>        &#123;<br>            <span class="hljs-comment">// ss = s + &#123;j&#125;;</span><br>            <span class="hljs-keyword">int</span> ss = s | (<span class="hljs-number">1</span> &lt;&lt; j);<br>            <span class="hljs-keyword">if</span> (!dp[ss][j] || dp[s][i] + adj[i][j] &lt; dp[ss][j])<br>            &#123;<br>                dp[ss][j] = dp[s][i] + adj[i][j];<br>                TSP(ss, j, s_size + <span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span><br></span>&#123;<br>answer = <span class="hljs-number">1e9</span>;<br><span class="hljs-built_in">memset</span>(dp, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(dp));<br>TSP(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);   <span class="hljs-comment">// 从第0点出发</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, answer);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>非递归 Java</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShortestHamiltonianCycle</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getShortestHamiltonianCycle</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[][] dist)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> n = dist.length;<br>        <span class="hljs-keyword">int</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">1</span> &lt;&lt; n][n];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] d : dp)<br>            Arrays.fill(d, Integer.MAX_VALUE / <span class="hljs-number">2</span>);<br>        dp[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> mask = <span class="hljs-number">1</span>; mask &lt; <span class="hljs-number">1</span> &lt;&lt; n; mask += <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>                <span class="hljs-keyword">if</span> ((mask &amp; <span class="hljs-number">1</span> &lt;&lt; i) != <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>                        <span class="hljs-keyword">if</span> ((mask &amp; <span class="hljs-number">1</span> &lt;&lt; j) != <span class="hljs-number">0</span>) &#123;<br>                            dp[mask][i] = Math.min(dp[mask][i], dp[mask ^ (<span class="hljs-number">1</span> &lt;&lt; i)][j] + dist[j][i]);<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">int</span> res = Integer.MAX_VALUE;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>            res = Math.min(res, dp[(<span class="hljs-number">1</span> &lt;&lt; n) - <span class="hljs-number">1</span>][i] + dist[i][<span class="hljs-number">0</span>]);<br>        &#125;<br><br>        <span class="hljs-comment">// reconstruct path</span><br>        <span class="hljs-keyword">int</span> cur = (<span class="hljs-number">1</span> &lt;&lt; n) - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span>[] order = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[n];<br>        <span class="hljs-keyword">int</span> last = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>            <span class="hljs-keyword">int</span> bj = -<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; n; j++) &#123;<br>                <span class="hljs-keyword">if</span> ((cur &amp; <span class="hljs-number">1</span> &lt;&lt; j) != <span class="hljs-number">0</span> &amp;&amp; (bj == -<span class="hljs-number">1</span> || dp[cur][bj] + dist[bj][last] &gt; dp[cur][j] + dist[j][last])) &#123;<br>                    bj = j;<br>                &#125;<br>            &#125;<br>            order[i] = bj;<br>            cur ^= <span class="hljs-number">1</span> &lt;&lt; bj;<br>            last = bj;<br>        &#125;<br>        System.out.println(Arrays.toString(order));<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>    <span class="hljs-comment">// Usage example</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span>[][] dist = &#123; &#123; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span> &#125;, &#123; <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span> &#125;,<br>                &#123; <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span> &#125; &#125;;<br>        System.out.println(<span class="hljs-number">5</span> == getShortestHamiltonianCycle(dist));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>参考<br><a href="http://codeforces.com/blog/entry/337" target="_blank" rel="noopener">http://codeforces.com/blog/entry/337</a></p><p><a href="http://acm.nudt.edu.cn/~twcourse/DynamicProgramming.html" target="_blank" rel="noopener">http://acm.nudt.edu.cn/~twcourse/DynamicProgramming.html</a></p><p><a href="http://www.csie.ntnu.edu.tw/~u91029/AlgorithmDesign2.html" target="_blank" rel="noopener">http://www.csie.ntnu.edu.tw/~u91029/AlgorithmDesign2.html</a></p>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>UW 软硬件接口lab3 bufbomb</title>
      <link href="/2014/08/02/UW-%E8%BD%AF%E7%A1%AC%E4%BB%B6%E6%8E%A5%E5%8F%A3lab3-bufbomb/"/>
      <url>/2014/08/02/UW-%E8%BD%AF%E7%A1%AC%E4%BB%B6%E6%8E%A5%E5%8F%A3lab3-bufbomb/</url>
      <content type="html"><![CDATA[<p>本实验即常见的缓冲区溢出攻击。（注：新的 64bit Win8/Linux 下这种简单方式无效，x86_64 cpu 的可执行标志位 exec-shield，gcc 栈保护选项开关 -fno-stack-protector）</p><p>主函数为 test()，首先声明一个局部变量 volatile int local = 0xdeadbeef，volatile 是编译时不使用 register 优化，必须分配栈空间，后面的实验过程不能覆盖这个 local 变量。</p><p>然后就是存在缓冲区溢出漏洞的 getbuf 函数，也就是我们要操作的对象。<a id="more"></a></p><h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p>getbuf 函数</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs undefined">(gdb)p $rbp<br>$1 = (void *) 0x7fffffffb730<br>(gdb)p $rsp<br>$2 = (void *) 0x7fffffffb700<br>(gdb)p &amp;buf<br>$3 = (char (*)[36]) 0x7fffffffb700<br></code></pre></td></tr></table></figure><p>&amp;buf 到 %rbp 距离 48(0x30) Byte，加上 old %rbp 和 return address，一共 64 Byte</p><p>smoke.txt 内容应该是<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs undefined">48 Byte 无意义内容<br>8 Byte old %rbp<br>8 Byte smoke 函数地址  (intel 是 little endian)<br></code></pre></td></tr></table></figure></p><h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><p>fizz 函数一共有7个参数，前6个进 register，最后一个参数 val 进栈</p><p>fizz.txt 内容应该是<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined">48 Byte 无意义内容<br>8 Byte old %rbp<br>8 Byte fizz 函数地址<br>8 Byte fizz 函数返回地址(这个可以是任意值)<br>8 Byte val 参数值 (makecookie得到的值)<br></code></pre></td></tr></table></figure></p><h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>修改全局变量 global_value 等于 cookie，并跳转到指定函数 bang</p><p>bang.txt 内容应该是<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs undefined">指令代码<br>填充够 48 Byte 无意义内容<br>8 Byte old %rbp<br>8 Byte buff 首地址<br></code></pre></td></tr></table></figure></p><p>bang.s<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">movq 0x602320, %r9<br>movq %r9, 0x602308<br>pushq $0x401020<br>retq<br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> mooc </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>UW 软硬件接口lab2 bomb</title>
      <link href="/2014/08/02/UW-%E8%BD%AF%E7%A1%AC%E4%BB%B6%E6%8E%A5%E5%8F%A3lab2-bomb/"/>
      <url>/2014/08/02/UW-%E8%BD%AF%E7%A1%AC%E4%BB%B6%E6%8E%A5%E5%8F%A3lab2-bomb/</url>
      <content type="html"><![CDATA[<p>本实验是解除二进制炸弹。给你一个二进制可执行文件，运行该文件，你需要在没有任何提示的情况下输入6个password，如果都输入正确，则炸弹被解除（完成了实验）；如果输入错误，则炸弹爆炸（当然不是真爆炸了，需要重做）。<a id="more"></a></p><h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p>x /s $rsi 即可看到比较函数的字符串参数</p><h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><p>输入6个数字，仔细阅读汇编代码，即可发现是比较后三个和前三个是否相等</p><h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>查看sscanf参数 x /s $rsi “%d %d”，输入两个整数</p><p>观察cmpl $0x7 0xc(%rsp)，并且由于sscanf的参数是从后向前压栈，输入两个整数存在 0x8(%rsp), 0xc(%rsp) 两个位置，并且第一个数要不大于7</p><p>下面就是根据第一个输入 switch</p><p>一共8组，输入任何一组都可以</p><p>(0, 535), (1, 926), (2, 214), (3, 339), (4, 119), (5, 352), (6, 919), (7, 412)</p><h2 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h2><p>查看sscanf参数 x /s $rsi “%d”，输入一个整数，要大于 0 ，接着调用 func4，返回结果必须是 0x37</p><p>下面就是分析func4，这是一个递归函数，就是著名的 Fibnacci 数列</p><p>Fib(n) = Fib(n-1) + Fib(n-2)</p><h2 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h2><p>输入两个整数 x, y</p><p>第一个数 %eax = x AND 0xF != 0xF，即第一个数二进制低4位不能全为 1</p><p>mov 0x401ba0(,%rax,4),%eax</p><p>0x401ba0 是数组起始地址，该数组一共有16个数 (gdb)p *0x401ba0@16</p><p>{10, 2, 14, 7, 8, 12, 15, 11, 0, 4, 1, 13, 3, 9, 6, 5}</p><p>phase_5 还原成 C 语言大致如下。要求最终 count = 0xC，r 等于输入的第二个数 y</p><figure class="hljs highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> a[] = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">14</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">phase_5</span><span class="hljs-params">()</span><br></span>&#123;<br><span class="hljs-keyword">int</span> x = ???;  <span class="hljs-comment">/* 0 ~ 14 */</span><br><span class="hljs-keyword">int</span> r = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">do</span> &#123;<br>x = a[x];<br>r += x;<br>++count;<br>&#125; <span class="hljs-keyword">while</span>(x != <span class="hljs-number">15</span>);<br><br>assert(count == <span class="hljs-number">12</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, r);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="第六关"><a href="#第六关" class="headerlink" title="第六关"></a>第六关</h2><p>链表</p>]]></content>
      
      
        <tags>
            
            <tag> mooc </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>leetcode - two-sum</title>
      <link href="/2014/05/04/leetcode---two-sum/"/>
      <url>/2014/05/04/leetcode---two-sum/</url>
      <content type="html"><![CDATA[<p>原题：</p><p>Given an array of integers, find two numbers such that they add up to a specific target number.</p><p>The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2. Please note that your returned answers (both index1 and index2) are not zero-based.</p><p>You may assume that each input would have exactly one solution.</p><p>Input: numbers={2, 7, 11, 15}, target=9</p><p>Output: index1=1, index2=2<br><a id="more"></a></p><p>难点，原数组是未排序，且可能有重复，例如测例</p><p>Input: numbers={0, 1, 4, 0}, target=0</p><p>Output: index1=1, index2=4</p><p>经典的方法，复制数组，排序，两头往中间扫描，找到之后再在原数组来一趟扫描求得原index</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] twoSum(<span class="hljs-keyword">int</span>[] numbers, <span class="hljs-keyword">int</span> target) &#123;<br>        <span class="hljs-keyword">int</span>[] num = numbers.clone();<br>        Arrays.sort(num);<br><br>        <span class="hljs-keyword">int</span> length = numbers.length;<br>        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> right = length - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;<br><br>        ArrayList&lt;Integer&gt; index = <span class="hljs-keyword">new</span> ArrayList&lt;Integer&gt;();<br><br>        <span class="hljs-keyword">while</span> (left &lt; right) &#123;<br>            sum = num[left] + num[right];<br><br>            <span class="hljs-keyword">if</span> (sum == target) &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) &#123;<br>                    <span class="hljs-keyword">if</span> (numbers[i] == num[left]) &#123;<br>                        index.add(i + <span class="hljs-number">1</span>);<br>                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (numbers[i] == num[right]) &#123;<br>                        index.add(i + <span class="hljs-number">1</span>);<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (index.size() == <span class="hljs-number">2</span>) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sum &gt; target) &#123;<br>                --right;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                ++left;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">int</span>[] result = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];<br><br>        result[<span class="hljs-number">0</span>] = index.get(<span class="hljs-number">0</span>);<br>        result[<span class="hljs-number">1</span>] = index.get(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Solution slt = <span class="hljs-keyword">new</span> Solution();<br><br>        <span class="hljs-keyword">int</span>[] numbers = &#123; <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span> &#125;;<br>        <span class="hljs-keyword">int</span> target = <span class="hljs-number">9</span>;<br><br>        <span class="hljs-keyword">int</span>[] index = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];<br><br>        index = slt.twoSum(numbers, target);<br><br>        System.out.println(<span class="hljs-string">"index1="</span> + index[<span class="hljs-number">0</span>] + <span class="hljs-string">", index2="</span> + index[<span class="hljs-number">1</span>]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>暴力的直接用Hash</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] twoSum(<span class="hljs-keyword">int</span>[] numbers, <span class="hljs-keyword">int</span> target) &#123;<br>        <span class="hljs-keyword">int</span>[] indices = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">int</span> len = numbers.length;<br>        Map&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;Integer, Integer&gt;();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">if</span> (!map.containsKey(numbers[i])) &#123;<br>                map.put(target - numbers[i], i);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                indices[<span class="hljs-number">0</span>] = map.get(numbers[i]) + <span class="hljs-number">1</span>;<br>                indices[<span class="hljs-number">1</span>] = i + <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> indices;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>设计模式之工厂模式(Java实现)</title>
      <link href="/2014/02/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F(java%E5%AE%9E%E7%8E%B0)/"/>
      <url>/2014/02/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F(java%E5%AE%9E%E7%8E%B0)/</url>
      <content type="html"><![CDATA[<p>GoF 经典定义：Define an interface for creating an object, but let subclasses decide which class to initiate. Factory Method lets a class defer instantiation to subclasses.(定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到子类。)<a id="more"></a></p><p>通用UML图</p><p><img src="/img/Factory01.svg" alt="Factory UML"></p><h2 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h2><p>产品类<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteProduct1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Product</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">"invoke ConcreteProduct1 method!"</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteProduct2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Product</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">"invoke ConcreteProduct2 method!"</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>产品工厂<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Factory</span> </span>&#123;<br><span class="hljs-function">Product <span class="hljs-title">createProduct</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product1Factory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Factory</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> Product <span class="hljs-title">createProduct</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConcreteProduct1();<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product2Factory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Factory</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> Product <span class="hljs-title">createProduct</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConcreteProduct2();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>客户<br><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Product p1 = <span class="hljs-keyword">new</span> Product1Factory().createProduct();<br>Product p2 = <span class="hljs-keyword">new</span> Product2Factory().createProduct();<br><br>p1.method();<br>p2.method();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>输出<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">invoke ConcreteProduct1 method!<br>invoke ConcreteProduct2 method!<br></code></pre></td></tr></table></figure></p><h2 id="参数化工厂"><a href="#参数化工厂" class="headerlink" title="参数化工厂"></a>参数化工厂</h2><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParamFactory</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> Product <span class="hljs-title">createProduct</span><span class="hljs-params">(String cName)</span> <span class="hljs-keyword">throws</span> NotImplementProduct </span>&#123;<br><span class="hljs-keyword">if</span> (cName.compareTo(<span class="hljs-string">"ConcreteProduct1"</span>) == <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConcreteProduct1();<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cName.compareTo(<span class="hljs-string">"ConcreteProduct2"</span>) == <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConcreteProduct2();<br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementProduct(cName);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>上述方法需要添加新具体类时需要修改工厂代码，如果充分实现OO，可以使用泛型，代码如下。</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Creator</span> </span>&#123;<br>&lt;T extends Product&gt; <span class="hljs-function">T <span class="hljs-title">createProduct</span><span class="hljs-params">(Class&lt;T&gt; c)</span></span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductCreator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Creator</span> </span>&#123;<br><span class="hljs-keyword">public</span> &lt;T extends Product&gt; <span class="hljs-function">T <span class="hljs-title">createProduct</span><span class="hljs-params">(Class&lt;T&gt; c)</span> </span>&#123;<br>Product product = <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">try</span> &#123;<br>product = (Product) Class.forName(c.getName()).newInstance();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>&#125;<br><br><span class="hljs-keyword">return</span> (T)product;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Creator creator = <span class="hljs-keyword">new</span> ProductCreator();<br>Product p1 = creator.createProduct(ConcreteProduct1.class);<br>Product p2 = creator.createProduct(ConcreteProduct2.class);<br><br><br>p1.method();<br>p2.method();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以更简单一点，取消工厂接口(基类)，将工厂方法定义为静态方法，这种模式适合小模块使用。如果具体产品类构造函数复杂，还是采用第一种模式为佳。</p><h2 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h2><p>延迟初始化(Lazy Initialization)是工厂模式的一个扩展应用，一个对象被消费完毕后，并不立刻释放，工厂类保持其初始状态，等待再次被使用。</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyFactory</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Product&gt; pMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Product<br><span class="hljs-title">createProduct</span><span class="hljs-params">(String type)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>Product product = <span class="hljs-keyword">null</span>;<br><br><span class="hljs-keyword">if</span> (pMap.containsKey(type)) &#123;<br>product = pMap.get(type);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"ConcreteProduct1"</span>)) &#123;<br>product = <span class="hljs-keyword">new</span> ConcreteProduct1();<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"ConcreteProduct2"</span>)) &#123;<br>product = <span class="hljs-keyword">new</span> ConcreteProduct2();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementProduct(type);<br>&#125;<br>pMap.put(type, product);<br>&#125;<br><br><span class="hljs-keyword">return</span> product;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="抽象工厂方法"><a href="#抽象工厂方法" class="headerlink" title="抽象工厂方法"></a>抽象工厂方法</h2><p>上述的简单扩展</p>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> design pattern </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcat 编码设定</title>
      <link href="/2014/02/16/tomcat-%E7%BC%96%E7%A0%81%E8%AE%BE%E5%AE%9A/"/>
      <url>/2014/02/16/tomcat-%E7%BC%96%E7%A0%81%E8%AE%BE%E5%AE%9A/</url>
      <content type="html"><![CDATA[<p>大部分网上文章都是Connector标签里面添加 URIEncoding=”utf-8”，这种方法过于暴力。</p><p>正确的做法是添加 useBodyEncodingForURI=”true”，这句的话告诉tomcat用页面的编码去处理post，推荐使用。</p><p>JSP页面头</p><pre><code>&lt;%@ page language=&quot;java&quot;  pageEncoding=&quot;UTF-8&quot;%&gt;</code></pre><p>html标签的head标签里加上</p><pre><code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</code></pre>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Eclipse中使用Maven Tomcat构建Web应用</title>
      <link href="/2014/02/08/eclipse%E4%B8%AD%E4%BD%BF%E7%94%A8maven-tomcat%E6%9E%84%E5%BB%BAweb%E5%BA%94%E7%94%A8/"/>
      <url>/2014/02/08/eclipse%E4%B8%AD%E4%BD%BF%E7%94%A8maven-tomcat%E6%9E%84%E5%BB%BAweb%E5%BA%94%E7%94%A8/</url>
      <content type="html"><![CDATA[<h2 id="建立web应用"><a href="#建立web应用" class="headerlink" title="建立web应用"></a>建立web应用</h2><p>使用eclipse建立maven的web工程</p><h2 id="配置web工程"><a href="#配置web工程" class="headerlink" title="配置web工程"></a>配置web工程</h2><p>完善目录</p><p>让目录变成标准的maven结构，增加Maven项目必要的主目录（src/main/java）和测试目录（src/test/java）。<br><a id="more"></a><br>参考 <a href="http://blog.rockcms.com/archives/159" target="_blank" rel="noopener">http://blog.rockcms.com/archives/159</a></p><h2 id="配置tomcat-maven"><a href="#配置tomcat-maven" class="headerlink" title="配置tomcat maven"></a>配置tomcat maven</h2><p>tomcat 添加用户</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">role</span> <span class="hljs-attr">rolename</span>=<span class="hljs-string">"manager-gui"</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">role</span> <span class="hljs-attr">rolename</span>=<span class="hljs-string">"admin-gui"</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span> <span class="hljs-attr">password</span>=<span class="hljs-string">"admin"</span> <span class="hljs-attr">roles</span>=<span class="hljs-string">"manager-gui,manager-script,admin-gui"</span> <span class="hljs-attr">username</span>=<span class="hljs-string">"admin"</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>maven settings.xml添加</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>tomcat7<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="配置-Eclipse-项目"><a href="#配置-Eclipse-项目" class="headerlink" title="配置 Eclipse 项目"></a>配置 Eclipse 项目</h2><p>Preferences -&gt; Maven -&gt; Installations</p><p>不使用内置maven，使用我们自己安装的maven</p><p>项目 pom.xml</p><p><a href="http://tomcat.apache.org/maven-plugin.html" target="_blank" rel="noopener">http://tomcat.apache.org/maven-plugin.html</a></p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>SimpleDB<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://localhost:8080/manager/text<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span>tomcat7<span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>/simpledb<span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>eclipse Debug Configuration</p><p><img src="/img/em01.jpg" alt="eclipse maven"></p><p>浏览器访问 <a href="http://127.0.0.1:8080/simpledb/" target="_blank" rel="noopener">http://127.0.0.1:8080/simpledb/</a></p><h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p>pom.xml</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>src/main/java 下载创建名为 TestServlet 的jave类</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.simpledb;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestServlet</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span><br></span>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br>  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req,HttpServletResponse res)</span><br>                 <span class="hljs-keyword">throws</span> ServletException, IOException<br>  </span>&#123;<br>    String hello=<span class="hljs-string">"Test : Hello April!"</span>;<br>    System.out.print(hello);<br>    res.getWriter().write(hello);<br>  &#125;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req,HttpServletResponse res)</span><br>                 <span class="hljs-keyword">throws</span> ServletException, IOException<br>  </span>&#123;<br>    doPost(req, res);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>src/main/webapp/WEB-INF/web.xml</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;web-app&gt;<br>  &lt;display-name&gt;simpledb&lt;/display-name&gt;<br>  &lt;servlet&gt;<br>    &lt;servlet-name&gt;test&lt;/servlet-name&gt;<br>    &lt;servlet-class&gt;com.example.TestServlet&lt;/servlet-class&gt;<br>  &lt;/servlet&gt;<br>  &lt;servlet-mapping&gt;<br>    &lt;servlet-name&gt;test&lt;/servlet-name&gt;<br>    &lt;url-pattern&gt;/test&lt;/url-pattern&gt;<br>  &lt;/servlet-mapping&gt;<br>  &lt;welcome-file-list&gt;<br>    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;<br>    &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;<br>    &lt;welcome-file&gt;index.shtml&lt;/welcome-file&gt;<br>    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;<br>  &lt;/welcome-file-list&gt;<br>&lt;/web-app&gt;<br></code></pre></td></tr></table></figure><p>浏览器访问 <a href="http://127.0.0.1:8080/simpledb/test" target="_blank" rel="noopener">http://127.0.0.1:8080/simpledb/test</a></p><h2 id="直接在-Tomcat-下部署并调试"><a href="#直接在-Tomcat-下部署并调试" class="headerlink" title="直接在 Tomcat 下部署并调试"></a>直接在 Tomcat 下部署并调试</h2><p>进入 conf\Catalina\localhost 目录，添加simpledb.xml文件</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Context</span>  <span class="hljs-attr">path</span>=<span class="hljs-string">"/simpledb"</span> <span class="hljs-attr">docBase</span>=<span class="hljs-string">"D:\code\java\simpledb\src\main\webapp"</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">reloadable</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">privileged</span>=<span class="hljs-string">"true"</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>现在可以点击<img src="/img/em02.png" alt="tomcat maven">来运行和调试maven的web工程了</p><p>注：如果遇到 Fatal error compiling: tools.jar not found: C:\Program Files\Java\jre7..\lib\tools.jar 错误，注意 JAVA_HOME 要设置为 JDK_HOME，或者在eclipse里</p><pre><code>Step 1 : Right Click on Eclipse project PropertiesStep 2 : Java Build Path &gt;LibrariesStep 3 : Click on JRE &gt; Edit &gt; Installed JREStep 4 : Edit Jre &gt; Set JRE Home = JDK_HOME</code></pre>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Maven 入门</title>
      <link href="/2014/02/08/maven-%E5%85%A5%E9%97%A8/"/>
      <url>/2014/02/08/maven-%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<p>Maven是构建Java应用的优秀管理工具，是Apache软件基金会的顶级项目。基于项目对象模型（缩写：POM）概念，Maven利用一个中央信息片断能管理一个项目的构建、报告和文档等步骤。</p><p>官网地址  <a href="http://maven.apache.org/" target="_blank" rel="noopener">http://maven.apache.org/</a> <a id="more"></a></p><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>Windows 添加环境变量 M2_HOME -&gt; D:\JavaApp\apache-maven-3.0.5（改成自己的哦）</p><p>在Path中加入 ;%M2_HOME%\bin</p><p>修改依赖包下载保存位置</p><p>默认是 ~/.m2/repository，修改M2_HOME/conf/settings.xml</p><localrepository>/path/to/local/repo</localrepository><h2 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h2><h3 id="使用命令行"><a href="#使用命令行" class="headerlink" title="使用命令行"></a>使用命令行</h3><p>没有定制之前，所有的项目都有如下的结构</p><table><thead><tr><th>目录</th><th>目的</th></tr></thead><tbody><tr><td>${basedir}</td><td>存放 pom.xml和所有的子目录</td></tr><tr><td>${basedir}/src/main/java</td><td>项目的 java源代码</td></tr><tr><td>${basedir}/src/main/resources</td><td>项目的资源，比如说 property文件</td></tr><tr><td>${basedir}/src/test/java</td><td>项目的测试类，比如说 JUnit代码</td></tr><tr><td>${basedir}/src/test/resources</td><td>测试使用的资源</td></tr></tbody></table><p>接下来我们用 maven 来建立最著名的“Hello World!”程序 :)</p><pre><code>mvn archetype:generate [-DgroupId=com.mycompany.helloworld -DartifactId=helloworld -Dpackage=com.mycompany.helloworld -Dversion=1.0-SNAPSHOT]</code></pre><p>archetype:generate 目标会列出一系列的 archetype 让你选择。 Archetype 可以理解成项目的模型。 Maven 为我们提供了很多种的项目模型，包括从简单的 Swing 到复杂的 Web 应用。我们选择默认的 maven-archetype-quickstart (类型太多，看得眼花，可以加上 -DarchetypeCatalog=internal)。回车，这时候让你确定项目属性的配置</p><p>maven 的 archetype 插件建立了一个 helloworld 目录，这个名字来自 artifactId 。在这个目录下面，有一个 Project Object Model(POM) 文件 pom.xml 。这个文件用于描述项目，配置插件和管理依赖关系。源代码和资源文件放在 src/main 下面，而测试代码和资源放在 src/test 下面。</p><p>Maven 已经为我们建立了一个 App.java 文件</p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.mycompany.helloworld;<br><br><span class="hljs-comment">/**<br> * Hello world!<br> *<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <br></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">( String[] args )</span><br>    </span>&#123;<br>        System.out.println( <span class="hljs-string">"Hello World!"</span> );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>开始构建</p><pre><code>cd helloworldmvn package</code></pre><p> 这个时候， maven 在 helloworld 下面建立了一个新的目录 target/ ，构建打包后的 jar 文件 helloworld-1.0-SNAPSHOT.jar 就存放在这个目录下。编译后的 class 文件放在 target/classes/ 目录下面，测试 class 文件放在 target/test-classes/ 目录下面。</p><p> 为了验证我们的程序能运行，执行下面的命令</p><pre><code>java -cp target/helloworld-1.0-SNAPSHOT.jar com.mycompany.helloworld.App</code></pre><h3 id="使用-eclipse"><a href="#使用-eclipse" class="headerlink" title="使用 eclipse"></a>使用 eclipse</h3><p>Maven天生就对Eclipse做了集成，我们使用mvn eclipse:eclipse就得到了一个Eclipse的项目结构，在Eclipse中使用import功能就能直接导入到IDE中了。</p><p>安装eclipse插件 Maven Integration for Eclipse，新版eclispe可以从eclipse market中直接安装，旧版的源地址为</p><p><a href="http://download.eclipse.org/technology/m2e/releases" target="_blank" rel="noopener">http://download.eclipse.org/technology/m2e/releases</a></p><h2 id="Maven基础概念"><a href="#Maven基础概念" class="headerlink" title="Maven基础概念"></a>Maven基础概念</h2><h3 id="POM-Project-Object-Model"><a href="#POM-Project-Object-Model" class="headerlink" title="POM (Project Object Model)"></a>POM (Project Object Model)</h3><p>一个项目所有的配置都放置在 POM 文件中：定义项目的类型、名字，管理依赖关系，定制插件的行为等等。比如说，你可以配置 compiler 插件让它使用 java 1.5 来编译。</p><p>在 POM 中，groupId, artifactId, packaging, version 叫作 maven 坐标，它能唯一的确定一个项目。有了 maven 坐标，我们就可以用它来指定我们的项目所依赖的其他项目，插件，或者父项目。一般 maven 坐标写成如下的格式：</p><pre><code>groupId:artifactId:packaging:version</code></pre><p>大项目一般会分成几个子项目。在这种情况下，每个子项目就会有自己的 POM 文件，然后它们会有一个共同的父项目。这样只要构建父项目就能够构建所有的子项目了。子项目的 POM 会继承父项目的 POM。另外，所有的 POM都继承了一个 Super-POM。Super-POM 设置了一些默认值。果你想看到运行时候的 POM 的全部内容的话，可以运行下面的命令</p><pre><code>mvn help:effective-pom</code></pre><h3 id="Maven-插件"><a href="#Maven-插件" class="headerlink" title="Maven 插件"></a>Maven 插件</h3><p>在上文中，我们用了 mvn archetype:generate 命令来生成一个项目。那么这里的 archetype:generate 是什么意思呢？archetype 是一个插件的名字，generate是目标(goal)的名字。这个命令的意思是告诉 maven 执行 archetype 插件的 generate 目标。插件目标通常会写成 pluginId:goalId</p><p>一个目标是一个工作单元，而插件则是一个或者多个目标的集合。比如说Jar插件，Compiler插件，Surefire插件等。从看名字就能知道，Jar 插件包含建立Jar文件的目标， Compiler 插件包含编译源代码和单元测试代码的目标。Surefire 插件的话，则是运行单元测试。</p><h3 id="Maven-生命周期"><a href="#Maven-生命周期" class="headerlink" title="Maven 生命周期"></a>Maven 生命周期</h3><p>我们用的第二个命令是：mvn package。这里的 package 是一个maven的生命周期阶段 (lifecycle phase )。生命周期指项目的构建过程，它包含了一系列的有序的阶段 (phase)，而一个阶段就是构建过程中的一个步骤。</p><p>那么生命周期阶段和上面说的插件目标之间是什么关系呢？插件目标可以绑定到生命周期阶段上。一个生命周期阶段可以绑定多个插件目标。当 maven 在构建过程中逐步的通过每个阶段时，会执行该阶段所有的插件目标。</p><p>maven 能支持不同的生命周期，但是最常用的是默认的Maven生命周期 (default Maven lifecycle )。如果你没有对它进行任何的插件配置或者定制的话，那么上面的命令 mvn package 会依次执行默认生命周期中直到包括 package 阶段前的所有阶段的插件目标：</p><pre><code>process-resources 阶段：resources:resourcescompile 阶段：compiler:compileprocess-classes 阶段：(默认无目标)process-test-resources 阶段：resources:testResourcestest-compile 阶段：compiler:testCompiletest 阶段：surefire:testprepare-package 阶段：(默认无目标)package 阶段：jar:jar</code></pre><h3 id="Maven-依赖管理"><a href="#Maven-依赖管理" class="headerlink" title="Maven 依赖管理"></a>Maven 依赖管理</h3><p>maven 坐标能够确定一个项目。换句话说，我们可以用它来解决依赖关系。在 POM 中，依赖关系是在 dependencies 部分中定义的。</p><p>在 POM 的 dependencies 部分中，scope 决定了依赖关系的适用范围。我们的例子中 junit 的 scope 是 test，那么它只会在执行 compiler:testCompile and surefire:test 目标的时候才会被加到 classpath 中，在执行 compiler:compile 目标时是拿不到 junit 的。</p><p>我们还可以指定 scope 为 provided，意思是 JDK 或者容器会提供所需的jar文件。比如说在做web应用开发的时候，我们在编译的时候需要 servlet API jar 文件，但是在打包的时候不需要把这个 jar 文件打在 WAR 中，因为servlet容器或者应用服务器会提供的。</p><p>scope 的默认值是 compile，即任何时候都会被包含在 classpath 中，在打包的时候也会被包括进去。</p><h3 id="Maven-库"><a href="#Maven-库" class="headerlink" title="Maven 库"></a>Maven 库</h3><p>当 maven 查找需要的 jar 文件时，它会先在本地库中寻找，只有在找不到的情况下，才会去远程库中找。</p><p>运行下面的命令能把我们的 helloworld 项目安装到本地库</p><pre><code>mvn install</code></pre><p>一旦一个项目被安装到了本地库后，你别的项目就可以通过 maven 坐标和这个项目建立依赖关系。比如如果我现在有一个新项目需要用到 helloworld，那么在运行了上面的 mvn install 命令后，我就可以如下所示来建立依赖关系</p><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mycompany.helloworld<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>helloworld<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>用Python秒掉八皇后问题</title>
      <link href="/2014/01/09/%E7%94%A8python%E7%A7%92%E6%8E%89%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/"/>
      <url>/2014/01/09/%E7%94%A8python%E7%A7%92%E6%8E%89%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>来源：<a href="http://www.iteye.com/topic/106747" target="_blank" rel="noopener">http://www.iteye.com/topic/106747</a></p><p>在 <a href="http://www.iteye.com/topic/101055" target="_blank" rel="noopener">函数式编程语言曲高和寡？</a> 一文中，我们看到 Haskell 能用两行代码</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">sort [] = []<br>sort (x:xs) = sort [y | y &lt;- xs, y &lt; x] ++ [x] ++ sort [y | y &lt;- xs, y &gt;= x]<br></code></pre></td></tr></table></figure><p>搞定快速排序算法。这是偶然，还是必然？在这篇文章中，lichray 用我们所熟悉的 Python 语言，几行代码搞定很多学编程几年的人都只是一知半解的算法——八皇后问题，展示和上篇文章中的快速排序一样清晰的、令人耳目一新的函数式算法思想。<a id="more"></a></p><h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><p>这一部分对于那些 Python 老手和已经知道八皇后问题定义的程序员来说是多余的。 </p><p>八皇后问题（摘自 SICP ed2 中文版 P84 练习2.42）<br>　　<br>“八皇后谜题”问的是怎样将八个皇后摆在国际象棋棋盘上，使得任意一个皇后都不能攻击另一个皇后（也就是说，任意两个皇后都不在同一行、同一列或者同一对角线上）。</p><p>在这篇文章中，我们要解决的问题比这个范围还要更广一点，即：允许棋盘是 n × m 大小的。也就是说，所谓的 n 皇后问题只是我们给出的程序的 n ＝ m 时的版本。不过别担心，函数式编程的力量就在于抽象等级的空前提高，问题越抽象，解决起来越顺手。<br>　　<br>列表领悟特性 </p><p>现在应该绝大多数动态语言的程序员都对这个特性很了解了，因为常见的 Python, Ruby, ErLang, Haskell 甚至是 JavaScript 都加上了这个特性。这是一种通过给出列表中每一项的形式和组成形式的元素要满足的条件自动生成列表的语法糖。下面是 Python 中的两个例子：<br><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 得到一个 2 到 20 中的偶数组成的列表，只要写</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>[x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>, <span class="hljs-number">21</span>) <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]<br>[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">14</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">20</span>]<br><br><span class="hljs-comment"># 记住，只需给出一个形式，比方说想求两个列表的“笛卡尔乘积”</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>[(x , y) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>) <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]]<br></code></pre></td></tr></table></figure></p><p>很明显，仅仅使用列表领悟特性就可以表示一些算法了，比如提到过的快速排序： </p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sort</span> <span class="hljs-params">(ls)</span>:</span> <br>　　<span class="hljs-keyword">return</span> [] <span class="hljs-keyword">if</span> ls == [] \<br>　　　<span class="hljs-keyword">else</span> sort([y <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> ls[<span class="hljs-number">1</span>:] <span class="hljs-keyword">if</span> y &lt; ls[<span class="hljs-number">0</span>]]) + \<br>　　　[ls[<span class="hljs-number">0</span>]] + \<br>　　　sort([y <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> ls[<span class="hljs-number">1</span>:] <span class="hljs-keyword">if</span> y &gt;= ls[<span class="hljs-number">0</span>]])<br>　　<span class="hljs-comment"># 别忘了 python-2.5 的新特性条件分支表达式哦！可惜太长，不得不强制换行。</span><br>``` <br><br><span class="hljs-comment">## 算法描述</span><br><br>首先我们要认识到一点，算法所对应的函数的输入和输出分别是什么。我们需要的是一个函数 queens()，它接受两个参数，自然数 row 和 col，分别表示行数和列数；坐标是 (col, row) 形式的序对，下标 从 <span class="hljs-number">0</span> 开始计数。<br>　　　　<br>我们把输出的结果表示为棋盘格局描述组成的列表。那棋盘格局呢？难道表示为所有棋子的坐标，像 [(<span class="hljs-number">5</span>,<span class="hljs-number">0</span>), (<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), (<span class="hljs-number">0</span>,<span class="hljs-number">2</span>),(<span class="hljs-number">6</span>,<span class="hljs-number">3</span>), (<span class="hljs-number">4</span>,<span class="hljs-number">4</span>), (<span class="hljs-number">7</span>,<span class="hljs-number">5</span>), (<span class="hljs-number">1</span>,<span class="hljs-number">6</span>), (<span class="hljs-number">3</span>,<span class="hljs-number">7</span>)] ？不需要吧，看也能看出来，完全可以使得下标 col、row 中有一个是有序排列的。在这里，我们认为 row 是有序的，对于上面的例子，只须表示为 [<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>] 即可，row 是一个解的下标。<br><br>那么，整个函数的输出就应该类似这样：[[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>]]；这是 queens(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>) 的输出结果。 <br><br>归纳法定义<br><br>什么是归纳法定义？回忆一下经典的求级数例程是怎么写出来的。我们根据数学归纳法得到：<br><br>    f (<span class="hljs-number">0</span>) = <span class="hljs-number">1</span> <br>    f (n) = <span class="hljs-number">1</span> + f (n - <span class="hljs-number">1</span>) <br><br>然后把这些抄成编程语言的形式。对于函数 queens 也是这样，我们要确定这个函数的递归下界和递推表示。 <br><br>递归下界很好办，就是 queens(n,<span class="hljs-number">0</span>) （此处 n 忽略，因为不影响结果）的输出结果。对于一个没有列数的棋盘，只有一个解，空解 []；同时，输出的解集也只有这一个元素，为 [[]]（下面的数学定义使用了集合表示代替列表）。<br><br>递推表示是什么呢？我们可以在纸上画画图，不难发现，对于一个解，你画出的最后一个位置就是在前面已画出的少一个棋子的格局的基础上再加一个位置安全的棋子。设这个“加”函数为 g (x,y)，“安全”函数为 s (x,y)。那么 <br><br>    f (n,m) = &#123;g (x,y) | x ∈ [<span class="hljs-number">0</span>, n], y ∈ f (n,m<span class="hljs-number">-1</span>) s (x,y) = true&#125; <br><br>形式化的思考：<br><br>有了上面的数学定义，抄成 Python 代码，那就是用脚趾都能搞定呀。<br>```python<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">queens</span> <span class="hljs-params">(row, col)</span>:</span><br>　　<span class="hljs-keyword">return</span> [[]] <span class="hljs-keyword">if</span> col == <span class="hljs-number">0</span> \<br>　　　<span class="hljs-keyword">else</span> [[ran] + rst \  <span class="hljs-comment"># 在 Python 中，g(x,y)=[x]+y </span><br>　　　<span class="hljs-keyword">for</span> ran <span class="hljs-keyword">in</span> range(row) \<br>　　　<span class="hljs-keyword">for</span> rst <span class="hljs-keyword">in</span> queens(row, col - <span class="hljs-number">1</span>) \<br>　　　<span class="hljs-keyword">if</span> safe(ran, rst)]<br></code></pre></td></tr></table></figure><p>不难看出，有了列表领悟这个强大的武器，我们就可以放心大胆地利用描述一个元素形式的思路来解决这类列表输出的问题。这就是列表领悟最根本的思想：“形式化的思维方式”。 </p><p>现在只剩一个问题了：safe() 函数。先应用一次我们的“图形化的思考”。对一个格局（解，rst）来说，新加入的棋子的 col 值 ran 必须对这个格局中所有已存在的位置满足一个测试 check()，这个测试对于一个位置 (x,y)，要求（col 值不等已自动满足） ran ≠ x and |ran - x| ≠ y + 1。</p><p>an ≠ x 很好理解，就是不为同一列；|ran - x| ≠ y + 1 则意味着左右不在同一斜线上。</p><p>由于这里要同时用到 rst 中点的 col 值和 row 值，这样解决：在前文的算法描述中已经指出，因为 row 值被认为是有序的，事实上是一个解的下标，我们 check 一下这个下标，在 check() 的过程中去获取 col 值不就行了？</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">　　<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span> <span class="hljs-params">(pos)</span>:</span><br>　　　　<span class="hljs-comment"># 表达式变个形式，少打点字</span><br>　　　　<span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> (ran == rst[pos] <span class="hljs-keyword">or</span> abs(ran - rst[pos]) == pos + <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>值得注意的是，由于这里 check() 用到了逃逸变量 ran 和 rst，check 函数体就必须写在 safe() 函数体内部以使这它们在其闭包环境中出现。</p><p>safe() 函数也就很明了了：先生成一个由全部 check(pos), pos ∈ [0, #rst] 结果组成的列表，然后判断一下这个列表中每一项是否都为真。假设我们已得到这样的一种测试一个列表中元素是否全为 True 的函数叫 ands()。</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe</span> <span class="hljs-params">(ran, rst)</span>:</span><br>　　<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span> <span class="hljs-params">(pos)</span>:</span><br>　　　　<span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> (ran == rst[pos] <span class="hljs-keyword">or</span> abs(ran - rst[pos]) == pos + <span class="hljs-number">1</span>)<br>　　<span class="hljs-keyword">return</span> ands([check(pos) <span class="hljs-keyword">for</span> pos <span class="hljs-keyword">in</span> range(len(rst))])<br></code></pre></td></tr></table></figure><p>前文已经说明，ands() 函数接受一个列表为参数，如果列表中每一项都为 True 则返回 True，否则返回 False。还是直接把数学定义抄一遍</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ands</span> <span class="hljs-params">(ls)</span>:</span><br>　　<span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span> <span class="hljs-keyword">if</span> ls == [] \<br>　　　<span class="hljs-keyword">else</span> (<span class="hljs-keyword">False</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ls[<span class="hljs-number">0</span>] \<br>　　　<span class="hljs-keyword">else</span> ands(ls[<span class="hljs-number">1</span>:]))<br></code></pre></td></tr></table></figure><p>于是，我们的程序就写完啦！试着跑一下 queens(4,4)，</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>queens(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>)<br>[[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>]]<br></code></pre></td></tr></table></figure><p>没问题！再跑一下 queens(8,8)！奇怪，为什么跑了 10 分钟还没出结果？</p><p>问题在哪儿： </p><p>拙劣的列表领悟实现。Python 在处理列表领悟时，一方面把“形式”部分封装为一个函数，然后找出所有未知数的列表，组装成一个大的矩阵，然后对矩阵中的每一项应用该函数。问题出在哪儿？先生成了所有项，占用了过多的空间。如果在 Haskell 里面，这样做是无所谓的，因为惰性的列表会生成一点，计算一点，抛弃一点，输出一点；但这对于严格（采用应用序求值）的命令式语言 Python 来说，这种实现仅仅是玩具级的。 </p><p>其实，列表领悟不仅仅是一个语法糖，在严格的语言实现它需要一定技巧：首先分析未知数对于的列表的计算所消耗时间（数据流分析 call 的次数），把计算耗时最多的列表应用群体操作，对结果的每一项应用产生下一个列表的群体操作，依此类推，只要产生一个包含所有未知数的序对就应用包装好的函数。空泛的讲这些用处不大，下面我们手工把这个该死的程序救活。</p><p>通用列表操作：<br>　　关键在于处理掉这一句：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">[[ran] + rst \<br>　　　<span class="hljs-keyword">for</span> ran <span class="hljs-keyword">in</span> range(row) \<br>　　　<span class="hljs-keyword">for</span> rst <span class="hljs-keyword">in</span> queens(row, col - <span class="hljs-number">1</span>) \<br>　　　<span class="hljs-keyword">if</span> safe(ran, rst)]<br></code></pre></td></tr></table></figure><p>首先对最耗时的列表 queens(row, col - 1) 应用群体操作 flatmap(newcol, queens(row, col - 1))。这里需要注意的是，光用 map() 是不够的，因为下面会根据另一个列表 rang(row) 中的每一项产生一个新列表，导致多出一个列表层。所以我们需要用 flatmap() 函数，它在普通的 map() 操作之后会用 append() 把产生的列表联结起来（所以叫“展平”的 map），把多出的一层列表消去：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flatmap</span> <span class="hljs-params">(opt, ls)</span>:</span><br>　　<span class="hljs-comment"># 小技巧：累积器在连接列表时可以不用 lambda x,y: x+y，直接用 list.__add__，</span><br>　　<span class="hljs-comment"># 重点是类型出错时有报警</span><br>　　<span class="hljs-keyword">return</span> reduce(list.__add__, map(opt, ls))<br></code></pre></td></tr></table></figure><p>接下来，根据列表和列表生成列表（在通用列表操作的世界中，就是 list, list, and list），注意原来的形式 [ran] + rst 是怎么被函数封装掉的：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">newcol</span> <span class="hljs-params">(rst)</span>:</span><br>　　<span class="hljs-comment"># 顺手解决 filter 只能传递一个参数的限制，用 lambda 代掉</span><br>　　<span class="hljs-keyword">return</span> filter(<span class="hljs-keyword">lambda</span> ls: safe(ls[<span class="hljs-number">0</span>], rst), map(<span class="hljs-keyword">lambda</span> x: [x] + rst, range(row)))<br></code></pre></td></tr></table></figure><p>其它什么内容都不用改了（当然了，如果你有心情，还可以把另一个列表领悟替换掉</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe</span> <span class="hljs-params">(ran, rst)</span>:</span><br>　　<span class="hljs-keyword">return</span> every(check, range(len(rst)))<br><span class="hljs-comment"># every() 函数相当于打过兴奋剂的 ands</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">every</span> <span class="hljs-params">(test, ls)</span>:</span><br>　　<span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span> <span class="hljs-keyword">if</span> ls == [] \<br>　　　<span class="hljs-keyword">else</span> (<span class="hljs-keyword">False</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> test(ls[<span class="hljs-number">0</span>]) \<br>　　　<span class="hljs-keyword">else</span> every(test, ls[<span class="hljs-number">1</span>:]))<br></code></pre></td></tr></table></figure><p>不过单层的列表领悟没有性能问题）。现在可以完美地输出八皇后问题的 92 个解了（这里就不列了，太长了）。</p><p>反思： </p><ul><li>函数式编程的思想描述算法绝对强，无论是列表领悟还是通用列表操作都十分清晰，仿佛能感受到数据在表达式间游动；</li><li>和平起见，就不把我那个传说中的只有一行代码的版本拿来和几十行的命令式风格的代码比较了，但大家应该心领神会；</li><li>有时候，把问题想的简单一些，思维更“形而上学”一些，反而能更快的得到解决问题的思路，顺着思路再改进也不迟；</li><li>Python 的表达式版的分支语句很漂亮，但被该死的换行限制给玷污了；另外列表领悟实现得够烂，眼下只能是玩玩儿。</li></ul><p>最后留个小问题：我们在算法描述一节中提到了一种解的表示方法，把一个格局中所有棋子的坐标表示为序对，然后返回解的列表。请给出一个小函数，把我们现在的实现版本输出的解转换为这种形式。数据的本质是信息。信息的完全是首要的，数据的表示只是个次要问题。 </p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">BOARD_SIZE = <span class="hljs-number">8</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">under_attack</span><span class="hljs-params">(col, queens)</span>:</span><br>    left = right = col<br><br>    <span class="hljs-keyword">for</span> r, c <span class="hljs-keyword">in</span> reversed(queens):<br>        left, right = left - <span class="hljs-number">1</span>, right + <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> (left, col, right):<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">solve</span><span class="hljs-params">(n)</span>:</span><br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> [[]]<br><br>    smaller_solutions = solve(n - <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> [solution+[(n,i+<span class="hljs-number">1</span>)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(BOARD_SIZE)<br>            <span class="hljs-keyword">for</span> solution <span class="hljs-keyword">in</span> smaller_solutions<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> under_attack(i+<span class="hljs-number">1</span>, solution)]<br><br><span class="hljs-keyword">for</span> answer <span class="hljs-keyword">in</span> solve(BOARD_SIZE):<br>    <span class="hljs-keyword">print</span> answer<br></code></pre></td></tr></table></figure><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> permutations <span class="hljs-keyword">as</span> perm<br><br>cols = perm(range(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">OK</span><span class="hljs-params">(s)</span>:</span><br>    sl = set(r - c <span class="hljs-keyword">for</span> r, c <span class="hljs-keyword">in</span> enumerate(s))  <span class="hljs-comment"># r for row</span><br>    bs = set(r + c <span class="hljs-keyword">for</span> r, c <span class="hljs-keyword">in</span> enumerate(s))  <span class="hljs-comment"># c for column</span><br>    <span class="hljs-keyword">return</span> len(sl) == len(bs) == <span class="hljs-number">8</span><br><br>solutions = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cols <span class="hljs-keyword">if</span> OK(c)]<br><br><span class="hljs-keyword">for</span> i, s <span class="hljs-keyword">in</span> enumerate(solutions, <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">print</span> i, <span class="hljs-string">":"</span>, s<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> FP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>String Hash 字符串散列</title>
      <link href="/2014/01/01/string-hash-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%A3%E5%88%97/"/>
      <url>/2014/01/01/string-hash-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%A3%E5%88%97/</url>
      <content type="html"><![CDATA[<p>参考</p><p><a href="http://www.partow.net/programming/hashfunctions/index.html" target="_blank" rel="noopener">http://www.partow.net/programming/hashfunctions/index.html</a></p><p>有人翻译了一下</p><p><a href="http://blog.csdn.net/eaglex/article/details/6310727" target="_blank" rel="noopener">http://blog.csdn.net/eaglex/article/details/6310727</a><br><a id="more"></a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">RSHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> b    = <span class="hljs-number">378551</span>;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a    = <span class="hljs-number">63689</span>;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = hash * a + str[i];<br>      a    = a * b;<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of RS Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">JSHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">1315423911</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash ^= ((hash &lt;&lt; <span class="hljs-number">5</span>) + str[i] + (hash &gt;&gt; <span class="hljs-number">2</span>));<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of JS Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">PJWHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> BitsInUnsignedInt = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>) * <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ThreeQuarters     = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)((BitsInUnsignedInt  * <span class="hljs-number">3</span>) / <span class="hljs-number">4</span>);<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> OneEighth         = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(BitsInUnsignedInt / <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> HighBits          = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-number">0xFFFFFFFF</span>) &lt;&lt; (BitsInUnsignedInt - OneEighth);<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash              = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> test              = <span class="hljs-number">0</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = (hash &lt;&lt; OneEighth) + str[i];<br><br>      <span class="hljs-keyword">if</span>((test = hash &amp; HighBits)  != <span class="hljs-number">0</span>)<br>      &#123;<br>         hash = (( hash ^ (test &gt;&gt; ThreeQuarters)) &amp; (~HighBits));<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of  P. J. Weinberger Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ELFHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x    = <span class="hljs-number">0</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = (hash &lt;&lt; <span class="hljs-number">4</span>) + str[i];<br>      <span class="hljs-keyword">if</span>((x = hash &amp; <span class="hljs-number">0xF0000000</span>L) != <span class="hljs-number">0</span>)<br>      &#123;<br>         hash ^= (x &gt;&gt; <span class="hljs-number">24</span>);<br>      &#125;<br>      hash &amp;= ~x;<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of ELF Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">BKDRHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> seed = <span class="hljs-number">131</span>; <span class="hljs-comment">// 31 131 1313 13131 131313 etc..</span><br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = (hash * seed) + str[i];<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of BKDR Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">SDBMHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = str[i] + (hash &lt;&lt; <span class="hljs-number">6</span>) + (hash &lt;&lt; <span class="hljs-number">16</span>) - hash;<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of SDBM Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">DJBHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">5381</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = ((hash &lt;&lt; <span class="hljs-number">5</span>) + hash) + str[i];<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of DJB Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">DEKHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>&gt;(str.length());<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = ((hash &lt;&lt; <span class="hljs-number">5</span>) ^ (hash &gt;&gt; <span class="hljs-number">27</span>)) ^ str[i];<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of DEK Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">BPHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash = hash &lt;&lt; <span class="hljs-number">7</span> ^ str[i];<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of BP Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">FNVHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> fnv_prime = <span class="hljs-number">0x811C9DC5</span>;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash *= fnv_prime;<br>      hash ^= str[i];<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of FNV Hash Function */</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">APHash</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; str)</span><br></span>&#123;<br>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> hash = <span class="hljs-number">0xAAAAAAAA</span>;<br><br>   <span class="hljs-keyword">for</span>(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; str.length(); i++)<br>   &#123;<br>      hash ^= ((i &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) ? (  (hash &lt;&lt;  <span class="hljs-number">7</span>) ^ str[i] * (hash &gt;&gt; <span class="hljs-number">3</span>)) :<br>                               (~((hash &lt;&lt; <span class="hljs-number">11</span>) + (str[i] ^ (hash &gt;&gt; <span class="hljs-number">5</span>))));<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-comment">/* End Of AP Hash Function */</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MinMaxHeap 最小最大堆</title>
      <link href="/2013/12/23/minmaxheap-%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E5%A0%86/"/>
      <url>/2013/12/23/minmaxheap-%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E5%A0%86/</url>
      <content type="html"><![CDATA[<p>MinMaxHeap，最小最大堆，或称双端优先队列，提供操作</p><ul><li>插入一个数</li><li>取出最小值</li><li>取出最大值<a id="more"></a></li></ul><p>最小最大堆是一棵完全二叉树，且其中每个元素有一个key数据成员。树的各层交替为最小层和最大层。根结点在最小层。设x是最小最大堆的任意结点。若x在最小（最大）层上，则x中的元素的key值在以x为根的子树的所有元素中是最小（最大）的。位于最小（最大）层的结点称为最小（最大）结点。</p><p>1）插入</p><p>和普通的堆一样，先放到堆尾再调整。调整的过程，以插入元素在小根层为例：先和父亲比较，如果大于父亲则和父亲对调，以后在只在大根层作大顶堆调整；否则在小根层作小顶堆调整。</p><p>2）取出最小的数</p><p>也和普通堆相似，取堆头元素并把队尾元素放在堆头再调整堆。以堆头即第一层为小层为例：先和儿子比较（如果有儿子），如果比儿子大（儿子层是大层），和该儿子交换。</p><p>然后，如果有孙子，则在孙子层（小层）4个元素中找出最小的，与之交换，则在该孙子位置的情况和调整开始时堆头的情况是一样的，所以在该位置继续上面的调整过程。</p><p>3）取出最大的数</p><p>以第一层为小层为例：比较堆头的两个儿子谁大，取出作为最大的数，把堆尾元素填到该位置，在该位置开始调整。调整的过程和取出最小数的调整过程是一致的，大小相反。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stddef.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinMaxHeap</span><br>&#123;</span><br><span class="hljs-keyword">public</span>:<br>    MinMaxHeap(<span class="hljs-keyword">int</span> sz)<br>    &#123;<br>        n = <span class="hljs-number">0</span>;<br>        maxSize = sz;<br>        _heap = <span class="hljs-keyword">new</span> T[sz + <span class="hljs-number">1</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T &amp;x)</span></span>;<br>    <span class="hljs-function">T <span class="hljs-title">popMin</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">T <span class="hljs-title">popMax</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printRaw</span><span class="hljs-params">()</span><br>    </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>            <span class="hljs-built_in">cout</span> &lt;&lt; _heap[i] &lt;&lt; <span class="hljs-string">" "</span>;<br>        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">level</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span><br>    </span>&#123;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">int</span>)(<span class="hljs-built_in">log</span>(p * <span class="hljs-number">1.0</span>) / <span class="hljs-built_in">log</span>(<span class="hljs-number">2.0</span>)) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> MAX;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">return</span> MIN;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">VerifyMax</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> T &amp;)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">VerifyMin</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> T &amp;)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MinChildGrandChild</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MaxChildGrandChild</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos)</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    T *_heap;<br>    <span class="hljs-keyword">int</span> maxSize, n;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MIN = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAX = <span class="hljs-number">1</span>;<br>&#125;;<br><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">void</span> MinMaxHeap&lt;T&gt;::push(<span class="hljs-keyword">const</span> T &amp;x )<br>&#123;<br>    <span class="hljs-keyword">if</span> (n == maxSize )<br>    &#123;<br>        <span class="hljs-comment">//MinMaxFull( );</span><br>        <span class="hljs-keyword">throw</span>;<br>    &#125;<br>    n++;<br>    <span class="hljs-keyword">int</span> p = n / <span class="hljs-number">2</span>;     <span class="hljs-comment">//p is new node's parent</span><br>    <span class="hljs-keyword">if</span> (!p)<br>    &#123;<br>        _heap[<span class="hljs-number">1</span>] = x;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">switch</span> (level(p))<br>    &#123;<br>    <span class="hljs-keyword">case</span> MIN:<br>        <span class="hljs-keyword">if</span> (x &lt; _heap[p])             <span class="hljs-comment">// 沿着最小层检查</span><br>        &#123;<br>            _heap[n] = _heap[p];<br>            VerifyMin(p, x);<br>        &#125;<br>        <span class="hljs-keyword">else</span> VerifyMax(n, x);            <span class="hljs-comment">// 沿着最大层检查</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> MAX:<br>        <span class="hljs-keyword">if</span> (x &gt; _heap[p])             <span class="hljs-comment">// 沿着最大层检查</span><br>        &#123;<br>            _heap[n] = _heap[p];<br>            VerifyMax(p, x);<br>        &#125;<br>        <span class="hljs-keyword">else</span> VerifyMin(n, x);             <span class="hljs-comment">// 沿着最小层检查</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;                           <span class="hljs-comment">//switch结束</span><br>&#125;              <span class="hljs-comment">// Insert结束</span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">void</span> MinMaxHeap&lt;T&gt;::VerifyMax(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">const</span> T &amp;x )<br>&#123;<br>    <span class="hljs-comment">// 沿着从最大结点i</span><br>    <span class="hljs-comment">// 到根结点的路径检查最大结点，将x插入正确位置</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> gp = i / <span class="hljs-number">4</span>; gp &amp;&amp; (x &gt; _heap[gp]); gp /= <span class="hljs-number">4</span>)   <span class="hljs-comment">// gp是 i的祖父</span><br>    &#123;<br>        _heap[i] = _heap[gp];             <span class="hljs-comment">// 将_heap[gp]移到_heap[i]</span><br>        i = gp;<br>    &#125;<br>    _heap[i] = x;         <span class="hljs-comment">// 将x插入结点i</span><br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">void</span> MinMaxHeap&lt;T&gt;::VerifyMin(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">const</span> T &amp;x )<br>&#123;<br>    <span class="hljs-comment">// 沿着从最小结点i</span><br>    <span class="hljs-comment">// 到根结点的路径检查最小结点，将x插入正确位置</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> gp = i / <span class="hljs-number">4</span>; gp &amp;&amp; (x &lt; _heap[gp]); gp /= <span class="hljs-number">4</span>)   <span class="hljs-comment">// gp是 i的祖父</span><br>    &#123;<br>        _heap[i] = _heap[gp];             <span class="hljs-comment">// 将_heap[gp]移到_heap[i]</span><br>        i = gp;<br>    &#125;<br>    _heap[i] = x;         <span class="hljs-comment">// 将x插入结点i</span><br>&#125;<br><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Type</span>&gt;<br><span class="hljs-title">int</span> <span class="hljs-title">MinMaxHeap</span>&lt;Type&gt;:</span>:MinChildGrandChild(<span class="hljs-keyword">int</span> i)<br>&#123;<br><span class="hljs-keyword">int</span> temp[<span class="hljs-number">6</span>] = &#123;<span class="hljs-number">2</span>*i, <span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>, <span class="hljs-number">2</span>*i*<span class="hljs-number">2</span>, <span class="hljs-number">2</span>*i*<span class="hljs-number">2</span>+<span class="hljs-number">1</span>, (<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>)*<span class="hljs-number">2</span>, (<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>)*<span class="hljs-number">2</span>+<span class="hljs-number">1</span> &#125;;<br><span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> * i &gt; n) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> minVal = _heap[<span class="hljs-number">2</span> * i];<br><span class="hljs-keyword">int</span> minIndex = <span class="hljs-number">2</span> * i;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; <span class="hljs-number">6</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(temp[j] &lt;= n)<br>&#123;<br><span class="hljs-keyword">if</span> (_heap[temp[j]] &lt; minVal)<br>&#123;<br>minVal = _heap[temp[j]];<br>minIndex = temp[j];<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">return</span> minIndex;<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>T MinMaxHeap&lt;T&gt;::popMin()   <span class="hljs-comment">// 从最小最大堆中删除并返回最小元素</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (!n)<br>    &#123;<br>        <span class="hljs-comment">//MinMaxEmpty( );</span><br>        <span class="hljs-keyword">throw</span>;<br>    &#125;<br>    _heap[<span class="hljs-number">0</span>] = INT_MAX;<br>    T y = _heap[<span class="hljs-number">1</span>];            <span class="hljs-comment">// 保存根元素</span><br>    T x = _heap[n--];<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, j = n / <span class="hljs-number">2</span>;            <span class="hljs-comment">// 为重新插入x作初始化，寻找插入x的位置</span><br>    <span class="hljs-keyword">while</span> (i &lt;= j)   <span class="hljs-comment">// i 有子女，情况(2)</span><br>    &#123;<br>        <span class="hljs-keyword">int</span> k = MinChildGrandChild(i);<br>        <span class="hljs-keyword">if</span> (x &lt;= _heap[k])<br>            <span class="hljs-keyword">break</span>;          <span class="hljs-comment">// 情况 2(a)，可将x 插入_heap[i]</span><br>        <span class="hljs-keyword">else</span>   <span class="hljs-comment">//情况2(b)或 (c)</span><br>        &#123;<br>            _heap[i] = _heap[k];<br>            <span class="hljs-keyword">if</span> (k &lt;= <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>) <span class="hljs-comment">// k 是i的子女，情况2(b)</span><br>            &#123;<br>                i = k;                           <span class="hljs-comment">// 可将x插入_heap[k]</span><br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span>              <span class="hljs-comment">// k是i的孙子女，情况2(c)</span><br>            &#123;<br>                <span class="hljs-keyword">int</span> p = k / <span class="hljs-number">2</span>;            <span class="hljs-comment">// p是k的双亲</span><br>                <span class="hljs-keyword">if</span> (x &gt; _heap[p])<br>                &#123;<br>                    T t = _heap[p]; _heap[p] = x; x = t;<br>                &#125;<br>            &#125;     <span class="hljs-comment">// if (k&lt;=2*i+1)结束</span><br>            i = k;<br>        &#125;        <span class="hljs-comment">//if (x.key&lt;=_heap[k].key)结束</span><br>    &#125;              <span class="hljs-comment">// while结束</span><br>    _heap[i] = x;  <span class="hljs-comment">// 注意，即使现在n == 0，对_heap[1] 赋值也没错，这样简化边界判断</span><br>    <span class="hljs-keyword">return</span> y;<br>&#125;<br><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">int</span> MinMaxHeap&lt;T&gt;::MaxChildGrandChild(<span class="hljs-keyword">int</span> i)<br>&#123;<br><span class="hljs-keyword">int</span> temp[<span class="hljs-number">6</span>] = &#123;<span class="hljs-number">2</span>*i, <span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>, <span class="hljs-number">2</span>*i*<span class="hljs-number">2</span>, <span class="hljs-number">2</span>*i*<span class="hljs-number">2</span>+<span class="hljs-number">1</span>, (<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>)*<span class="hljs-number">2</span>, (<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>)*<span class="hljs-number">2</span>+<span class="hljs-number">1</span> &#125;;<br><span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> * i &gt; n) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> maxVal = _heap[<span class="hljs-number">2</span> * i];<br><span class="hljs-keyword">int</span> maxIndex = <span class="hljs-number">2</span> * i;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; <span class="hljs-number">6</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(temp[j] &lt;= n)<br>&#123;<br><span class="hljs-keyword">if</span> (_heap[temp[j]] &gt; maxVal)<br>&#123;<br>maxVal = _heap[temp[j]];<br>maxIndex = temp[j];<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">return</span> maxIndex;<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>T MinMaxHeap&lt;T&gt;::popMax()   <span class="hljs-comment">// 从最小最大堆中删除并返回最大元素</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (!n)<br>    &#123;<br>        <span class="hljs-comment">//MinMaxEmpty( );</span><br>        <span class="hljs-keyword">throw</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) &#123; n--; <span class="hljs-keyword">return</span> _heap[<span class="hljs-number">1</span>]; &#125;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">2</span>) &#123; n--; <span class="hljs-keyword">return</span> _heap[<span class="hljs-number">2</span>]; &#125;<br>    <span class="hljs-keyword">int</span> i = _heap[<span class="hljs-number">2</span>] &gt; _heap[<span class="hljs-number">3</span>] ? <span class="hljs-number">2</span> : <span class="hljs-number">3</span>;<br>    T y = _heap[i];            <span class="hljs-comment">// 保存根元素</span><br>    T x = _heap[n--];<br>    <span class="hljs-keyword">int</span> j = n / <span class="hljs-number">2</span>;            <span class="hljs-comment">// 为重新插入x作初始化，寻找插入x的位置</span><br>    _heap[<span class="hljs-number">0</span>] = INT_MIN;<br>    <span class="hljs-keyword">while</span> (i &lt;= j)   <span class="hljs-comment">// i 有子女，情况(2)</span><br>    &#123;<br>        <span class="hljs-keyword">int</span> k = MaxChildGrandChild(i);<br>        <span class="hljs-keyword">if</span> (x &gt;= _heap[k])<br>            <span class="hljs-keyword">break</span>;          <span class="hljs-comment">// 情况 2(a)，可将x 插入_heap[i]</span><br>        <span class="hljs-keyword">else</span>   <span class="hljs-comment">//情况2(b)或 (c)</span><br>        &#123;<br>            _heap[i] = _heap[k];<br>            <span class="hljs-keyword">if</span> (k &lt;= <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>) <span class="hljs-comment">// k 是i的子女，情况2(b)</span><br>            &#123;<br>                i = k;                           <span class="hljs-comment">// 可将x插入_heap[k]</span><br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span>              <span class="hljs-comment">// k是i的孙子女，情况2(c)</span><br>            &#123;<br>                <span class="hljs-keyword">int</span> p = k / <span class="hljs-number">2</span>;            <span class="hljs-comment">// p是k的双亲</span><br>                <span class="hljs-keyword">if</span> (x &lt; _heap[p])<br>                &#123;<br>                    T t = _heap[p]; _heap[p] = x; x = t;<br>                &#125;<br>            &#125;     <span class="hljs-comment">// if (k&lt;=2*i+1)结束</span><br>            i = k;<br>        &#125;        <span class="hljs-comment">//if (x.key&lt;=_heap[k].key)结束</span><br>    &#125;              <span class="hljs-comment">// while结束</span><br>    _heap[i] = x;  <span class="hljs-comment">// 注意，即使现在n == 0，对_heap[1] 赋值也没错，这样简化边界判断</span><br>    <span class="hljs-keyword">return</span> y;<br>&#125;<br></code></pre></td></tr></table></figure><p>参考</p><p><a href="http://arxiv.org/ftp/cs/papers/0007/0007043.pdf" target="_blank" rel="noopener">http://arxiv.org/ftp/cs/papers/0007/0007043.pdf</a></p><p><a href="http://www.cs.otago.ac.nz/staffpriv/mike/Papers/MinMaxHeaps/MinMaxHeaps.pdf" target="_blank" rel="noopener">http://www.cs.otago.ac.nz/staffpriv/mike/Papers/MinMaxHeaps/MinMaxHeaps.pdf</a></p><p><a href="https://github.com/brownhead/minmaxheap-cpp" target="_blank" rel="noopener">https://github.com/brownhead/minmaxheap-cpp</a></p>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>算法：线段树</title>
      <link href="/2013/12/20/%E7%AE%97%E6%B3%95%EF%BC%9A%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
      <url>/2013/12/20/%E7%AE%97%E6%B3%95%EF%BC%9A%E7%BA%BF%E6%AE%B5%E6%A0%91/</url>
      <content type="html"><![CDATA[<p>线段树 Interval Tree，又称区间树 Segment Tree，其中每一个非叶子节点[a,b]，它的左儿子表示的区间为[a,(a+b)/2]，右儿子表示的区间为[(a+b)/2+1,b]。因此线段树是平衡二叉树，最后的子节点数目为N，即整个线段区间的长度。，因而常用于解决数列维护问题，它基本能保证每个操作的复杂度为O(lgN)。<a id="more"></a></p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>每个区间的长度是区间内整数的个数</li><li>叶子节点长度为1，不能再往下分</li><li>若一个节点对应的区间是[a,b],则其子节点对应的区间分别是[a,(a+b)/2]和[ (a+b)/2+1,b]</li><li>线段树的平分构造，实际上是用了二分的方法。线段树是平衡树，它的深度为log2(b-a+1)</li><li>线段树把区间上的任意一条线段都分成不超过2logL条线段</li></ul><h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><p>可以用二叉树结构，也可以用数组（数组的大小是长度的4倍）</p><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>用线段树解题，关键是要想清楚每个节点要存哪些信息（当然区间起终点，以及左右子节点指针是必须的），以及这些信息如何高效更新，维护，查询。不要一更新就更新到叶子节点，那样更新效率最坏就可能变成O(n)的了。</p><p>增加延迟标记，每个结点新增加一个标记，记录这个结点是否被进行了某种修改操作(这种修改操作会影响其子结点)。对于任意区间的修改，我们先按照查询的方式将其划分成线段树中的结点，然后修改这些结点的信息，并给这些结点标上代表这种修改操作的标记。在修改和查询的时候，如果我们到了一个结点p，并且决定考虑其子结点，那么我们就要看看结点p有没有标记，如果有，就要按照标记修改其子结点的信息，并且给子结点都标上相同的标记，同时消掉p的标记。</p><p>例题1：POJ 3264 Balanced Lineup 给定Q (1 ≤ Q ≤ 200,000)个数A1,A2 … AQ,多次求任一区间Ai – Aj中最大数和最小数的差。(此题可以用动态规划RMQ法做，更加快速)</p><p>例题2：POJ 3468 A Simple Problem with Integers 给定Q (1 ≤ Q ≤ 100,000)个数A1,A2 … AQ,以及可能多次进行的两个操作:1) 对某个区间Ai … Aj的个数都加n(n可变）2)  求某个区间Ai … Aj的数的和</p><h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><p>有时，区间的端点不是整数，或者区间太大导致建树内存开销过大MLE ,那么就需要进行“离散化”后再建树。</p><p>POJ 2528 Mayor’s posters 给定一些海报，可能互相重叠，告诉你每个海报宽度（高度都一样）和先后叠放次序，问没有被完全盖住的海报有多少张。</p><p>POJ 1151 Atlantis 给定一些矩形，其顶点坐标是浮点数，可能互相重叠，问这些矩形覆盖到的面积是多大。</p><h2 id="优化-ZKW"><a href="#优化-ZKW" class="headerlink" title="优化 ZKW"></a>优化 ZKW</h2><p>清华张昆玮，自底向上，非递归</p><p>参考:</p><p><a href="http://dongxicheng.org/structure/segment-tree/" target="_blank" rel="noopener">http://dongxicheng.org/structure/segment-tree/</a></p><p><a href="http://poj.org/summerschool/1_interval_tree.pdf" target="_blank" rel="noopener">http://poj.org/summerschool/1_interval_tree.pdf</a></p><p><a href="http://blog.csdn.net/metalseed/article/details/8039326" target="_blank" rel="noopener">http://blog.csdn.net/metalseed/article/details/8039326</a></p>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>poj 2388 寻找中位数</title>
      <link href="/2013/12/20/poj-2388-%E5%AF%BB%E6%89%BE%E4%B8%AD%E4%BD%8D%E6%95%B0/"/>
      <url>/2013/12/20/poj-2388-%E5%AF%BB%E6%89%BE%E4%B8%AD%E4%BD%8D%E6%95%B0/</url>
      <content type="html"><![CDATA[<p>这也是Google面试题</p><p>股市上一个股票的价格从开市开始是不停的变化的，需要开发一个系统，给定一个股票，它能实时显示从开市到当前时间的这个股票的价格的中位数（中值）。</p><p>用双堆存储，一个大根堆，一个小根堆，则Inert为O(logn)，Median为O(1)<br><a id="more"></a></p><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FindMedian</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> PriorityQueue&lt;Integer&gt; maxHeap, minHeap;<br><br>    FindMedian(<span class="hljs-keyword">int</span> n) &#123;<br>        Comparator&lt;Integer&gt; revCmp = <span class="hljs-keyword">new</span> Comparator&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Integer left, Integer right)</span> </span>&#123;<br>                <span class="hljs-keyword">return</span> right.compareTo(left);<br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-comment">// Or you can use Collections' reverseOrder method as follows.</span><br>        <span class="hljs-comment">// Comparator&lt;Integer&gt; revCmp = Collections.reverseOrder();</span><br>        maxHeap = <span class="hljs-keyword">new</span> PriorityQueue&lt;Integer&gt;(n, revCmp);<br>        minHeap = <span class="hljs-keyword">new</span> PriorityQueue&lt;Integer&gt;(n);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addNewNumber</span><span class="hljs-params">(<span class="hljs-keyword">int</span> randomNumber)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (maxHeap.size() == minHeap.size()) &#123;<br>            <span class="hljs-keyword">if</span> ((minHeap.peek() != <span class="hljs-keyword">null</span>) &amp;&amp; randomNumber &gt; minHeap.peek()) &#123;<br>                maxHeap.offer(minHeap.poll());<br>                minHeap.offer(randomNumber);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                maxHeap.offer(randomNumber);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// trick</span><br>            <span class="hljs-keyword">if</span>(randomNumber &lt; maxHeap.peek()) &#123;<br>                minHeap.offer(maxHeap.poll());<br>                maxHeap.offer(randomNumber);<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                minHeap.offer(randomNumber);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMedian</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (maxHeap.isEmpty()) <span class="hljs-keyword">return</span> minHeap.peek();<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (minHeap.isEmpty()) <span class="hljs-keyword">return</span> maxHeap.peek();<br><br>        <span class="hljs-keyword">if</span> (maxHeap.size() == minHeap.size()) &#123;<br>            <span class="hljs-keyword">return</span> (minHeap.peek() + maxHeap.peek()) / <span class="hljs-number">2</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (maxHeap.size() &gt; minHeap.size()) &#123;<br>            <span class="hljs-keyword">return</span> maxHeap.peek();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> minHeap.peek();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Scanner in = <span class="hljs-keyword">new</span> Scanner(System.in);<br>        <span class="hljs-keyword">int</span> n = in.nextInt();<br>        FindMedian fm = <span class="hljs-keyword">new</span> FindMedian(n);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>            <span class="hljs-keyword">int</span> num = in.nextInt();<br>            fm.addNewNumber(num);<br>        &#125;<br><br>        System.out.println(fm.getMedian());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>poj 3164 最小树形图 朱刘算法</title>
      <link href="/2013/12/20/poj-3164-%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE-%E6%9C%B1%E5%88%98%E7%AE%97%E6%B3%95/"/>
      <url>/2013/12/20/poj-3164-%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE-%E6%9C%B1%E5%88%98%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>最小树形图，就是给有向带权图中指定一个特殊的点root，求一棵以root为根的有向生成树T，并且T中所有边的总权值最小。最小树形图的第一个算法是 1965年朱永津和刘振宏提出的复杂度为O(VE)的算法。<a id="more"></a></p><p>(无向图的最小生成树即最小树形图，可用Prim’s Algorithm、Kruskal’s Algorithm等算法求。)</p><p>判断是否存在树形图的方法很简单，只需要以v为根作一次图的遍历就可以了。</p><p>步骤：</p><ol><li><p>除根外每个点选最小入边（贪心）</p></li><li><p>检查环，每个点留一条入边，那么此时图中就有n-1条边，如果有环必定有点之间没有被连接。如果没有环同时每个结点（除根外）都有前驱，算法结束。</p></li><li><p>缩环成点，所有环上的所有的点（注意这些点每次循环都会被更新，是动态的），除了它的最小入边，其他的入边的权值都减去最小入边的权值，然后箭头指向“新”的点（也就是这个环）。</p></li></ol><p>对于无固定根最小树形图，只要虚拟一个根连接所有点，权为边权总和+1,最后的结果减去（边权+1）即可。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cmath&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> VN=<span class="hljs-number">110</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> INF=<span class="hljs-number">99999999</span>;<br><br><span class="hljs-keyword">double</span> <span class="hljs-built_in">map</span>[VN][VN];<br><span class="hljs-keyword">int</span> n,m,vis[VN],pt[VN][<span class="hljs-number">2</span>],pre[VN];<br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">Cal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i,<span class="hljs-keyword">int</span> j)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(<span class="hljs-built_in">pow</span>(pt[i][<span class="hljs-number">0</span>]-pt[j][<span class="hljs-number">0</span>],<span class="hljs-number">2.0</span>)+<span class="hljs-built_in">pow</span>(pt[i][<span class="hljs-number">1</span>]-pt[j][<span class="hljs-number">1</span>],<span class="hljs-number">2.0</span>));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DFS</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span></span>&#123;<br>    vis[u]=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>        <span class="hljs-keyword">if</span>(!vis[i] &amp;&amp; <span class="hljs-built_in">map</span>[u][i]!=INF)<br>            DFS(i);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Connected</span><span class="hljs-params">()</span></span>&#123;   <span class="hljs-comment">//判断是否连通，如果连通一定存在最小树形图。 </span><br>    <span class="hljs-built_in">memset</span>(vis,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(vis));<br>    DFS(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>        <span class="hljs-keyword">if</span>(!vis[i])<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">ZLEmonds</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">int</span> i,j,k;<br>    <span class="hljs-keyword">bool</span> circle[VN];<br>    <span class="hljs-keyword">double</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">memset</span>(circle,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(circle));<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;  <span class="hljs-comment">//找出最短弧集合E0 </span><br>            <span class="hljs-keyword">if</span>(circle[i])<br>                <span class="hljs-keyword">continue</span>;<br>            pre[i]=i;<br>            <span class="hljs-built_in">map</span>[i][i]=INF;<br>            <span class="hljs-keyword">for</span>(j=<span class="hljs-number">1</span>;j&lt;=n;j++)&#123;<br>                <span class="hljs-keyword">if</span>(circle[j])<br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[j][i]&lt;<span class="hljs-built_in">map</span>[pre[i]][i])<br>                    pre[i]=j;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br>            <span class="hljs-keyword">if</span>(circle[i])<br>                <span class="hljs-keyword">continue</span>;<br>            j=i;<br>            <span class="hljs-built_in">memset</span>(vis,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(vis));<br>            <span class="hljs-keyword">while</span>(!vis[j] &amp;&amp; j!=<span class="hljs-number">1</span>)&#123;<br>                vis[j]=<span class="hljs-number">1</span>;<br>                j=pre[j];<br>            &#125;<br>            <span class="hljs-keyword">if</span>(j==<span class="hljs-number">1</span>)    <span class="hljs-comment">//检查是否有环，能找到根节点说明没环 </span><br>                <span class="hljs-keyword">continue</span>;<br>            i=j;<br>            ans+=<span class="hljs-built_in">map</span>[pre[i]][i];<br>            <span class="hljs-keyword">for</span>(j=pre[i];j!=i;j=pre[j])&#123;    <span class="hljs-comment">//i不用标记，用作后面缩点用  </span><br>                ans+=<span class="hljs-built_in">map</span>[pre[j]][j];<br>                circle[j]=<span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">for</span>(j=<span class="hljs-number">1</span>;j&lt;=n;j++)&#123;<br>                <span class="hljs-keyword">if</span>(circle[j])<br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[j][i]!=INF)<br>                    <span class="hljs-built_in">map</span>[j][i]-=<span class="hljs-built_in">map</span>[pre[i]][i];<br>            &#125;<br>            <span class="hljs-keyword">for</span>(j=pre[i];j!=i;j=pre[j]) <span class="hljs-comment">//将环中所有的点成点i，改变边 </span><br>                <span class="hljs-keyword">for</span>(k=<span class="hljs-number">1</span>;k&lt;=n;k++)&#123;<br>                    <span class="hljs-keyword">if</span>(circle[k])<br>                        <span class="hljs-keyword">continue</span>;<br>                    <span class="hljs-built_in">map</span>[i][k]=min(<span class="hljs-built_in">map</span>[i][k],<span class="hljs-built_in">map</span>[j][k]);<br>                    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[k][j]!=INF)<br>                        <span class="hljs-built_in">map</span>[k][i]=min(<span class="hljs-built_in">map</span>[k][i],<span class="hljs-built_in">map</span>[k][j]-<span class="hljs-built_in">map</span>[pre[j]][j]);<br>                &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(i&gt;n)&#123;    <span class="hljs-comment">//求出最小树形图的权值 </span><br>            <span class="hljs-keyword">for</span>(j=<span class="hljs-number">2</span>;j&lt;=n;j++)&#123;<br>                <span class="hljs-keyword">if</span>(circle[j])<br>                    <span class="hljs-keyword">continue</span>;<br>                ans+=<span class="hljs-built_in">map</span>[pre[j]][j];<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">while</span>(~<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m))&#123;<br>        <span class="hljs-keyword">int</span> i,j;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>            <span class="hljs-keyword">for</span>(j=<span class="hljs-number">1</span>;j&lt;=n;j++)<br>                <span class="hljs-built_in">map</span>[i][j]=INF;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;pt[i][<span class="hljs-number">0</span>],&amp;pt[i][<span class="hljs-number">1</span>]);<br>        <span class="hljs-keyword">while</span>(m--)&#123;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;i,&amp;j);<br>            <span class="hljs-built_in">map</span>[i][j]=Cal(i,j);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!Connected())<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"poor snoopy\n"</span>);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.2f\n"</span>,ZLEmonds());<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>实现自己的STL Iterator</title>
      <link href="/2013/12/16/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84stl-iterator/"/>
      <url>/2013/12/16/%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84stl-iterator/</url>
      <content type="html"><![CDATA[<p>STL表现的如此出色的，迭代器（iterator）做出了很大的贡献，功不可没。<a id="more"></a></p><h2 id="1-内嵌STL-Container"><a href="#1-内嵌STL-Container" class="headerlink" title="1 内嵌STL Container"></a>1 内嵌STL Container</h2><p>代理模式</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseList</span> &#123;</span><br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-keyword">typedef</span> <span class="hljs-built_in">vector</span>&lt;Student&gt; StudentList;<br>  StudentList students;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">typedef</span> StudentList::iterator iterator;<br>  <span class="hljs-keyword">typedef</span> StudentList::const_iterator const_iterator;<br>  <span class="hljs-function">iterator <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> students.begin(); &#125;<br>  <span class="hljs-function">iterator <span class="hljs-title">end</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> students.end(); &#125;<br>  ...<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="2-在自己的-Collection-中实现-STL-Iterator"><a href="#2-在自己的-Collection-中实现-STL-Iterator" class="headerlink" title="2 在自己的 Collection 中实现 STL Iterator"></a>2 在自己的 Collection 中实现 STL Iterator</h2><p>stl iterator class</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Category, <span class="hljs-keyword">typename</span> _Tp, <span class="hljs-keyword">typename</span> _Distance = <span class="hljs-keyword">ptrdiff_t</span>,<br>            <span class="hljs-keyword">typename</span> _Pointer = _Tp*, <span class="hljs-keyword">typename</span> _Reference = _Tp&amp;&gt;<br>struct iterator<br>&#123;<br>   <span class="hljs-keyword">typedef</span> _Category  iterator_category;<br>   <span class="hljs-keyword">typedef</span> _Tp        value_type;<br>   <span class="hljs-keyword">typedef</span> _Distance  difference_type;<br>   <span class="hljs-keyword">typedef</span> _Pointer   pointer;<br>   <span class="hljs-keyword">typedef</span> _Reference reference;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist</span>;</span>  <span class="hljs-comment">// forward declare</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist_iterator</span>;</span> <span class="hljs-comment">// forward declare</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist_node</span> &#123;</span><br><span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist</span>&lt;T&gt;;</span><br><span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist_iterator</span>&lt;T&gt;;</span><br><span class="hljs-keyword">private</span>:<br>mylist_node(<span class="hljs-keyword">const</span> T&amp; t, mylist_node&lt;T&gt; *next) : elem(t), next(next) &#123;&#125;<br>~mylist_node() &#123; <span class="hljs-keyword">delete</span> next; &#125;<br>T elem;<br>mylist_node&lt;T&gt; *next;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br><span class="hljs-keyword">typedef</span> mylist_iterator&lt;T&gt; iterator    ;<br><span class="hljs-keyword">public</span>:<br>mylist() : head(<span class="hljs-literal">NULL</span>), tail(<span class="hljs-literal">NULL</span>) &#123;&#125;<br>~mylist() &#123; <span class="hljs-keyword">delete</span> head; &#125;<br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> head == <span class="hljs-literal">NULL</span>; &#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; elem)</span></span>;<br><span class="hljs-function">iterator <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> mylist_iterator&lt;T&gt;(head); &#125;<br><span class="hljs-function">iterator <span class="hljs-title">end</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> mylist_iterator&lt;T&gt;(<span class="hljs-literal">NULL</span>); &#125;<br><span class="hljs-keyword">private</span>:<br>mylist_node&lt;T&gt; *head, *tail;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist_iterator</span> :</span> <span class="hljs-keyword">public</span> iterator&lt;forward_iterator_tag, T&gt; &#123;<br><span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mylist</span>&lt;T&gt;;</span><br><span class="hljs-keyword">public</span>:<br>T&amp; <span class="hljs-keyword">operator</span>*();<br><span class="hljs-keyword">const</span> mylist_iterator&lt;T&gt;&amp; <span class="hljs-keyword">operator</span>++();<br><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> mylist_iterator&lt;T&gt;&amp; other) <span class="hljs-keyword">const</span>;<br><span class="hljs-keyword">private</span>:<br>mylist_node&lt;T&gt; *pointee;<br>mylist_iterator(mylist_node&lt;T&gt; *pointee) : pointee(pointee) &#123;&#125;<br>&#125;;<br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br>T&amp; mylist_iterator&lt;T&gt;::<span class="hljs-keyword">operator</span>*()<br>&#123;<br><span class="hljs-keyword">return</span> pointee-&gt;elem;<br>&#125;<br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">const</span> mylist_iterator&lt;T&gt;&amp; mylist_iterator&lt;T&gt;::<span class="hljs-keyword">operator</span>++()<br>&#123;<br>assert(pointee != <span class="hljs-literal">NULL</span>);<br>pointee = pointee-&gt;next;<br><span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">bool</span> mylist_iterator&lt;T&gt;:: <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> mylist_iterator&lt;T&gt;&amp; other) <span class="hljs-keyword">const</span><br>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;pointee != other.pointee;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-特殊行为的Iterator"><a href="#3-特殊行为的Iterator" class="headerlink" title="3 特殊行为的Iterator"></a>3 特殊行为的Iterator</h2><p>Stroustrup The C++ Programming Language gives an example of range-checking iterator.</p><p>下面我们来实现一个even numbers iterator</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> IterT, <span class="hljs-keyword">typename</span> TypeT&gt;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">even_iterator</span> :</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">std</span>::iterator&lt;input_iterator_tag, TypeT&gt;<br>&#123;<br><span class="hljs-keyword">protected</span>:<br>IterT m_itCur;<br>IterT m_itEnd;<br><br><span class="hljs-keyword">protected</span>:<br><span class="hljs-keyword">void</span> __find_first_even()<br>&#123;<br><span class="hljs-keyword">for</span> (; m_itCur != m_itEnd; ++m_itCur)<br><span class="hljs-keyword">if</span> (*m_itCur % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-keyword">void</span> __find_next_even()<br>&#123;<br><span class="hljs-keyword">if</span> (m_itCur == m_itEnd) <span class="hljs-keyword">return</span>;<br><span class="hljs-keyword">for</span> (++m_itCur; m_itCur != m_itEnd; ++m_itCur)<br><span class="hljs-keyword">if</span> (*m_itCur % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span>:<br>even_iterator() :<br>m_itEnd(), m_itCur() &#123;&#125;<br><br>even_iterator(<span class="hljs-keyword">const</span> IterT&amp; itCur, <span class="hljs-keyword">const</span> IterT&amp; itEnd) :<br>m_itCur(itCur), m_itEnd(itEnd)<br>&#123; __find_first_even(); &#125;<br><br>even_iterator(<span class="hljs-keyword">const</span> even_iterator&amp; r) :<br>m_itCur(r.m_itCur),<br>m_itEnd(r.m_itEnd) &#123;&#125;<br><br>even_iterator&lt;IterT, TypeT&gt;&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> even_iterator&amp; r)<br>&#123;<br>m_itCur = r.m_itCur;<br>m_itEnd = r.m_itEnd;<br><br><span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br><br>even_iterator&lt;IterT, TypeT&gt;&amp; <span class="hljs-keyword">operator</span>++()<br>&#123;<br>__find_next_even();<br><span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br><br>even_iterator&lt;IterT, TypeT&gt; <span class="hljs-keyword">operator</span>++(<span class="hljs-keyword">int</span>)<br>&#123;<br>even_iterator it = *<span class="hljs-keyword">this</span>;<br>__find_next_even();<br><span class="hljs-keyword">return</span> it;<br>&#125;<br><br>TypeT&amp; <span class="hljs-keyword">operator</span>*()<br>&#123; <span class="hljs-keyword">return</span> *m_itCur; &#125;<br><br>TypeT* <span class="hljs-keyword">operator</span>-&gt;()<br>&#123; <span class="hljs-keyword">return</span> &amp;(*m_itCur); &#125;<br><br><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> even_iterator&amp; r) <span class="hljs-keyword">const</span><br>&#123; <span class="hljs-keyword">return</span> (m_itCur != r.m_itCur); &#125;<br><br><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> even_iterator&amp; r) <span class="hljs-keyword">const</span><br>&#123; <span class="hljs-keyword">return</span> !<span class="hljs-keyword">operator</span>!=(r); &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>Test</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span><br></span>&#123;<br>srand((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>) time(<span class="hljs-literal">NULL</span>));<br><br><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; vnNums(<span class="hljs-number">20</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> u = <span class="hljs-number">0</span>; u &lt; <span class="hljs-number">20</span>; ++u)<br>vnNums[u] = rand() / (<span class="hljs-keyword">float</span>) RAND_MAX * <span class="hljs-number">100</span>;<br><br><span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"initial vector:"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>copy(vnNums.begin(), vnNums.end(), ostream_iterator(<span class="hljs-built_in">cout</span>, <span class="hljs-string">"\t"</span>));<br><span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br><br><br><span class="hljs-keyword">typedef</span> even_iterator&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;::const_iterator, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span>&gt; int_vec_even_iter;<br><span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"even vector:"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br><span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"even vector:"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br><br>copy(int_vec_even_iter(vnNums.begin(), vnNums.end()),<br>int_vec_even_iter(vnNums.end(), vnNums.end()),<br>ostream_iterator&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-built_in">cout</span>, <span class="hljs-string">"\t"</span>)<br>);<br><span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Iterator完整实现"><a href="#Iterator完整实现" class="headerlink" title="Iterator完整实现"></a>Iterator完整实现</h2><p>simple</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// forward declare the iterator</span><br><br><span class="hljs-keyword">template</span> &lt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-title">int</span> <span class="hljs-title">N</span> &gt; <span class="hljs-title">class</span> <span class="hljs-title">RingIter</span>;</span><br><br><br><span class="hljs-comment">// define the container, make the iterator a friend</span><br><br><span class="hljs-keyword">template</span> &lt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-title">int</span> <span class="hljs-title">N</span> &gt;<br><span class="hljs-title">class</span> <span class="hljs-title">RingQueue</span> &#123;</span><br><br><span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RingIter</span>&lt; T, N &gt;;</span><br><span class="hljs-keyword">typedef</span> RingIter&lt;T, N&gt; iterator;<br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">ptrdiff_t</span> difference_type;<br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">size_t</span> size_type;<br><span class="hljs-keyword">typedef</span> T value_type;<br><span class="hljs-keyword">typedef</span> T * pointer;<br><span class="hljs-keyword">typedef</span> T &amp; reference;<br><br><span class="hljs-function">iterator <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> iterator( *<span class="hljs-keyword">this</span>, <span class="hljs-number">0</span> ); &#125;<br><span class="hljs-function">iterator <span class="hljs-title">begin</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> const_iterator( *<span class="hljs-keyword">this</span>, <span class="hljs-number">0</span> ); &#125;<br><span class="hljs-function">iterator <span class="hljs-title">end</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> iterator( *<span class="hljs-keyword">this</span>, mySize ); &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// define the iterator</span><br><br><span class="hljs-keyword">template</span> &lt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-title">int</span> <span class="hljs-title">N</span> &gt;<br><span class="hljs-title">class</span> <span class="hljs-title">RingIter</span> &#123;</span><br><span class="hljs-keyword">private</span>:<br>RingQueue&lt;T, N&gt; &amp; myRingQueue;<br><span class="hljs-keyword">int</span> mySize;<br><span class="hljs-keyword">public</span>:<br>RingIter( RingQueue &amp; rq, <span class="hljs-keyword">int</span> size )<br>: myRingQueue( rq ), mySize ( size )<br>&#123;&#125;<br><br>T &amp; <span class="hljs-keyword">operator</span>*() &#123; <span class="hljs-keyword">return</span> myRingQueue[ myIncrement ]; &#125;<br>iterator &amp; <span class="hljs-keyword">operator</span>++() &#123; ++myOffset; <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>; &#125;<br>iterator <span class="hljs-keyword">operator</span>++ ( <span class="hljs-keyword">int</span> )<br>&#123;<br>RingIter&lt;T, N&gt; clone( *<span class="hljs-keyword">this</span> );<br>++myOffset;<br><span class="hljs-keyword">return</span> clone;<br>&#125;<br>&#125;;<br><br><span class="hljs-keyword">typedef</span> RingCIter&lt;T, N&gt; const_iterator;<br></code></pre></td></tr></table></figure><p>complete</p><p>文件iterator_base.h</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*This is a internal header file.<br> *It contains all of the general iterator-related utility types,such as<br> * iterator_traits and struct iterator and functions, such as distance() <br> *and advance().<br> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> _MITERATOR_BASE_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MITERATOR_BASE_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cassert&gt; //for debug</span></span><br><span class="hljs-keyword">namespace</span> numb<br>&#123;<br>    <span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">ptrdiff_t</span>;<br><span class="hljs-comment">/* Abstructions for uniform iterator,<br> * general iterator-related utility types<br> */</span><br>    <span class="hljs-comment">/* Iterator tags<br>    * 5 kinds of iterators,such as input iterator,<br>    * output iterator.<br>    */</span><br>    <span class="hljs-comment">///Input Iterator</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">input_iterator_tag</span>&#123;</span>&#125;;<br>    <span class="hljs-comment">///Output Iterator</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">output_iterator_tag</span>&#123;</span>&#125;;<br>    <span class="hljs-comment">///Forward Iterator</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">forward_iterator_tag</span>:</span><span class="hljs-keyword">public</span> input_iterator_tag &#123;&#125;;<br>    <span class="hljs-comment">///Bidirectional Iterator</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bidirectional_iterator_tag</span>:</span><span class="hljs-keyword">public</span> forward_iterator_tag &#123;&#125;;<br>    <span class="hljs-comment">///Random Acess Iterator</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">random_iterator_tag</span>:</span><span class="hljs-keyword">public</span> bidirectional_iterator_tag &#123;&#125;;<br>    <br>    <span class="hljs-comment">/* Common iterator class<br>    * It contains nothing but some nested typedefs<br>    * All iterator classes inherit from it.<br>    */</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Category,<br>             <span class="hljs-keyword">typename</span> _T,<br>             <span class="hljs-keyword">typename</span> _Distance=<span class="hljs-keyword">ptrdiff_t</span>,<br>             <span class="hljs-keyword">typename</span> _Pointer=_T*,<br>             <span class="hljs-keyword">typename</span> _Reference=_T&amp;&gt;<br>    struct iterator<br>    &#123;<br>        <span class="hljs-comment">//5 associated types</span><br>        <span class="hljs-keyword">typedef</span> _Category iterator_category;<br>        <span class="hljs-keyword">typedef</span> _T            value_type;<br>        <span class="hljs-keyword">typedef</span> _Distance difference_type;<br>        <span class="hljs-keyword">typedef</span> _Pointer  pointer;<br>        <span class="hljs-keyword">typedef</span> _Reference  reference;<br>    &#125;;<br>    <br>    <span class="hljs-comment">/* Traits classes for iterators<br>    * It contains nothing but some nested typedefs<br>    */</span><br>    <span class="hljs-comment">//General version</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Iterator&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iterator_traits</span><br>    &#123;</span><br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Iterator::value_type           value_type;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Iterator::iterator_category    iterator_category;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Iterator::difference_type  difference_type;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Iterator::pointer          pointer;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Iterator::reference            reference;<br>    &#125;;<br>    <span class="hljs-comment">//Partial specialization for pointer types.</span><br>    <span class="hljs-comment">//(such as int*,char*,etc.)</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Tp&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iterator_traits</span>&lt;_Tp*&gt;<br>    &#123;</span><br>        <span class="hljs-keyword">typedef</span> _Tp                   value_type;<br>        <span class="hljs-keyword">typedef</span> random_iterator_tag   iterator_category;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">ptrdiff_t</span>                difference_type;<br>        <span class="hljs-keyword">typedef</span> _Tp*                   pointer;<br>        <span class="hljs-keyword">typedef</span> _Tp&amp;                   reference;<br>    &#125;;<br>    <span class="hljs-comment">//Partial specialization for pointer-to-const types.</span><br>    <span class="hljs-comment">//(such as coonst int*,const char*,etc.)</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Tp&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iterator_traits</span>&lt;const _Tp*&gt;<br>    &#123;</span><br>        <span class="hljs-keyword">typedef</span> _Tp                   value_type;<br>        <span class="hljs-keyword">typedef</span> random_iterator_tag   iterator_category;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">ptrdiff_t</span>                difference_type;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">const</span> _Tp*                  pointer;<br>        <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">const</span> _Tp&amp;                  reference;<br>    &#125;;<br>    <span class="hljs-comment">/*<br>    *Some general functionals<br>    */</span><br>     <br>    <span class="hljs-comment">//A function that get the category of a iterator</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Iter&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">typename</span> iterator_traits&lt;_Iter&gt;::iterator_category<br>    _iterator_category(<span class="hljs-keyword">const</span> _Iter)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typename</span> iterator_traits&lt;_Iter&gt;::iterator_category();<br>    &#125;<br><br>    <span class="hljs-comment">/* Distance between iterators .<br>    * @param   first  An input iterator<br>    * @param   last   An input iterator<br>    * @return  distance between them.<br>    */</span><br>    <span class="hljs-comment">//For all iterators but random acces iterator</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> InputIter&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">typename</span> iterator_traits&lt;InputIter&gt;::difference_type<br>    _distance(InputIter first,InputIter last,input_iterator_tag)<br>    &#123;<br>        <span class="hljs-keyword">typename</span> iterator_traits&lt;InputIter&gt;::difference_type n=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(first!=last)<br>        &#123;<br>            ++first;<br>            ++n;<br>        &#125;<br>        <span class="hljs-keyword">return</span> n;<br>    &#125;<br>    <span class="hljs-comment">//For random acces iterator,@n maybe negetive.</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> RandomIter&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">typename</span> iterator_traits&lt;RandomIter&gt;::difference_type<br>    _distance(RandomIter first,RandomIter last,random_iterator_tag)<br>    &#123;<br>        <span class="hljs-keyword">return</span> last-first;<br>    &#125;<br>    <span class="hljs-comment">//interface for client</span><br>    <span class="hljs-comment">//InputIter stands for it is an input iterator at least.</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> InputIter&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">typename</span> iterator_traits&lt;InputIter&gt;::<span class="hljs-function">difference_type<br>    <span class="hljs-title">distance</span><span class="hljs-params">(InputIter first,InputIter last)</span><br>    </span>&#123;<br>        <span class="hljs-keyword">return</span> _distance(first,last,<br>                         _iterator_category(first));<br>    &#125;<br>    <span class="hljs-comment">/* Increment/decrement iterators .<br>    * @param   i   An input iterator<br>    * @param   n   A delta by which to change<br>    * @return  nothing.<br>    */</span><br>    <span class="hljs-comment">//For input iterator ,n&gt;=0;</span><br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> InputIter,<span class="hljs-keyword">typename</span> Distance&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> _advance(InputIter i,Distance n,input_iterator_tag)<br>    &#123;<br>        assert(n&gt;=<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">while</span>(n--) ++i;<br>    &#125;<br>    <span class="hljs-comment">//for bidirectional iterator</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> BidirecIter,<span class="hljs-keyword">typename</span> Distance&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> _advance(BidirecIter i,Distance n,bidirectional_iterator_tag)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(n&gt;<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">while</span>(n--)<br>                ++i;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">while</span>(n++)<br>                --i;<br>    &#125;<br>    <span class="hljs-comment">//For random access iterator</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> RandomIter,<span class="hljs-keyword">typename</span> Distance&gt;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> _advance(RandomIter i,Distance n,random_iterator_tag)<br>    &#123;    i+=n;   &#125;<br>    <span class="hljs-comment">//Interface to client</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIter,<span class="hljs-keyword">typename</span> Distance&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">advance</span><span class="hljs-params">(InputIter i,Distance n)</span><br>    </span>&#123;<br>        _advance(i,n,_iterator_category(i));<br>    &#125;    <br>&#125;<span class="hljs-comment">//end of numb</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>文件stl_iterator.h</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*<br> *  This is an internal header file.<br> *  This file implements some iterator adapters,<br> *  such as __normal_iterator,reverse_iterator, back_insert_iterator,<br> *  front_insert_iterator, insert_iterator, , and their<br> *  supporting functions and overloaded operators.<br> */</span><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> _mstl_iterator_h</span><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _mstl_iterator_h</span><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"iterator_base.h"</span></span><br> <span class="hljs-keyword">namespace</span> numb<br> &#123;<br>    <span class="hljs-comment">//This iterator adapter is a normal iterator</span><br>    <span class="hljs-keyword">using</span> numb::iterator;<br>    <span class="hljs-keyword">using</span> numb::iterator_traits;<br>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Iterator, <span class="hljs-keyword">typename</span> Container&gt;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">normal_iterator</span><br>    &#123;</span><br>        <span class="hljs-keyword">protected</span>:<br>            Iterator M_current;<br>            <span class="hljs-keyword">typedef</span> iterator_traits&lt;Iterator&gt;  traits_type;<br>        <span class="hljs-keyword">public</span>:<br>            <span class="hljs-keyword">typedef</span> Iterator                              iterator_type;<br>            <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> traits_type::iterator_category  iterator_category;<br>            <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> traits_type::value_type         value_type;<br>            <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> traits_type::difference_type    difference_type;<br>            <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> traits_type::reference      reference;<br>            <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> traits_type::pointer        pointer;<br>            <span class="hljs-comment">//default ctor</span><br>            _normal_iterator():M_current(Iterator())&#123;&#125;<br>            <span class="hljs-comment">//copy ctor</span><br>            <span class="hljs-keyword">explicit</span> _normal_iterator(<span class="hljs-keyword">const</span> Iterator&amp; i):M_current(i)&#123;&#125;<br>            <br>            <span class="hljs-comment">//To-do: Allow iterator to const_iterator conversion</span><br>            <br>            <span class="hljs-comment">//for forward iterator </span><br>            reference <span class="hljs-keyword">operator</span>*()<span class="hljs-keyword">const</span><br>            &#123;    <span class="hljs-keyword">return</span> *M_current;&#125;<br>            pointer <span class="hljs-keyword">operator</span>-&gt;()<span class="hljs-keyword">const</span><br>            &#123;    <span class="hljs-keyword">return</span> M_current;&#125;<br>            <span class="hljs-comment">//++i</span><br>            _normal_iterator&amp; <br>            <span class="hljs-keyword">operator</span> ++()<br>            &#123;<br>                ++M_current;<br>                <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>            &#125;<br>            <span class="hljs-comment">//i++</span><br>            _normal_iterator <br>            <span class="hljs-keyword">operator</span> ++(<span class="hljs-keyword">int</span>)<br>            &#123;<br>                <span class="hljs-keyword">return</span> _normal_iterator(M_current++);<br>            &#125;<br>            <span class="hljs-comment">//for bidirectional iterator</span><br>            <span class="hljs-comment">//--i</span><br>            _normal_iterator&amp; <br>            <span class="hljs-keyword">operator</span> --()<br>            &#123;<br>                --M_current;<br>                <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>            &#125;<br>            <span class="hljs-comment">//i--</span><br>            _normal_iterator <br>            <span class="hljs-keyword">operator</span> --(<span class="hljs-keyword">int</span>)<br>            &#123;<span class="hljs-keyword">return</span> _normal_iterator(M_current--);&#125;<br>            <br>            <span class="hljs-comment">//for random access iterator,[],+=,-=,+,-</span><br>            reference <br>            <span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">const</span> difference_type&amp; n)<span class="hljs-keyword">const</span><br>            &#123;    <span class="hljs-keyword">return</span> M_current[n];&#125;<br>            <br>            _normal_iterator&amp; <br>            <span class="hljs-keyword">operator</span> +=(<span class="hljs-keyword">const</span> difference_type&amp; n)<br>            &#123;<br>                M_current+=n;<br>                <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>            &#125;<br>            _normal_iterator&amp;<br>            <span class="hljs-keyword">operator</span> -=(<span class="hljs-keyword">const</span> difference_type&amp; n)<br>            &#123;<br>                M_current-=n;<br>                <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>            &#125;<br>            _normal_iterator<br>            <span class="hljs-keyword">operator</span> +(<span class="hljs-keyword">const</span> difference_type&amp; n)<span class="hljs-keyword">const</span><br>            &#123;<br>                <span class="hljs-keyword">return</span> _normal_iterator(M_current+n);<br>            &#125;<br>            _normal_iterator<br>            <span class="hljs-keyword">operator</span> -(<span class="hljs-keyword">const</span> difference_type&amp; n)<span class="hljs-keyword">const</span><br>            &#123;<br>                <span class="hljs-keyword">return</span> _normal_iterator(M_current-n);<br>            &#125;<br>            <span class="hljs-function"><span class="hljs-keyword">const</span> Iterator&amp;<br>            <span class="hljs-title">base</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span><br>            </span>&#123; <span class="hljs-keyword">return</span> M_current; &#125;            <br>    &#125;;<span class="hljs-comment">//end of _normal_iterator</span><br> &#125;<span class="hljs-comment">//end of namespace numb</span><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Windows CMD替代</title>
      <link href="/2013/12/05/windows-cmd%E6%9B%BF%E4%BB%A3/"/>
      <url>/2013/12/05/windows-cmd%E6%9B%BF%E4%BB%A3/</url>
      <content type="html"><![CDATA[<h2 id="Console2"><a href="#Console2" class="headerlink" title="Console2"></a>Console2</h2><p>官网：<a href="http://sourceforge.net/projects/console/" target="_blank" rel="noopener">http://sourceforge.net/projects/console/</a></p><p>中文输入支持：<a href="https://github.com/autosquid/Console2-Chinese-Input-Capable" target="_blank" rel="noopener">https://github.com/autosquid/Console2-Chinese-Input-Capable</a></p><p>中文偏移<br>所以需要在console2的窗口中 右击，选择 view-&gt;console windo——进入到cmd界面 然后在cmd的标签上，选择 属性-&gt;字体-&gt;新宋体</p><p><img src="/img/console2.png" alt="console2"></p><p>克隆版 ConsoleZ</p><h2 id="ConEmu"><a href="#ConEmu" class="headerlink" title="ConEmu"></a>ConEmu</h2><p>官网 <a href="http://code.google.com/p/conemu-maximus5/" target="_blank" rel="noopener">http://code.google.com/p/conemu-maximus5/</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>poj 3630 phone list</title>
      <link href="/2013/12/02/poj-3630-phone-list/"/>
      <url>/2013/12/02/poj-3630-phone-list/</url>
      <content type="html"><![CDATA[<p>方法一、先排序，前缀子串肯定是与父串挨着的<br><a id="more"></a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *b)</span><br></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcmp</span>((<span class="hljs-keyword">char</span>*)a, (<span class="hljs-keyword">char</span>*)b);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> num, n;<br>    <span class="hljs-keyword">char</span> tel[<span class="hljs-number">10005</span>][<span class="hljs-number">11</span>];<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;num);<br><br>    <span class="hljs-keyword">while</span> (num--) &#123;<br>        <span class="hljs-keyword">int</span> i, flag = <span class="hljs-number">1</span>;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; ++i)<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, tel[i]);<br><br>        qsort(tel, n, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>) * <span class="hljs-number">11</span>, cmp);<br><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; n; ++i) &#123;<br>            <span class="hljs-keyword">int</span> len1 = <span class="hljs-built_in">strlen</span>(tel[i<span class="hljs-number">-1</span>]);<br>            <span class="hljs-keyword">int</span> len2 = <span class="hljs-built_in">strlen</span>(tel[i]);<br>            <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">if</span> (len1 &lt;= len2) &#123;<br>                <span class="hljs-keyword">while</span>(tel[i<span class="hljs-number">-1</span>][j] == tel[i][j] &amp;&amp; j &lt; len1)<br>                    ++j;<br>                <span class="hljs-keyword">if</span> (j == len1)<br>                    flag = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!flag)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (flag)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"YES\n"</span>);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO\n"</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>方法二、传统trie树</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">int</span> cases, count;<br><span class="hljs-keyword">int</span> nodenum;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span><br>&#123;</span><br>    <span class="hljs-keyword">bool</span> isExist;<br>    node * branch[<span class="hljs-number">10</span>];<br>&#125;Node[<span class="hljs-number">100000</span>];<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trie</span><br>&#123;</span><br><span class="hljs-keyword">private</span>:<br>    node root;<br><span class="hljs-keyword">public</span>:<br>    Trie()&#123;root = Node[<span class="hljs-number">0</span>];&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">char</span> num[])</span><br>    </span>&#123;<br>        node *location = &amp;root;<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(num);<br>        <span class="hljs-keyword">while</span>(num[i])<br>        &#123;<br>            <span class="hljs-keyword">if</span>(i==len<span class="hljs-number">-1</span> &amp;&amp; location-&gt;branch[num[i]-<span class="hljs-string">'0'</span>] != <span class="hljs-literal">NULL</span>)<br>            &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(location-&gt;branch[num[i]-<span class="hljs-string">'0'</span>]==<span class="hljs-literal">NULL</span>)<br>            &#123;<br>                location-&gt;branch[num[i]-<span class="hljs-string">'0'</span>] = &amp;Node[nodenum];<br>                Node[nodenum].isExist = <span class="hljs-literal">false</span>;<br>                <span class="hljs-built_in">memset</span>(Node[nodenum].branch,<span class="hljs-literal">NULL</span>,<span class="hljs-keyword">sizeof</span>(Node[nodenum].branch));<br>                nodenum++;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(location-&gt;branch[num[i]-<span class="hljs-string">'0'</span>]-&gt;isExist == <span class="hljs-literal">true</span>)<br>            &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            location = location-&gt;branch[num[i]-<span class="hljs-string">'0'</span>];<br>            i++;<br>        &#125;<br>        location-&gt;isExist = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;cases);<br>    <span class="hljs-keyword">while</span>(cases--)<br>    &#123;<br>        nodenum = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">bool</span> flag = <span class="hljs-literal">true</span>;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;count);<br>        <span class="hljs-keyword">char</span> tel[<span class="hljs-number">11</span>];<br>        Trie t;<br>        <span class="hljs-keyword">while</span>(count--)<br>        &#123;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>,tel);<br>            <span class="hljs-keyword">if</span>(!t.insert(tel))<br>            &#123;<br>                flag = <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(flag)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"YES\n"</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO\n"</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>poj 2524 ubiquitous religions</title>
      <link href="/2013/12/02/poj-2524-ubiquitous-religions/"/>
      <url>/2013/12/02/poj-2524-ubiquitous-religions/</url>
      <content type="html"><![CDATA[<p>水题，并查集简单应用<br><a id="more"></a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 50005</span><br><span class="hljs-keyword">int</span> uf_set[N];<br><span class="hljs-keyword">int</span> sum;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Init</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-built_in">memset</span>(uf_set, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span>(uf_set));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Find</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (uf_set[x] &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> x;<br>    <span class="hljs-keyword">else</span> &#123;<br>        uf_set[x] = Find(uf_set[x]);<br>        <span class="hljs-keyword">return</span> uf_set[x];<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Union</span><span class="hljs-params">(<span class="hljs-keyword">int</span> r1, <span class="hljs-keyword">int</span> r2)</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> a = Find(r1);<br>    <span class="hljs-keyword">int</span> b = Find(r2);<br>    <span class="hljs-keyword">if</span> (a == b)<br>        <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span> (uf_set[a] &lt; uf_set[b]) &#123;<br>        uf_set[a] += uf_set[b];<br>        uf_set[b] = a;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        uf_set[b] += uf_set[a];<br>        uf_set[a] = b;<br>    &#125;<br>    --sum;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> c = <span class="hljs-number">1</span>, n, m;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);<br>        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        sum = n;<br>        Init();<br>        <span class="hljs-keyword">while</span> (m--) &#123;<br>            <span class="hljs-keyword">int</span> x, y;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y);<br>            Union(x, y);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Case %d: %d\n"</span>, c++, sum);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 3437 Tree Grafting</title>
      <link href="/2013/12/02/poj-3437-tree-grafting/"/>
      <url>/2013/12/02/poj-3437-tree-grafting/</url>
      <content type="html"><![CDATA[<p>当前结点在二叉树表示中的深度等于父结点深度加上当前节点左兄弟的个数再加1<br><a id="more"></a><br><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 40005</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">char</span> s[N];<br>    <span class="hljs-keyword">int</span> tree_depth;<br>    <span class="hljs-keyword">int</span> father[N];<br>    <span class="hljs-keyword">int</span> bi_depth[N];<br>    <span class="hljs-keyword">int</span> left_child[N];<br>    <span class="hljs-keyword">int</span> max_tree_depth, max_bi_depth;<br><br>    <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        ++num;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, s);<br>        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(s);<br>        <span class="hljs-keyword">if</span> (s[<span class="hljs-number">0</span>] == <span class="hljs-string">'#'</span>)<br>            <span class="hljs-keyword">break</span>;<br><br>        tree_depth = <span class="hljs-number">0</span>;<br>        max_tree_depth = <span class="hljs-number">0</span>;<br>        max_bi_depth = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">memset</span>(father, <span class="hljs-number">0</span>, N * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>        <span class="hljs-built_in">memset</span>(bi_depth, <span class="hljs-number">0</span>, N * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>        <span class="hljs-built_in">memset</span>(left_child, <span class="hljs-number">0</span>, N * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; ++i) &#123;<br>            <span class="hljs-keyword">if</span> (s[i<span class="hljs-number">-1</span>] == <span class="hljs-string">'d'</span>) &#123;<br>                ++tree_depth;<br>                <span class="hljs-keyword">if</span> (max_tree_depth &lt; tree_depth)<br>                    max_tree_depth = tree_depth;<br><br>                father[i] = i - <span class="hljs-number">1</span>;<br>                bi_depth[i] = bi_depth[i<span class="hljs-number">-1</span>] + left_child[i<span class="hljs-number">-1</span>] + <span class="hljs-number">1</span>;<br>                ++left_child[i<span class="hljs-number">-1</span>];<br>                <span class="hljs-keyword">if</span> (max_bi_depth &lt; bi_depth[i])<br>                    max_bi_depth = bi_depth[i];<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s[i<span class="hljs-number">-1</span>] == <span class="hljs-string">'u'</span>) &#123;<br>                --tree_depth;<br>                bi_depth[i] = bi_depth[father[i<span class="hljs-number">-1</span>]];<br>                left_child[i] = left_child[father[i<span class="hljs-number">-1</span>]];<br>                father[i] = father[father[i<span class="hljs-number">-1</span>]];<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Tree %d: %d =&gt; %d\n"</span>, num, max_tree_depth, max_bi_depth);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>算法：工作分配</title>
      <link href="/2013/11/13/%E7%AE%97%E6%B3%95%EF%BC%9A%E5%B7%A5%E4%BD%9C%E5%88%86%E9%85%8D/"/>
      <url>/2013/11/13/%E7%AE%97%E6%B3%95%EF%BC%9A%E5%B7%A5%E4%BD%9C%E5%88%86%E9%85%8D/</url>
      <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>设有n件工作分配给n个人。工人i完成工作j所需的费用为c[i][j] 。试设计一个算法，计算最佳工作分配方案，为每一个人都分配1 件不同的工作，并使总费用达到最小。</p><h2 id="方法一：回溯法"><a href="#方法一：回溯法" class="headerlink" title="方法一：回溯法"></a>方法一：回溯法</h2><p>n分作业分配给n个人，共有n!中排列方式，深度优先遍历其排列数，如果遍历的路径已经比当前最小的话费则舍弃对当前路径的遍历，返回上层节点，寻找合适的路径，即回溯，如果最后可行解比当前的最小费用小，那么就更新最佳的作业安排顺序，同时更新最小的耗费时间。<a id="more"></a></p><p>由于每个人都必须分配到工作，在这里可以建一个二维数组c[i][j]，用以表示工人i完成j所需的费用。给定一个循环，从第1个工人开始循环分配工作，直到所有工人都分配完。分配第k个工人时，再循环检查每个工作是否已被分配，没有则分配给k号工人，否则检查下一个工作。</p><p><strong>递归版</strong></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stddef.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-keyword">int</span> N;          <span class="hljs-comment">/*表示任务数和工人数*/</span><br><br><span class="hljs-comment">//c[i][j] 工人i完成工作j所需的费用</span><br><span class="hljs-comment">//task[i] 值为0表示任务i未分配，值为1表示任务已分配</span><br><span class="hljs-comment">//work[k] 值为0表示工人k未分配任务，值为j表示工人k已分配任务j</span><br><span class="hljs-comment">//mincost 最小总费用</span><br><span class="hljs-keyword">int</span> **c;<br><span class="hljs-keyword">int</span> mincost = INT32_MAX;<br><span class="hljs-keyword">int</span> *task, *temp, *worker;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Plan</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> cost)</span><br></span>&#123;<br><span class="hljs-keyword">int</span> i, j;<br><span class="hljs-keyword">if</span> (k &gt;= N &amp;&amp; cost &lt; mincost) &#123;<br>mincost = cost;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>temp[i] = task[i];  <span class="hljs-comment">//记录工作分配，如只要输出最小费用，无需输出分配情况，可删除此循环及work, temp数组</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; N; j++)<br><span class="hljs-keyword">if</span> (task[j] == <span class="hljs-number">0</span> &amp;&amp; cost + c[k][j] &lt; mincost) &#123;<br>worker[k] = j; task[j] = <span class="hljs-number">1</span>;  <span class="hljs-comment">//分配</span><br>Plan(k + <span class="hljs-number">1</span>, cost + c[k][j]);<br>worker[k] = <span class="hljs-number">0</span>;  task[j] = <span class="hljs-number">0</span>;  <span class="hljs-comment">//回溯</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span><br></span>&#123;<br><span class="hljs-keyword">int</span> i, j;<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;N);<br><br>c = (<span class="hljs-keyword">int</span> **)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span> *) * N);<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>c[i] = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>) * N);<br>task = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>) * N);<br>worker = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>) * N);<br>temp = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>) * N);<br><br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++) &#123;<br>worker[i] = <span class="hljs-number">0</span>; task[i] = <span class="hljs-number">0</span>; temp[i] = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; N; j++)<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;c[i][j]);<br><span class="hljs-comment">//mincost += c[i][i];</span><br>&#125;<br>Plan(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-built_in">free</span>(task);<br><span class="hljs-built_in">free</span>(worker);<br><span class="hljs-built_in">free</span>(temp);<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br><span class="hljs-built_in">free</span>(c[i]);<br><span class="hljs-built_in">free</span>(c);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n Mincost = %d\n"</span>, mincost);<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"Worker %d is assigned task %d\n"</span>, i, temp[i]);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>高效版</strong></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;malloc.h&gt;</span></span><br><br><span class="hljs-keyword">int</span> **aray;<br><span class="hljs-keyword">int</span> *<span class="hljs-built_in">list</span>;<br><span class="hljs-keyword">int</span> number;<br><span class="hljs-keyword">int</span> final_cost = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> current_cost = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a,<span class="hljs-keyword">int</span> *b)</span><br></span>&#123;<br><span class="hljs-keyword">int</span> temp;<br>temp = *a;<br>*a = *b;<br>*b = temp;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span><br></span>&#123;<br><span class="hljs-keyword">int</span> i;<br><span class="hljs-keyword">if</span>(k &gt;= number)<br>&#123;<br>final_cost=current_cost;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">for</span>(i = k; i &lt; number; i++)<br>&#123;<br>current_cost += aray[k][<span class="hljs-built_in">list</span>[i]];<br><span class="hljs-keyword">if</span>(current_cost &lt; final_cost)<br>&#123;<br>swap(&amp;<span class="hljs-built_in">list</span>[k], &amp;<span class="hljs-built_in">list</span>[i]);<br>search(k+<span class="hljs-number">1</span>);<br>swap(&amp;<span class="hljs-built_in">list</span>[k], &amp;<span class="hljs-built_in">list</span>[i]);<br>&#125;<br>current_cost -= aray[k][<span class="hljs-built_in">list</span>[i]];<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>&#123;<br><span class="hljs-keyword">int</span> m;<br><span class="hljs-keyword">int</span> i,j;<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;number);<br><br>aray = (<span class="hljs-keyword">int</span> **)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span> *)*number);<br><span class="hljs-built_in">list</span> = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)*number);<br><br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; number; i++)<br><span class="hljs-built_in">list</span>[i] = i;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>;i &lt; number; i++)<br>aray[i] = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)*number);<br><br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; number; i++)<br>&#123;<br><span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; number; j++)<br>&#123;<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;aray[i][j]);<br>&#125;<br>final_cost += aray[i][i];<br>&#125;<br>search(<span class="hljs-number">0</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, final_cost);<br><br><span class="hljs-built_in">free</span>(<span class="hljs-built_in">list</span>);<br><span class="hljs-built_in">free</span>(aray);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="方法二：匈牙利算法"><a href="#方法二：匈牙利算法" class="headerlink" title="方法二：匈牙利算法"></a>方法二：匈牙利算法</h2><p><a href="http://zh.wikipedia.org/wiki/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">http://zh.wikipedia.org/wiki/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95</a></p><p><a href="http://community.topcoder.com/tc?module=Static&amp;d1=tutorials&amp;d2=hungarianAlgorithm" target="_blank" rel="noopener">http://community.topcoder.com/tc?module=Static&amp;d1=tutorials&amp;d2=hungarianAlgorithm</a></p><p>其基本的理论基础是针对cost矩阵，将cost矩阵的一行或一列数据加上或减去一个数，其最优任务分配求解问题不变。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 55             <span class="hljs-comment">//max number of vertices in one part</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 100000000    <span class="hljs-comment">//just infinity</span></span><br><br><span class="hljs-keyword">int</span> cost[N][N];          <span class="hljs-comment">//cost matrix</span><br><span class="hljs-keyword">int</span> n, max_match;        <span class="hljs-comment">//n workers and n jobs</span><br><span class="hljs-keyword">int</span> lx[N], ly[N];        <span class="hljs-comment">//labels of X and Y parts</span><br><span class="hljs-keyword">int</span> xy[N];               <span class="hljs-comment">//xy[x] - vertex that is matched with x,</span><br><span class="hljs-keyword">int</span> yx[N];               <span class="hljs-comment">//yx[y] - vertex that is matched with y</span><br><span class="hljs-keyword">bool</span> S[N], T[N];         <span class="hljs-comment">//sets S and T in algorithm</span><br><span class="hljs-keyword">int</span> slack[N];            <span class="hljs-comment">//as in the algorithm description</span><br><span class="hljs-keyword">int</span> slackx[N];           <span class="hljs-comment">//slackx[y] such a vertex, that</span><br>                         <span class="hljs-comment">// l(slackx[y]) + l(y) - w(slackx[y],y) = slack[y]</span><br><span class="hljs-keyword">int</span> prev[N];             <span class="hljs-comment">//array for memorizing alternating paths</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_labels</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-built_in">memset</span>(lx, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(lx));<br>    <span class="hljs-built_in">memset</span>(ly, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(ly));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; n; x++)<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; n; y++)<br>            lx[x] = max(lx[x], cost[x][y]);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">augment</span><span class="hljs-params">()</span>                         <span class="hljs-comment">//main function of the algorithm</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (max_match == n) <span class="hljs-keyword">return</span>;        <span class="hljs-comment">//check wether matching is already perfect</span><br>    <span class="hljs-keyword">int</span> x, y, root;                    <span class="hljs-comment">//just counters and root vertex</span><br>    <span class="hljs-keyword">int</span> q[N], wr = <span class="hljs-number">0</span>, rd = <span class="hljs-number">0</span>;          <span class="hljs-comment">//q - queue for bfs, wr,rd - write and read</span><br>                                       <span class="hljs-comment">//pos in queue</span><br>    <span class="hljs-built_in">memset</span>(S, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span>(S));       <span class="hljs-comment">//init set S</span><br>    <span class="hljs-built_in">memset</span>(T, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span>(T));       <span class="hljs-comment">//init set T</span><br>    <span class="hljs-built_in">memset</span>(prev, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span>(prev));    <span class="hljs-comment">//init set prev - for the alternating tree</span><br>    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; n; x++)            <span class="hljs-comment">//finding root of the tree</span><br>        <span class="hljs-keyword">if</span> (xy[x] == <span class="hljs-number">-1</span>)<br>        &#123;<br>            q[wr++] = root = x;<br>            prev[x] = <span class="hljs-number">-2</span>;<br>            S[x] = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)            <span class="hljs-comment">//initializing slack array</span><br>    &#123;<br>        slack[y] = lx[root] + ly[y] - cost[root][y];<br>        slackx[y] = root;<br>    &#125;<br>    <span class="hljs-comment">//second part of augment() function</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)                                                        <span class="hljs-comment">//main cycle</span><br>    &#123;<br>        <span class="hljs-keyword">while</span> (rd &lt; wr)                                                 <span class="hljs-comment">//building tree with bfs cycle</span><br>        &#123;<br>            x = q[rd++];                                                <span class="hljs-comment">//current vertex from X part</span><br>            <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)                                     <span class="hljs-comment">//iterate through all edges in equality graph</span><br>                <span class="hljs-keyword">if</span> (cost[x][y] == lx[x] + ly[y] &amp;&amp;  !T[y])<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (yx[y] == <span class="hljs-number">-1</span>) <span class="hljs-keyword">break</span>;                             <span class="hljs-comment">//an exposed vertex in Y found, so</span><br>                                                                        <span class="hljs-comment">//augmenting path exists!</span><br>                    T[y] = <span class="hljs-literal">true</span>;                                        <span class="hljs-comment">//else just add y to T,</span><br>                    q[wr++] = yx[y];                                    <span class="hljs-comment">//add vertex yx[y], which is matched</span><br>                                                                        <span class="hljs-comment">//with y, to the queue</span><br>                    add_to_tree(yx[y], x);                              <span class="hljs-comment">//add edges (x,y) and (y,yx[y]) to the tree</span><br>                &#125;<br>            <span class="hljs-keyword">if</span> (y &lt; n) <span class="hljs-keyword">break</span>;                                           <span class="hljs-comment">//augmenting path found!</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (y &lt; n) <span class="hljs-keyword">break</span>;                                               <span class="hljs-comment">//augmenting path found!</span><br><br>        update_labels();                                                <span class="hljs-comment">//augmenting path not found, so improve labeling</span><br>        wr = rd = <span class="hljs-number">0</span>;                <br>        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)        <br>        <span class="hljs-comment">//in this cycle we add edges that were added to the equality graph as a</span><br>        <span class="hljs-comment">//result of improving the labeling, we add edge (slackx[y], y) to the tree if</span><br>        <span class="hljs-comment">//and only if !T[y] &amp;&amp;  slack[y] == 0, also with this edge we add another one</span><br>        <span class="hljs-comment">//(y, yx[y]) or augment the matching, if y was exposed</span><br>            <span class="hljs-keyword">if</span> (!T[y] &amp;&amp;  slack[y] == <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (yx[y] == <span class="hljs-number">-1</span>)                                        <span class="hljs-comment">//exposed vertex in Y found - augmenting path exists!</span><br>                &#123;<br>                    x = slackx[y];<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    T[y] = <span class="hljs-literal">true</span>;                                        <span class="hljs-comment">//else just add y to T,</span><br>                    <span class="hljs-keyword">if</span> (!S[yx[y]])<br>                    &#123;<br>                        q[wr++] = yx[y];                                <span class="hljs-comment">//add vertex yx[y], which is matched with</span><br>                                                                        <span class="hljs-comment">//y, to the queue</span><br>                        add_to_tree(yx[y], slackx[y]);                  <span class="hljs-comment">//and add edges (x,y) and (y,</span><br>                                                                        <span class="hljs-comment">//yx[y]) to the tree</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>        <span class="hljs-keyword">if</span> (y &lt; n) <span class="hljs-keyword">break</span>;                                               <span class="hljs-comment">//augmenting path found!</span><br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (y &lt; n)                                                          <span class="hljs-comment">//we found augmenting path!</span><br>    &#123;<br>        max_match++;                                                    <span class="hljs-comment">//increment matching</span><br>        <span class="hljs-comment">//in this cycle we inverse edges along augmenting path</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> cx = x, cy = y, ty; cx != <span class="hljs-number">-2</span>; cx = prev[cx], cy = ty)<br>        &#123;<br>            ty = xy[cx];<br>            yx[cy] = cx;<br>            xy[cx] = cy;<br>        &#125;<br>        augment();                                                      <span class="hljs-comment">//recall function, go to step 1 of the algorithm</span><br>    &#125;<br>&#125;<span class="hljs-comment">//end of augment() function</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update_labels</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> x, y, delta = INF;             <span class="hljs-comment">//init delta as infinity</span><br>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)            <span class="hljs-comment">//calculate delta using slack</span><br>        <span class="hljs-keyword">if</span> (!T[y])<br>            delta = min(delta, slack[y]);<br>    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; n; x++)            <span class="hljs-comment">//update X labels</span><br>        <span class="hljs-keyword">if</span> (S[x]) lx[x] -= delta;<br>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)            <span class="hljs-comment">//update Y labels</span><br>        <span class="hljs-keyword">if</span> (T[y]) ly[y] += delta;<br>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; n; y++)            <span class="hljs-comment">//update slack array</span><br>        <span class="hljs-keyword">if</span> (!T[y])<br>            slack[y] -= delta;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_to_tree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> prevx)</span> <br><span class="hljs-comment">//x - current vertex,prevx - vertex from X before x in the alternating path,</span><br><span class="hljs-comment">//so we add edges (prevx, xy[x]), (xy[x], x)</span><br></span>&#123;<br>    S[x] = <span class="hljs-literal">true</span>;                    <span class="hljs-comment">//add x to S</span><br>    prev[x] = prevx;                <span class="hljs-comment">//we need this when augmenting</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; n; y++)    <span class="hljs-comment">//update slacks, because we add new vertex to S</span><br>        <span class="hljs-keyword">if</span> (lx[x] + ly[y] - cost[x][y] &lt; slack[y])<br>        &#123;<br>            slack[y] = lx[x] + ly[y] - cost[x][y];<br>            slackx[y] = x;<br>        &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hungarian</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;                      <span class="hljs-comment">//weight of the optimal matching</span><br>    max_match = <span class="hljs-number">0</span>;                    <span class="hljs-comment">//number of vertices in current matching</span><br>    <span class="hljs-built_in">memset</span>(xy, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span>(xy));<br>    <span class="hljs-built_in">memset</span>(yx, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span>(yx));<br>    init_labels();                    <span class="hljs-comment">//step 0</span><br>    augment();                        <span class="hljs-comment">//steps 1-3</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; n; x++)       <span class="hljs-comment">//forming answer there</span><br>        ret += cost[x][xy[x]];<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>二叉树的重建</title>
      <link href="/2013/11/12/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%87%8D%E5%BB%BA/"/>
      <url>/2013/11/12/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%87%8D%E5%BB%BA/</url>
      <content type="html"><![CDATA[<p>对于二叉树，中序加其它任何一个序列（前序、后序、层序）即可重建二叉树，其它序列组合则不能重建。<a id="more"></a></p><p>下面以中序和后序为例</p><p>输入</p><p>第一行为一个整数n。</p><p>第二、三行，即已知的中序、后序遍历序列。</p><p>输出</p><p>若所给的中序、后序遍历序列的确对应于某棵二叉树，则输出其先序遍历序列。否则，输出-1。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><br><span class="hljs-keyword">bool</span> flag = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">int</span> *inmap;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span><br>    <span class="hljs-keyword">int</span> data;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> *<span class="hljs-title">left</span>, *<span class="hljs-title">right</span>;</span><br><br>    Node(<span class="hljs-keyword">int</span> elem): data(elem), left(<span class="hljs-literal">NULL</span>), right(<span class="hljs-literal">NULL</span>) &#123; &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rebuildInPost</span><span class="hljs-params">(Node **p, <span class="hljs-keyword">int</span> *in, <span class="hljs-keyword">int</span> beginI, <span class="hljs-keyword">int</span> endI, <span class="hljs-keyword">int</span> *post, <span class="hljs-keyword">int</span> beginP, <span class="hljs-keyword">int</span> endP)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (!flag) &#123;<br>        <span class="hljs-keyword">if</span>(beginI &gt; endI || beginP &gt; endP)<br>            <span class="hljs-keyword">return</span>;<br><br>        <span class="hljs-keyword">int</span> elem = post[endP];<br>        <span class="hljs-keyword">int</span> i;<br>        i = inmap[elem] - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (i &gt; endI) &#123;<br>            flag = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">int</span> leftNum = i - beginI;<br>        *p = <span class="hljs-keyword">new</span> Node(elem);<br>        rebuildInPost(&amp;((*p)-&gt;left), in, beginI, i<span class="hljs-number">-1</span>, post, beginP, beginP+leftNum<span class="hljs-number">-1</span>);<br>        rebuildInPost(&amp;((*p)-&gt;right), in, i+<span class="hljs-number">1</span>, endI, post, beginP+leftNum, endP<span class="hljs-number">-1</span>);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">preOrder</span><span class="hljs-params">(Node *root)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">cout</span> &lt;&lt; root-&gt;data &lt;&lt; <span class="hljs-string">" "</span>;<br>        preOrder(root-&gt;left);<br>        preOrder(root-&gt;right);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">freeTree</span><span class="hljs-params">(Node *root)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>;<br><br>    freeTree(root-&gt;left);<br>    freeTree(root-&gt;right);<br><br>    <span class="hljs-keyword">delete</span> root;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> num;<br>    <span class="hljs-built_in">cin</span> &gt;&gt; num;<br>    <span class="hljs-keyword">int</span> *in = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[num];<br>    <span class="hljs-keyword">int</span> *post = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[num];<br>    inmap = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[num + <span class="hljs-number">1</span>];<br><br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; num; i++)<br>        <span class="hljs-built_in">cin</span> &gt;&gt; in[i];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; num; i++)<br>        <span class="hljs-built_in">cin</span> &gt;&gt; post[i];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt;= num; i++)<br>        inmap[in[i - <span class="hljs-number">1</span>]] = i;<br><br>    Node *root = <span class="hljs-literal">NULL</span>;<br>    rebuildInPost(&amp;root, in, <span class="hljs-number">0</span>, num - <span class="hljs-number">1</span>, post, <span class="hljs-number">0</span>, num - <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> (flag)<br>        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"-1"</span>;<br>    <span class="hljs-keyword">else</span><br>        preOrder(root);<br><br>    freeTree(root);<br>    <span class="hljs-keyword">delete</span> []in;<br>    <span class="hljs-keyword">delete</span> []post;<br>    <span class="hljs-keyword">delete</span> []inmap;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 2820 Ancient Cipher 古代密码</title>
      <link href="/2013/11/01/poj-2820-ancient-cipher-%E5%8F%A4%E4%BB%A3%E5%AF%86%E7%A0%81/"/>
      <url>/2013/11/01/poj-2820-ancient-cipher-%E5%8F%A4%E4%BB%A3%E5%AF%86%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>摘要： 巧妙的解法，借鉴了别人的 只要看字母频率就可以直接得出结论<br><a id="more"></a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> * a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> * b)</span><br></span>&#123;<br>    <span class="hljs-keyword">return</span> *(<span class="hljs-keyword">int</span> *)a - *(<span class="hljs-keyword">int</span> *)b;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-keyword">char</span> cipher[<span class="hljs-number">105</span>];<br>    <span class="hljs-keyword">char</span> origin[<span class="hljs-number">105</span>];<br>    <span class="hljs-keyword">int</span> ctime[<span class="hljs-number">26</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-keyword">int</span> otime[<span class="hljs-number">26</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%s"</span>, cipher, origin);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(cipher); i++)<br>    &#123;<br>        ctime[cipher[i] - <span class="hljs-string">'A'</span>]++;<br>        otime[origin[i] - <span class="hljs-string">'A'</span>]++;<br>    &#125;<br>    qsort(ctime, <span class="hljs-number">26</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), cmp);<br>    qsort(otime, <span class="hljs-number">26</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), cmp);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">26</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(ctime[i] != otime[i])<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO"</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"YES"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>poj 1961 求某串中所有循环前缀串的长度和循环次数</title>
      <link href="/2013/10/30/poj-1961-%E6%B1%82%E6%9F%90%E4%B8%B2%E4%B8%AD%E6%89%80%E6%9C%89%E5%BE%AA%E7%8E%AF%E5%89%8D%E7%BC%80%E4%B8%B2%E7%9A%84%E9%95%BF%E5%BA%A6%E5%92%8C%E5%BE%AA%E7%8E%AF%E6%AC%A1%E6%95%B0/"/>
      <url>/2013/10/30/poj-1961-%E6%B1%82%E6%9F%90%E4%B8%B2%E4%B8%AD%E6%89%80%E6%9C%89%E5%BE%AA%E7%8E%AF%E5%89%8D%E7%BC%80%E4%B8%B2%E7%9A%84%E9%95%BF%E5%BA%A6%E5%92%8C%E5%BE%AA%E7%8E%AF%E6%AC%A1%E6%95%B0/</url>
      <content type="html"><![CDATA[<p>kmp算法的应用，和poj 2406类似</p><p>如果长度为l的前缀是由字符串重复构成的，则next[l] != 0，且此时构成前缀的重复子串的最小长度为l - next[l]，l % (l - next[l]) = 0，最大重复次数为l / (l - next[l])。<a id="more"></a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 1000010</span><br><span class="hljs-keyword">char</span> str[N];<br><span class="hljs-keyword">int</span> next[N], len;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_next</span><span class="hljs-params">()</span><br></span>&#123;<br>    next[<span class="hljs-number">0</span>] = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> j = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">while</span> (i &lt; len)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (j == <span class="hljs-number">-1</span> || str[i] == str[j])<br>        &#123;<br>            i++; j++;<br>            next[i] = j;<br>        &#125;<br>        <span class="hljs-keyword">else</span> j = next[j];<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> count = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;len) &amp;&amp; len)<br>    &#123;<br>        <span class="hljs-built_in">memset</span>(str, <span class="hljs-number">0</span>, N);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, str);<br>        get_next();<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Test case #%d\n"</span>, count++);<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">2</span>; i &lt;= len; i++)<br>            <span class="hljs-keyword">if</span> (next[i] &amp;&amp; i % (i - next[i]) == <span class="hljs-number">0</span>)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d %d\n"</span>, i, i / (i - next[i]));<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>约瑟夫问题 Josephus Problem</title>
      <link href="/2013/10/29/%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98-josephus-problem/"/>
      <url>/2013/10/29/%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98-josephus-problem/</url>
      <content type="html"><![CDATA[<p>约瑟夫问题（Josephus Problem）</p><p>据说着名犹太历史学家 Josephus有过以下的故事：在罗马人占领乔塔帕特后，39 个犹太人与Josephus及他的朋友躲到一个洞中，39个犹太人决定宁愿死也不要被敌人抓到，于是决定了一个自杀方式，41个人排成一个圆圈，由第1个人 开始报数，每报数到第3人该人就必须自杀，然后再由下一个重新报数，直到所有人都自杀身亡为止。</p><p>然而Josephus 和他的朋友并不想遵从，Josephus要他的朋友先假装遵从，他将朋友与自己安排在第16个与第31个位置，于是逃过了这场死亡游戏。</p><p>UVA <a href="http://uva.onlinejudge.org/external/1/133.html" target="_blank" rel="noopener">133</a> <a href="http://uva.onlinejudge.org/external/3/305.html" target="_blank" rel="noopener">305</a> <a href="http://uva.onlinejudge.org/external/4/402.html" target="_blank" rel="noopener">402</a> <a href="http://uva.onlinejudge.org/external/100/10015.html" target="_blank" rel="noopener">10015</a><a id="more"></a></p><h2 id="方法一、直接模拟求解"><a href="#方法一、直接模拟求解" class="headerlink" title="方法一、直接模拟求解"></a>方法一、直接模拟求解</h2><p>只要画两个圆圈就可以让自己与朋友免于死亡游戏，这两个圆圈内圈是排列顺序，而外圈是自杀顺序，如下图所示：</p><p><img src="/img/josephus.jpg" alt="josephus"></p><p>使用程式来求解的话，只要将阵列当作环状来处理就可以了，在阵列中由计数1开始，每找到三个无资料区就填入一个计数，直而计数达41为止，然后将阵列由索引1开始列出，就可以得知每个位置的自杀顺序，这就是约瑟夫排列，41个人而报数3的约琴夫排列如下所示：</p><p>14 36 1 38 15 2 24 30 3 16 34 4 25 17 5 40 31 6 18 26 7 37 19 8 35 27 9 20 32 10 41 21 11 28 39 12 22 33 13 29 23</p><p>由上可知，最后一个自杀的是在第31个位置，而倒数第二个自杀的要排在第16个位置，之前的人都死光了，所以他们也就不知道约琴夫与他的朋友并没有遵守游戏规则了。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 41</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M 3</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> man[N] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-keyword">int</span> count = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, pos = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">int</span> alive = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">while</span>(count &lt;= N) &#123;<br>        <span class="hljs-keyword">do</span> &#123;<br>            pos = (pos+<span class="hljs-number">1</span>) % N;  <span class="hljs-comment">// 环状处理</span><br>            <span class="hljs-keyword">if</span>(man[pos] == <span class="hljs-number">0</span>)<br>                i++;<br><br>            <span class="hljs-keyword">if</span>(i == M) &#123;  <span class="hljs-comment">// 报数为3了</span><br>                i = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);<br><br>        man[pos] = count;<br>        count++;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n约琴夫排列："</span>);<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, man[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n\n您想要救多少人？"</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;alive);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nL表示这%d人要放的位置：\n"</span>, alive);<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; N; i++) &#123;<br>        <span class="hljs-keyword">if</span>(man[i] &lt;= N - alive) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"D"</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"L"</span>);<br>        <span class="hljs-keyword">if</span>((i+<span class="hljs-number">1</span>) % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"  "</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>也可以用队列模拟，首先把每个人依序进队，pop (m - 1)个人，push 到队尾，第 m 人直接出队。</p><p>时间复杂度分析：推广到n个人，间隔m个人杀一个，时间复杂度为O(mn)</p><h2 id="方法二、动态规划"><a href="#方法二、动态规划" class="headerlink" title="方法二、动态规划"></a>方法二、动态规划</h2><p><a href="http://en.wikipedia.org/wiki/Josephus_problem" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Josephus_problem</a></p><p><img src="/img/Josephus2.png" alt="josephusDY"></p><p>除去一人后，剩下来的人重新编号，就变成了子问题了。观察原编号和新编号的关系，可得到递推公式</p><pre><code>f(n, m) = (f(n - 1, m) + m) % nf(1, m) = 0</code></pre><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">josephus</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> m)</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> answer = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i)<br>        answer = (answer + m) % i;<br>    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"存活的人是"</span> &lt;&lt; answer &lt;&lt; <span class="hljs-string">"号"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>vim Youcompleteme on 64bit Windows</title>
      <link href="/2013/10/29/vim-youcompleteme-on-64bit-windows/"/>
      <url>/2013/10/29/vim-youcompleteme-on-64bit-windows/</url>
      <content type="html"><![CDATA[<p>摘要：64bit vim, YCM, 64bit clang VS 2012, 64bit Widnows<br><a id="more"></a></p><h2 id="vim-x64-for-windows"><a href="#vim-x64-for-windows" class="headerlink" title="vim x64 for windows"></a>vim x64 for windows</h2><p><a href="https://bitbucket.org/Haroogan/vim-for-windows" target="_blank" rel="noopener">https://bitbucket.org/Haroogan/vim-for-windows</a></p><p>或 <a href="https://bintray.com/veegee/generic/vim_x64" target="_blank" rel="noopener">https://bintray.com/veegee/generic/vim_x64</a></p><p>vim 插件管理 Vundle 或NeoBundle</p><p><a href="https://github.com/Shougo/neobundle.vim" target="_blank" rel="noopener">https://github.com/Shougo/neobundle.vim</a></p><h2 id="MinGW-环境"><a href="#MinGW-环境" class="headerlink" title="MinGW 环境"></a>MinGW 环境</h2><p><a href="https://bitbucket.org/Haroogan/vim-youcompleteme-for-windows/src" target="_blank" rel="noopener">https://bitbucket.org/Haroogan/vim-youcompleteme-for-windows/src</a></p><p>查找头文件目录，添加到.ycm_extra_conf.py</p><pre><code>g++ -E -x c++ - -v &lt; /dev/nullclang++ -E -x c++ - -v &lt; /dev/null</code></pre><p>Or in Windows Command Prompt:</p><pre><code>g++ -E -x c++ - -v &lt; nulclang++ -E -x c++ - -v &lt; nul</code></pre><h2 id="VS2012-环境"><a href="#VS2012-环境" class="headerlink" title="VS2012 环境"></a>VS2012 环境</h2><h3 id="LLVM-CLANG-x64-for-windows"><a href="#LLVM-CLANG-x64-for-windows" class="headerlink" title="LLVM/CLANG x64 for windows"></a>LLVM/CLANG x64 for windows</h3><p><a href="http://my.oschina.net/GIIoOS/blog/165542" target="_blank" rel="noopener">http://my.oschina.net/GIIoOS/blog/165542</a></p><p><a href="https://sourceforge.net/projects/clangonwin/" target="_blank" rel="noopener">https://sourceforge.net/projects/clangonwin/</a></p><p>需要 VS 2012</p><p>cmake</p><p>git for windows <a href="http://msysgit.github.io/" target="_blank" rel="noopener">http://msysgit.github.io/</a></p><h3 id="编译-YCM"><a href="#编译-YCM" class="headerlink" title="编译 YCM"></a>编译 YCM</h3><p>下面主角登场了</p><pre><code>cmake -G &quot;Visual Studio 11 Win64&quot; -DPATH_TO_LLVM_ROOT=d:\library\LLVM34 -DUSE_CLANG_COMPLETER=1 -DEXTERNAL_LIBCLANG_PATH=d:\library\LLVM34\lib\libclang.lib -DPYTHON_LIBRARY=D:\library\Python27\libs\python27.lib -DPYTHON_INCLUDE_DIR=D:\library\Python27\include . &lt;USERFOLDER&gt;\.vim\bundle\YouCompleteme\cpp</code></pre><p>_vimrc配置</p><pre><code>let g:ycm_key_list_select_completion = [&apos;&lt;C-TAB&gt;&apos;, &apos;&lt;Down&gt;&apos;]let g:ycm_key_list_previous_completion = [&apos;&lt;C-S-TAB&gt;&apos;, &apos;&lt;Up&gt;&apos;]let g:SuperTabDefaultCompletionType = &apos;&lt;C-Tab&gt;&apos;let g:ycm_global_ycm_extra_conf = &apos;PATHTO\.vim\dot.ycm_extra_conf.py&apos;</code></pre><p>dot.ycm_extra_conf.py 配置添加</p><p>‘-I’,<br>‘C:\Program Files (x86)\Microsoft Visual Studio 11.0\VC\include’</p><p>我们一般把“-I”用作自己的代码，”-isystem”用作第三代码。这样编译代码的时候，第三方代码编译时的warning，就不会显示出来，只需要专注在自己写的代码。</p><h2 id="与SuperTab、UltiSnips配合"><a href="#与SuperTab、UltiSnips配合" class="headerlink" title="与SuperTab、UltiSnips配合"></a>与SuperTab、UltiSnips配合</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&quot;supertab插件<br>let g:SuperTabDefaultCompletionType = &quot;context&quot; &quot;自动检测需要补全什么内容<br>let g:SuperTabCompletionContexts = [&apos;s:ContextText&apos;, &apos;s:ContextDiscover&apos;]<br>let g:SuperTabContextDiscoverDiscovery = [&quot;&amp;completefunc:&lt;c-x&gt;&lt;c-u&gt;&quot;, &quot;&amp;omnifunc:&lt;c-x&gt;&lt;c-o&gt;&quot;]<br>&quot;let g:SuperTabContextDefaultCompletionType = &apos;&lt;c-n&gt;&apos;设置补全方式<br>&quot;let g:SuperTabRetainCompletionType=2        &quot;记住上次的补全方式，直到退出插入模式<br><br>let g:ycm_key_list_select_completion = [&apos;&lt;C-TAB&gt;&apos;, &apos;&lt;Down&gt;&apos;]<br>let g:ycm_key_list_previous_completion = [&apos;&lt;C-S-TAB&gt;&apos;, &apos;&lt;Up&gt;&apos;]<br>let g:SuperTabDefaultCompletionType = &apos;&lt;C-Tab&gt;&apos;<br>&quot;let g:ycm_collect_identifiers_from_tags_files = 1<br>&quot;let g:ycm_autoclose_preview_window_after_completion=1<br>nnoremap &lt;leader&gt;jd :YcmCompleter GoToDefinitionElseDeclaration&lt;CR&gt;<br><br>&quot;let g:UltiSnipsExpandTrigger=&quot;&lt;c-j&gt;&quot;<br>&quot;let g:UltiSnipsJumpForwardTrigger=&quot;&lt;c-j&gt;&quot;<br>&quot;let g:UltiSnipsJumpBackwardTrigger=&quot;&lt;c-k&gt;&quot;<br></code></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>递归算法转换为非递归算法</title>
      <link href="/2013/10/29/%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95%E8%BD%AC%E6%8D%A2%E4%B8%BA%E9%9D%9E%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95/"/>
      <url>/2013/10/29/%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95%E8%BD%AC%E6%8D%A2%E4%B8%BA%E9%9D%9E%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>递归算法实际上是一种分而治之的方法，它把复杂问题分解为简单问题来求解。对于某些复杂问题(例如hanio塔问题)，递归算法是一种自然且合乎逻辑的解决问题的方式，但是递归算法的执行效率通常比较差。因此，在求解某些问题时，常采用递归算法来分析问题，用非递归算法来求解问题；另外，有些程序设计语言不支持递归，这就需要把递归算法转换为非递归算法。</p><p>将递归算法转换为非递归算法有两种方法，一种是直接求值，不需要回溯；另一种是不能直接求值，需要回溯。前者使用一些变量保存中间结果，称为直接转换法；后者使用栈保存中间结果，称为间接转换法，下面分别讨论这两种方法。<br><a id="more"></a></p><h2 id="直接转换法"><a href="#直接转换法" class="headerlink" title="直接转换法"></a>直接转换法</h2><p>直接转换法通常用来消除尾递归和单向递归，将递归结构用循环结构来替代。</p><p>尾递归是指在递归算法中，递归调用语句只有一个，而且是处在算法的最后。对于尾递归形式的递归算法，可以利用循环结构来替代。</p><p>单向递归是指递归算法中虽然有多处递归调用语句，但各递归调用语句的参数之间没有关系，并且这些递归调用语句都处在递归算法的最后。显然，尾递归是单向递归的特例。对于单向递归，可以设置一些变量保存中间结构，将递归结构用循环结构来替代。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//斐波那契数列</span><br><span class="hljs-comment">//递归</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (n= =<span class="hljs-number">1</span> | | n= =<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>　　    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> f(n<span class="hljs-number">-1</span>)+f(n<span class="hljs-number">-2</span>);<br>&#125;<br><br><span class="hljs-comment">//非递归</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span><br></span>&#123;<br>　　<span class="hljs-keyword">int</span> i, s;<br>      <span class="hljs-keyword">if</span>(n&lt;<span class="hljs-number">0</span>)<br>          <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n&lt;<span class="hljs-number">3</span>)<br>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>　　<span class="hljs-keyword">int</span> s1=<span class="hljs-number">1</span>, s2=<span class="hljs-number">1</span>;<br>　　<span class="hljs-keyword">for</span> (i=<span class="hljs-number">3</span>; i &lt;n; i++)<br>     &#123;<br>　　     s=s1+s2;<br>　　     s2=s1; <span class="hljs-comment">// 保存f(n-2)的值</span><br>　　     s1=s; <span class="hljs-comment">//保存f(n-1)的值</span><br>　　&#125;<br>　　<span class="hljs-keyword">return</span> s;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="基于栈结构的间接转换"><a href="#基于栈结构的间接转换" class="headerlink" title="基于栈结构的间接转换"></a>基于栈结构的间接转换</h2><p>通用的变换规则如下：假设template P(p1, p2, …,pm)是一个递归过程或函数（省略参数类型说明），其中p1, … , pm为参数，并设过程中有n个局部变量q1, …, qn和t个递归调用本过程P的语句。</p><p>(1) 在P中增设工作栈S，以存放当前层工作记录。每个工作记录包含m+n+2个数据项，其说明如下。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">levelstr</span><br>&#123;</span>   <span class="hljs-keyword">int</span> p0; <span class="hljs-comment">// 返回语句标号</span><br>    ParaType p；    <span class="hljs-comment">// p用来保存返回值, 类型与递归过程返回值类型ParaType一致</span><br>    <span class="hljs-comment">// 若递归过程为void, 则此项无意义</span><br>    ParaType p1, ..., pm;   <span class="hljs-comment">// 按原类型定义</span><br>    ParaType q1, ..., qn;   <span class="hljs-comment">// 按原类型定义</span><br>&#125; s；<br></code></pre></td></tr></table></figure><p>(2) 在P中设置t+2个语句标号：&lt;标号0＞, &lt;标号1＞, …, &lt;标号t+1＞。其中，&lt;标号0＞设在过程体中第一个可执行的语句上，&lt;标号t+1＞设在过程体结束处之前，其余t个标号分别设置在t个调用过程语句的返回处。</p><p>(3) 在过程体的第一个执行语句（即&lt;标号0＞的语句为过程P的递归入口）之前，增加下列两个语句作为过程P的非递归入口（从调用过程P的主过程进入过程P的入口）：</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Stack&lt;levelstr&gt; s; <span class="hljs-comment">// 栈初始化</span><br>s.push(&lt;标号t+<span class="hljs-number">1</span>&gt;, p, p1, ..., pm, q1, ..., qn); <span class="hljs-comment">// 当前参量进栈</span><br></code></pre></td></tr></table></figure><p>(4) 假设过程体中第I(i＝1, …, t)个递归调用语句为P(a1, a2, …, am)，其中，ai(i＝1, …, m)为实参。则用下列3个语句替换它。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">S.push(&lt;标号i&gt;, a1, ..., am);   <span class="hljs-comment">// 调用实参进栈</span><br><span class="hljs-keyword">goto</span> &lt;标号<span class="hljs-number">0</span>&gt;;   <span class="hljs-comment">// 转向递归入口处</span><br>&lt;标号i&gt;：s.pop( );  <span class="hljs-comment">// 退栈操作</span><br></code></pre></td></tr></table></figure><p>由于goto语句不能转向一个语句的内部，因此，如果某个递归调用语句包含在另一个语句的内部，则应加以适当处理使所有的语句标号只出现在第一层。</p><p>如下列语句组:</p><pre><code>while(条件w)LINESw;LINES;（其中LINESw为第k个递归调用语句）</code></pre><p>可改为：</p><pre><code>&lt;标号w1&gt;：if(条件w){ s.push(...)； goto &lt;标号0&gt;;}        else goto &lt;标号w2&gt;&lt;标号k&gt;： s.pop(); goto &lt;标号w1&gt;;&lt;标号w2&gt;： LINES; ...</code></pre><p>(5) 在过程体中所有递归出口处增加语句。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">s.peek().p = ...； <span class="hljs-comment">// 若递归过程有返回值，执行此赋值语句</span><br><span class="hljs-keyword">goto</span> s.peek().p0； <span class="hljs-comment">// 转向栈顶的返回语句标号处</span><br></code></pre></td></tr></table></figure><p>此goto语句的正规写法为：</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">switch</span>(s.peek( ). p0)<br>&#123;<br>    <span class="hljs-keyword">case</span> &lt;标号<span class="hljs-number">0</span>&gt;:<span class="hljs-keyword">goto</span> &lt;标号<span class="hljs-number">0</span>&gt;; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> &lt;标号<span class="hljs-number">1</span>&gt;:<span class="hljs-keyword">goto</span> &lt;标号<span class="hljs-number">1</span>&gt;; <span class="hljs-keyword">break</span>;<br>                 ...<br>    <span class="hljs-keyword">case</span> &lt;标号t+<span class="hljs-number">1</span>&gt;:<span class="hljs-keyword">goto</span> &lt;标号t+<span class="hljs-number">1</span>&gt;; <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>(6) 标号为t+1的语句是增添的实现函数值出栈操作的语句，作为过程P的非递归出口（即返回调用该递归过程的主过程）。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">&lt;标号t+<span class="hljs-number">1</span>&gt;: temp = s.peek().p； <span class="hljs-comment">// temp为临时变量, 保存返回值</span><br>                   <span class="hljs-comment">// 如递归无返回值, 此语句和下面的return语句可以省略</span><br>s.pop();<br>retutn temp；<br></code></pre></td></tr></table></figure><p>(7) 切记实现参量“当前层化”，过程体中出现的所有参变量和局部变量均以栈顶工作记录中相应的数据项代替。</p><p>(8) 若算法中有复合递归调用的语句，则应增设局部变量消除复合调用，即，将形如f(…, f(…), …);的语句改写为&lt;局部变量＞：f(…);…f(…, &lt;局部变量＞,…);的形式。</p><p>(9) 经过上述变换规则得到的不含递归的算法尚需进行最后一步变换，即简化不必要的操作，如消去冗余进栈的内容等，并画出相应的流程图，从流程图中找出各循环的循环体和循环条件，从而消去goto语句，得到结构清晰的非递归算法。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//汉诺塔递归</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Hanoi</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n，<span class="hljs-keyword">char</span> x，y，z)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>) move(x,<span class="hljs-number">1</span>,z); <span class="hljs-comment">// 将编号为1的盘子从x移到z</span><br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        Hanoi(n<span class="hljs-number">-1</span>,x,z,y);<br>        Move(x,n,z);<br>        Hanoi(n<span class="hljs-number">-1</span>,y,x,z);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//机械转换</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Hanoi</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">char</span> x, y, z)</span><br></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">levelstr</span><br>    &#123;</span><br>        <span class="hljs-keyword">int</span> adr, ptrn; <span class="hljs-keyword">char</span> xp, yp, zp；<br>    &#125; *s, currentp;<br>    s= <span class="hljs-keyword">new</span> Stack(m*m<span class="hljs-number">-1</span>);    <span class="hljs-comment">// m*m-1是栈的初始化大小</span><br>    s.push(<span class="hljs-number">3</span>, n, x, y, z);<br>    <span class="hljs-number">0</span>:currentp = s.peek();  <span class="hljs-comment">// 局部变量currentp用来保存栈顶元素</span><br>        <span class="hljs-keyword">if</span>(currentp.prtn == <span class="hljs-number">1</span>)&#123;<br>          move(currentp.xp, <span class="hljs-number">1</span>, currentp.Zp);<br>          <span class="hljs-keyword">goto</span> currentp.adr;<br>        &#125;<br>        s.push(<span class="hljs-number">1</span>, currentp.ptrn<span class="hljs-number">-1</span>, currentp.xp,<br>              currentp.zp, cutrretnp.Yp);<br>        <span class="hljs-keyword">goto</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-number">1</span>:s.pop();<br>        currentp = s.peek();<br>        move(currentp.Xp,currentp.Ptrn, currentp.zp);<br>        s.push(<span class="hljs-number">2</span>, currentp.ptrn –<span class="hljs-number">1</span>, currentp.yp,<br>              currentp.xp, currentp. zp);<br>        <span class="hljs-keyword">goto</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-number">2</span>:s.pop();<br>        currentp = s.peek();<br>        <span class="hljs-keyword">goto</span> currentp.adr;<br>    <span class="hljs-number">3</span>:s.pop();<br>&#125;<br><br><span class="hljs-comment">//优化，去goto</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hanoi2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">char</span> x, y, z)</span><br></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">levelstr</span><br>    &#123;</span><br>        <span class="hljs-keyword">int</span> ptrn; <span class="hljs-keyword">char</span> xp, yp, zp;<br>    &#125; s[arrmax];<br>    <span class="hljs-keyword">int</span> top; <span class="hljs-keyword">char</span> temp; top = <span class="hljs-number">0</span>;<br>    s[top] = (n, x, y, z); <span class="hljs-comment">// 栈初始化</span><br>    <span class="hljs-keyword">while</span>(!((top==<span class="hljs-number">0</span>)&amp;&amp;(s[top].ptrn==<span class="hljs-number">1</span>)))<br>    &#123;<br>        <span class="hljs-keyword">while</span>(s[top].ptrn &gt; <span class="hljs-number">1</span>)<br>            s[top++] =(s[top].ptrn<span class="hljs-number">-1</span>, s[top].xp,<br>                        s[top].zp, s[top].yp);<br>        move(s[top].xp, <span class="hljs-number">1</span>, s[top].zp);<br>        <span class="hljs-keyword">if</span> (top &gt; <span class="hljs-number">0</span>) &#123;<br>            top--;<br>            move(s[top].xp, s[top].ptrn, s[top].zp);<br>            s[top].ptrn--;<br>            temp = s[top].xp;<br>            s[top].xp = s[top].Yp;<br>            s[top].yp = temp;<br>        &#125;<br>    &#125;<br>    move(s[top].xp, <span class="hljs-number">1</span>, s[top].zp);<br>    top--;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>vim 插件配置攻略</title>
      <link href="/2013/10/26/vim-%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE%E6%94%BB%E7%95%A5/"/>
      <url>/2013/10/26/vim-%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE%E6%94%BB%E7%95%A5/</url>
      <content type="html"><![CDATA[<p>网友 k-vim 的配置 <a href="https://github.com/wklken" target="_blank" rel="noopener">https://github.com/wklken</a></p><blockquote><p>给人一条Vim 命令，他能折腾一晚上；告诉他怎么自定义Vim 命令，他能捣腾一辈子</p><p>生命不息,折腾不止 (╯‵□′)╯︵┻━┻)</p><p>编辑器之神 = 生产力(效率为王) + 性感(界面快捷键) + 装x神器</p></blockquote><h3 id="vim基本用法"><a href="#vim基本用法" class="headerlink" title="vim基本用法"></a>vim基本用法</h3><p>初学者: <a href="http://blog.csdn.net/wklken/article/details/7533272" target="_blank" rel="noopener">vim训练稿</a><br>几年前的三月份,第一次正儿八经开始使用vim,后来整理了一份,对着敲几遍,训练稿</p><p>推荐: 耗子叔的 <a href="http://coolshell.cn/articles/5426.html" target="_blank" rel="noopener">简明vim练级攻略</a></p><p>或者,玩游戏 <a href="http://vim-adventures.com/" target="_blank" rel="noopener">vim大冒险</a></p><pre><code>二八定律,关注可以最大提升自身生产力的那20%插件,具体要亲自实践有什么问题,先看插件文档说明-&gt;代码选项-&gt;github上的issues-&gt;google it你遇到的问题,一定别人也遇到了,大部分可解决,少部分无解….</code></pre><p>   文章: <a href="http://www.kunli.info/2013/08/13/vim/" target="_blank" rel="noopener">不要复杂化vim</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>中缀表达式求值</title>
      <link href="/2013/10/23/%E4%B8%AD%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/"/>
      <url>/2013/10/23/%E4%B8%AD%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/</url>
      <content type="html"><![CDATA[<p>给定一个中缀表达式，求出该表达式的值。</p><p>要求支持“加减乘除 + - * /、取余 %、幂运算 ^、一元正负号 + -、括号 ()、数的科学表示法符号 E e”，其中含有一元操作符’+ -‘，也含有从右向左结合性的操作符’^’，注意操作数的位数可以为多位。<br><a id="more"></a></p><h2 id="直接计算中缀表达式"><a href="#直接计算中缀表达式" class="headerlink" title="直接计算中缀表达式"></a>直接计算中缀表达式</h2><p>延迟缓冲：自左向右扫描表达式，用栈记录已扫描的部分（含已执行运算的结果）。在每一字符处，while（栈的顶部存在可优先计算的子表达式），该子表达式退栈；计算其数值计算结果进栈。当前字符进栈，转入下一字符。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">evaluate</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* S, <span class="hljs-keyword">char</span>*&amp; RPN)</span> </span>&#123; <span class="hljs-comment">//对（已剔除白空格的）表达式S求值，并转换为逆波兰式RPN</span><br>   Stack&lt;<span class="hljs-keyword">float</span>&gt; opnd; Stack&lt;<span class="hljs-keyword">char</span>&gt; optr; <span class="hljs-comment">//运算数栈、运算符栈</span><br>   optr.push(<span class="hljs-string">'\0'</span>); <span class="hljs-comment">//尾哨兵'\0'也作为头哨兵首先入栈</span><br>   <span class="hljs-keyword">while</span> (!optr.empty()) &#123; <span class="hljs-comment">//在运算符栈非空之前，逐个处理表达式中各字符</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isdigit</span>(*S)) &#123; <span class="hljs-comment">//若当前字符为操作数，则</span><br>         readNumber(S, opnd); append(RPN, opnd.top()); <span class="hljs-comment">//读入操作数，并将其接至RPN末尾</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-comment">//若当前字符为运算符，则</span><br>         <span class="hljs-keyword">switch</span>(orderBetween(optr.top(), *S)) &#123; <span class="hljs-comment">//视其与栈顶运算符之间优先级高低分别处理</span><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;'</span>: <span class="hljs-comment">//栈顶运算符优先级更低时</span><br>               optr.push(*S); S++; <span class="hljs-comment">//计算推迟，当前运算符进栈</span><br>               <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">'='</span>: <span class="hljs-comment">//优先级相等（当前运算符为右括号或者尾部哨兵'\0'）时</span><br>               optr.pop(); S++; <span class="hljs-comment">//脱括号并接收下一个字符</span><br>               <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;'</span>: &#123; <span class="hljs-comment">//栈顶运算符优先级更高时，可实施相应的计算，并将结果重新入栈</span><br>               <span class="hljs-keyword">char</span> op = optr.pop(); append(RPN, op); <span class="hljs-comment">//栈顶运算符出栈并续接至RPN末尾</span><br>               <span class="hljs-keyword">if</span> (<span class="hljs-string">'!'</span> == op) &#123; <span class="hljs-comment">//若属于一元运算符</span><br>                  <span class="hljs-keyword">float</span> pOpnd = opnd.pop(); <span class="hljs-comment">//只需取出一个操作数，并</span><br>                  opnd.push(calcu(op, pOpnd)); <span class="hljs-comment">//实施一元计算，结果入栈</span><br>               &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//对于其它（二元）运算符</span><br>                  <span class="hljs-keyword">float</span> pOpnd2 = opnd.pop(), pOpnd1 = opnd.pop(); <span class="hljs-comment">//取出后、前操作数</span><br>                  opnd.push(calcu(pOpnd1, op, pOpnd2)); <span class="hljs-comment">//实施二元计算，结果入栈</span><br>              &#125;<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">default</span> : <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>         &#125;<span class="hljs-comment">//switch</span><br>   &#125;<span class="hljs-comment">//while</span><br>   <span class="hljs-keyword">return</span> opnd.pop(); <span class="hljs-comment">//弹出并返回最后的计算结果</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N_OPTR 9 <span class="hljs-comment">//运算符总数</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> &#123;ADD, SUB, MUL, DIV, POW, FAC, L_P, R_P, EOE&#125; Operator; <span class="hljs-comment">//运算符集合</span><br><span class="hljs-comment">//加、减、乘、除、乘方、阶乘、左括号、右括号、起始符与终止符</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> pri[N_OPTR][N_OPTR] = &#123; <span class="hljs-comment">//运算符优先等级 [栈顶] [当前]</span><br><span class="hljs-comment">/*            |-------------- 当前运算符 --------------|*/</span><br><span class="hljs-comment">/*            +    -    *    /    ^    !    (    )    \0*/</span><br><span class="hljs-comment">/* --  + */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* |   - */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* 栈  * */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* 顶  / */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* 运  ^ */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* 算  ! */</span>  <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&gt;'</span>,<br><span class="hljs-comment">/* 符  ( */</span>  <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">' '</span>,<br><span class="hljs-comment">/* |   ) */</span>  <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">' '</span>,<br><span class="hljs-comment">/* -- \0 */</span>  <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">' '</span>, <span class="hljs-string">'='</span><br>&#125;;<br><br><span class="hljs-function">Operator <span class="hljs-title">optr2rank</span><span class="hljs-params">(<span class="hljs-keyword">char</span> op)</span> </span>&#123; <span class="hljs-comment">//由运算符转译出编号</span><br><span class="hljs-keyword">switch</span> (op) &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span> : <span class="hljs-keyword">return</span> ADD; <span class="hljs-comment">//加</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span> : <span class="hljs-keyword">return</span> SUB; <span class="hljs-comment">//减</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'*'</span> : <span class="hljs-keyword">return</span> MUL; <span class="hljs-comment">//乘</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span> : <span class="hljs-keyword">return</span> DIV; <span class="hljs-comment">//除</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'^'</span> : <span class="hljs-keyword">return</span> POW; <span class="hljs-comment">//乘方</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'!'</span> : <span class="hljs-keyword">return</span> FAC; <span class="hljs-comment">//阶乘</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'('</span> : <span class="hljs-keyword">return</span> L_P; <span class="hljs-comment">//左括号</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">')'</span> : <span class="hljs-keyword">return</span> R_P; <span class="hljs-comment">//右括号</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'\0'</span>: <span class="hljs-keyword">return</span> EOE; <span class="hljs-comment">//起始符与终止符</span><br>      <span class="hljs-keyword">default</span>  : <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); <span class="hljs-comment">//未知运算符</span><br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">orderBetween</span><span class="hljs-params">(<span class="hljs-keyword">char</span> op1, <span class="hljs-keyword">char</span> op2)</span> <span class="hljs-comment">//比较两个运算符之间的优先级</span><br></span>&#123; <span class="hljs-keyword">return</span> pri[optr2rank(op1)][optr2rank(op2)]; &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">readNumber</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*&amp; p, Stack&lt;<span class="hljs-keyword">float</span>&gt;&amp; stk)</span> </span>&#123; <span class="hljs-comment">//将起始于p的子串解析为数值，并存入操作数栈</span><br>   stk.push((<span class="hljs-keyword">float</span>)(*p - <span class="hljs-string">'0'</span>)); <span class="hljs-comment">//当前数位对应的数值进栈</span><br>   <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(*(++p))) <span class="hljs-comment">//只要后续还有紧邻的数字（即多位整数的情况），则</span><br>      stk.push(stk.pop() * <span class="hljs-number">10</span> + (*p - <span class="hljs-string">'0'</span>)); <span class="hljs-comment">//弹出原操作数并追加新数位后，新数值重新入栈</span><br>   <span class="hljs-keyword">if</span> (<span class="hljs-string">'.'</span> != *p) <span class="hljs-keyword">return</span>; <span class="hljs-comment">//此后非小数点，则意味着当前操作数解析完成</span><br>   <span class="hljs-keyword">float</span> fraction = <span class="hljs-number">1</span>; <span class="hljs-comment">//否则，意味着还有小数部分</span><br>   <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(*(++p))) <span class="hljs-comment">//逐位加入</span><br>      stk.push(stk.pop() + (*p - <span class="hljs-string">'0'</span>)*(fraction /= <span class="hljs-number">10</span>)); <span class="hljs-comment">//小数部分</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">calcu</span><span class="hljs-params">(<span class="hljs-keyword">float</span> a, <span class="hljs-keyword">char</span> op, <span class="hljs-keyword">float</span> b)</span> </span>&#123; <span class="hljs-comment">//执行二元运算</span><br><span class="hljs-keyword">switch</span> (op) &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span> : <span class="hljs-keyword">return</span> a + b;<br><span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span> : <span class="hljs-keyword">return</span> a - b;<br><span class="hljs-keyword">case</span> <span class="hljs-string">'*'</span> : <span class="hljs-keyword">return</span> a * b;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span> : <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span>==b) <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); <span class="hljs-keyword">return</span> a/b; <span class="hljs-comment">//注意：如此判浮点数为零可能不安全</span><br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'^'</span> : <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(a, b);<br>      <span class="hljs-keyword">default</span>  : <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">calcu</span><span class="hljs-params">(<span class="hljs-keyword">char</span> op, <span class="hljs-keyword">float</span> b)</span> </span>&#123; <span class="hljs-comment">//执行一元运算</span><br><span class="hljs-keyword">switch</span> (op) &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">'!'</span> : <span class="hljs-keyword">return</span> (<span class="hljs-keyword">float</span>)facI((<span class="hljs-keyword">int</span>)b); <span class="hljs-comment">//目前仅有阶乘，可照此方式添加</span><br>      <span class="hljs-keyword">default</span>  : <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">append</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*&amp; rpn, <span class="hljs-keyword">float</span> opnd)</span> </span>&#123; <span class="hljs-comment">//将操作数接至RPN末尾</span><br>   <span class="hljs-keyword">int</span> n = <span class="hljs-built_in">strlen</span>(rpn); <span class="hljs-comment">//RPN当前长度（以'\0'结尾，长度n + 1）</span><br>   <span class="hljs-keyword">char</span> buf[<span class="hljs-number">64</span>];<br>   <span class="hljs-keyword">if</span> (opnd != (<span class="hljs-keyword">float</span>)(<span class="hljs-keyword">int</span>)opnd) <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">"%.2f \0"</span>, opnd); <span class="hljs-comment">//浮点格式，或</span><br>   <span class="hljs-keyword">else</span>                          <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">"%d \0"</span>, (<span class="hljs-keyword">int</span>)opnd); <span class="hljs-comment">//整数格式</span><br>   rpn = (<span class="hljs-keyword">char</span>*) <span class="hljs-built_in">realloc</span>(rpn, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>) * (n + <span class="hljs-built_in">strlen</span>(buf) + <span class="hljs-number">1</span>)); <span class="hljs-comment">//扩展空间</span><br>   <span class="hljs-built_in">strcat</span>(rpn, buf); <span class="hljs-comment">//RPN加长</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">append</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*&amp; rpn, <span class="hljs-keyword">char</span> optr)</span> </span>&#123; <span class="hljs-comment">//将运算符接至RPN末尾</span><br>   <span class="hljs-keyword">int</span> n = <span class="hljs-built_in">strlen</span>(rpn); <span class="hljs-comment">//RPN当前长度（以'\0'结尾，长度n + 1）</span><br>   rpn = (<span class="hljs-keyword">char</span>*) <span class="hljs-built_in">realloc</span>(rpn, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>) * (n + <span class="hljs-number">3</span>)); <span class="hljs-comment">//扩展空间</span><br>   <span class="hljs-built_in">sprintf</span>(rpn + n, <span class="hljs-string">"%c "</span>, optr); rpn[n + <span class="hljs-number">2</span>] = <span class="hljs-string">'\0'</span>; <span class="hljs-comment">//接入指定的运算符</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="中缀转后缀"><a href="#中缀转后缀" class="headerlink" title="中缀转后缀"></a>中缀转后缀</h2><p>首先介绍一个人工转换的方法，假设有一个中缀表达式a+b*c-(d+e)</p><ol><li><p>首先将这个中缀表达式的所有运算加括号((a+(b*c))-(d+e))</p></li><li><p>然后将所有运算符放到括号后面，这样就变成了((a(bc)* )+ (de)+ )-</p></li><li><p>把所有括号去掉abc*+de+-，最后得出的结果就是后缀表达式</p></li></ol><p>上面这个方法可以在比如做题分析的时候用人脑的时候使用，接下来介绍用程序实现将中缀转换成后缀表达式的思路</p><p>预处理中缀表达式</p><ol><li><p>判断是否有不能处理的字符；</p></li><li><p>去除所有的空格；</p></li><li><p>处理一元操作符’+’和’-‘：</p><p> 3.1 如果是在开始位置，在开始处添加”0”；</p><p> 3.2 如果是在“非数字字符”（右括号‘)’除外）之后，那么先在一元操作符前插入”(0”，然后在一个“完整的数字”或者“括号后面”添加右括号”)”；</p></li></ol><p>中缀转后缀</p><ol><li>如果是操作数，读取其所有的位，然后进入后缀表达式队列；</li><li>如果是操作符( + – * / ^ % )<br>2.1 如果“操作符栈”为空，直接入栈；<br>2.2 如果当前操作符优先级&gt;栈顶元素优先级，那么入栈；<br>2.3 如果当前操作符优先级&lt;栈顶元素优先级，那么栈顶操作符出栈，循环执行；<br>2.4 如果当前操作符优先级=栈顶元素优先级，如果当前元素是右结合性，那么入栈；否则，栈顶元素出栈；循环执行。</li><li>如果是左括号’(‘，直接入栈</li><li>如果是右括号’)’，如果栈非空，那么栈顶元素出栈，直到遇到左括号’(‘；</li><li>遍历结束中，将操作符栈中的元素依次出栈，添加到后缀表达式队列中。</li></ol><p>参考:  <a href="http://blog.csdn.net/daheiantian/article/details/6553713" target="_blank" rel="noopener">http://blog.csdn.net/daheiantian/article/details/6553713</a></p>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>快速排序 QuickSort</title>
      <link href="/2013/10/21/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F-quicksort/"/>
      <url>/2013/10/21/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F-quicksort/</url>
      <content type="html"><![CDATA[<p>7-4 快速排序中的堆栈深度</p><p>7.1节中QUICKSORT算法包含有两个对其自身的递归调用。在调用PARTITION后，左边的子数组和右边的子数组分别被递归调用。QUICKSORT中的第二次递归调用并不是必须的；可以用迭代控制来代替它。这种技术称作尾递归，大多数的编译程序都加以了采用。考虑下面这个快速排序的版本，它模拟了尾递归：</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined">QUICKSORT&apos;(A, p, r)<br>1  while p&lt;r<br>2      do q &lt;- PARTITION(A, p, r)<br>3         QUICKSORT(A, p, q-1)<br>4         p &lt;- q+1<br></code></pre></td></tr></table></figure><p>a) 论证QUICKSORT’(A, 1, Length[A])能正确地对数组A进行排序。</p><p>首先证明QUICKSORT(A, 1, Length[A])能正确地对数组A进行排序</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined">QUICKSORT(A, p, r)<br>1  if p&lt;r<br>2      then q &lt;- PARTITION(A, p, r)<br>3           QUICKSORT(A, p, q-1)<br>4           QUICKSORT(A, q+1, r)<br></code></pre></td></tr></table></figure><p>循环不变式：QUICKSORT(A, p, r)调用后，A[p..r]中的元素是有序的。</p><p>初始化：r-p=1时，调用QUICK(A, p, r)。因为p&lt;r，故进入if语句块，调用q&lt;-PARTITION(A, p, r)后，A[p..q-1]的元素一定小于A[q]，A[q+1..r]的元素一定大于A[q]，又因为A[p..r]此时只包含两个元素，所以在调用q&lt;-PARTITION(A, p, r)后A[p..r]有序。因为此时q只能等于p或r，所以下面的QUICKSORT(A, p, q-1)、QUICKSORT(A, q+1, r)将不做任何操作。显然，循环不变式是成立的。</p><p>保持：对任意数组A下标范围内的p、r调用QUICKSORT(A, p, r)时，假设循环不变式成立，于是QUICKSORT(A, p, q-1)使A[p..q-1]有序，QUICKSORT(A, q+1, r)使A[q+1..r]有序。并且由于调用了q&lt;-PARTITION(A, p, r)，A[p..q-1]的元素都小于A[q]，A[q+1..r]的元素都大于A[q]，于是数组A[p..r]就有序了。</p><p>终止：最外层QUICKSORT(A, 1, Length[A])调用结束时，根据循环不变式，A[1..n]有序。</p><p>QUICKSORT’调用与QUICKSORT相同的PARTITION，然后都以(A, p, q-1)调用自身。QUICKSORT以(A, q+1, r)再次调用自身，而QUICKSORT’则是让p&lt;-q+1后执行了while循环的另一次迭代。实际上不难看出，这一操作与QUICKSORT的第二次自身调用效果相同。于是QUICKSORT’(A, 1, Length[A])能正确对数组A进行排序。</p><p>c) 修改QUICKSORT’的代码，使其最坏情况栈深度为Θ(lgn)。保持算法的O(nlgn)期望运行时间不变。</p><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined">QUICKSORT&apos;&apos;(A, p, r)<br>1 while p&lt;r<br>2     do q &lt;- PARTITION(A, p, r)<br>3        if q-p&lt;r-q<br>4            then QUICKSORT&apos;&apos;(A, p, q-1)<br>5                 p &lt;- q+1<br>6            else QUICKSORT&apos;&apos;(A, q+1, r)<br>7                 r &lt;- q-1<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 1664 放苹果</title>
      <link href="/2013/10/20/poj-1664-%E6%94%BE%E8%8B%B9%E6%9E%9C/"/>
      <url>/2013/10/20/poj-1664-%E6%94%BE%E8%8B%B9%E6%9E%9C/</url>
      <content type="html"><![CDATA[<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>把M个同样的苹果放在N个同样的盘子里，允许有的盘子空着不放，问共有多少种不同的分法？（用K表示）5，1，1和1，5，1 是同一种分法。</p><p>自己想了半天，什么排列组合之类的，后来去搜题解，才知道是用递归……<br><a id="more"></a></p><p>动态规划：其实这根将一个整数m分成n个整数之和是类似的。</p><p>另外一种表述是，给定了任意数量的现金，我们能写出一个程序，计算出所有换零钱方式的和数吗？（见《计算机程序的构造和解释》 p26）</p><p>设f[m][n]为将m分成最多n份的方案数，且其中的方案不重复，即每个方案前一个份的值一定不会比后面的大。则有：</p><pre><code>f(m,n) = f(m,n - 1) + f(m - n,n)       = 1 // m== 0 || n == 1       = 0 // m &lt; 0</code></pre><p>f(m,n - 1)相当于第一盘子中为0，只用将数分成n - 1份即可。因为0不会大于任何数，相当于f(m,n - 1)中的方案前面加一个为0的盘子，而且不违背f的定义。所以f(m,n - 1)一定是f(m,n)的方案的一部分，即含有0的方案数。</p><p>f(m - n,n)相当于在每个盘子中加一个数1。因为每个盘子中加一个数1不会影响f(m,n - 1)中的方案的可行性，也不会影响f的定义。所以f(m - n,n)一定是f(m,n)的方案的一部分，即不含有0的方案数。(先把每个都放一个苹果，这样问题就转化为：m-n个苹果放进n个盘子里，盘子允许空)</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dynamic</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span><br></span>&#123;<br><span class="hljs-keyword">if</span> (m &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (m == <span class="hljs-number">0</span> || n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">return</span> dynamic(m, n - <span class="hljs-number">1</span>) + dynamic(m - n, n);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span><br></span>&#123;<br><span class="hljs-keyword">int</span> m, n, num;<br><span class="hljs-built_in">cin</span> &gt;&gt; num;<br><span class="hljs-keyword">while</span> (num--) &#123;<br><span class="hljs-built_in">cin</span> &gt;&gt; m &gt;&gt; n;<br><span class="hljs-built_in">cout</span> &lt;&lt; dynamic(m, n) &lt;&lt; <span class="hljs-built_in">endl</span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mac OSX 下 java 环境</title>
      <link href="/2013/09/28/mac-osx-%E4%B8%8B-java-%E7%8E%AF%E5%A2%83/"/>
      <url>/2013/09/28/mac-osx-%E4%B8%8B-java-%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<h2 id="解决javac和java命令在Mac-OSX终端里的乱码问题"><a href="#解决javac和java命令在Mac-OSX终端里的乱码问题" class="headerlink" title="解决javac和java命令在Mac OSX终端里的乱码问题"></a>解决javac和java命令在Mac OSX终端里的乱码问题</h2><p>解决方法有3个：</p><p>1）指定输出的编码为UTF-8</p><pre><code>javac -J-Dfile.encoding=UTF-8</code></pre><p>.profile添加</p><pre><code>export _JAVA_OPTIONS=&quot;-Dfile.encoding=UTF-8&quot;</code></pre><p>2）输出英文</p><pre><code>export LC_ALL=en</code></pre><p>3）通过iconv转码</p><pre><code>javac something|iconv -f GBK -t UTF-8</code></pre><h2 id="Sublime-Text-编译运行-Java"><a href="#Sublime-Text-编译运行-Java" class="headerlink" title="Sublime Text 编译运行 Java"></a>Sublime Text 编译运行 Java</h2><pre><code>{  &quot;cmd&quot;: [&quot;javac \&quot;$file_name\&quot; &amp;&amp; java \&quot;$file_base_name\&quot;&quot;],  &quot;shell&quot;: true,  &quot;file_regex&quot;: &quot;^(...*?):([0-9]*):?([0-9]*)&quot;,  &quot;selector&quot;: &quot;source.java&quot;}</code></pre>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 1007 DNA逆序对</title>
      <link href="/2013/09/27/poj-1007-dna%E9%80%86%E5%BA%8F%E5%AF%B9/"/>
      <url>/2013/09/27/poj-1007-dna%E9%80%86%E5%BA%8F%E5%AF%B9/</url>
      <content type="html"><![CDATA[<p>题意就是让你求逆序对，然后按照逆序对的大小将字符串输出，如果逆序对数目一样，则不要改变原来的顺序输出。</p><p>至于逆序对数…对于”ZWQM”，因为Z&gt;W&gt;Q&gt;M，则一共有6个逆序对:ZW、ZQ、ZM、WQ、WM、QM…就这样暴力算出每个字符串的逆序对数目，然后排序就行了。下面程序中用的是最简单的冒泡排序。</p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> n, m;<br>    <span class="hljs-keyword">int</span> max = <span class="hljs-number">0</span>, min;<br>    <span class="hljs-keyword">int</span> i, j, k;<br>    <span class="hljs-keyword">char</span> item[<span class="hljs-number">101</span>][<span class="hljs-number">51</span>];<br>    <span class="hljs-keyword">int</span> len[<span class="hljs-number">101</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-keyword">int</span> flag[<span class="hljs-number">101</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br><br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; m; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, item[i]);<br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; n; j++)<br>            <span class="hljs-keyword">for</span> (k = j + <span class="hljs-number">1</span>; k &lt; n; k++)<br>                <span class="hljs-keyword">if</span> (item[i][j] &gt; item[i][k]) len[i]++;<br>        <span class="hljs-keyword">if</span> (len[i] &gt; max) max = len[i];<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; m; i++)<br>    &#123;<br>        min = max + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; m; j++)<br>            <span class="hljs-keyword">if</span> (len[j] &lt; min &amp;&amp; (flag[j] == <span class="hljs-number">0</span>))<br>            &#123;<br>                min = len[j];<br>                k = j;<br>            &#125;<br>        flag[k] = <span class="hljs-number">1</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, item[k]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 1006 Biorhythms</title>
      <link href="/2013/09/26/poj-1006-biorhythms/"/>
      <url>/2013/09/26/poj-1006-biorhythms/</url>
      <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>人自出生起就有体力，情感和智力三个生理周期，分别为23，28和33天。一个周期内有一天为峰值，在这一天，人在对应的方面（体力，情感或智力）表现最好。通常这三个周期的峰值不会是同一天。现在给出三个日期，分别对应于体力，情感，智力出现峰值的日期。然后再给出一个起始日期，要求从这一天开始，算出最少再过多少天后三个峰值同时出现。</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>首先我们要知道，任意两个峰值之间一定相距整数倍的周期。假设一年的第N天达到峰值，则下次达到峰值的时间为N+Tk(T是周期，k是任意正整数)。所以，三个峰值同时出现的那一天(S)应满足</p><pre><code>S = N1 + T1*k1 = N2 + T2*k2 = N3 + T3*k3</code></pre><p>N1,N2,N3分别为为体力，情感，智力出现峰值的日期， T1，T2,T3分别为体力，情感，智力周期。 我们需要求出k1,k2,k3三个非负整数使上面的等式成立。</p><p>想直接求出k1,k2,k3貌似很难，但是我们的目的是求出S， 可以考虑从结果逆推。根据上面的等式，S满足三个要求：除以T1余数为N1，除以T2余数为N2，除以T3余数为N3。这样我们就把问题转化为求一个最小数，该数除以T1余N1，除以T2余N2,除以T3余N3。这就是著名的中国剩余定理，我们的老祖宗在几千年前已经对这个问题想出了一个精妙的解法。依据此解法的算法，时间复杂度可达到O(1)。下面就介绍一下中国剩余定理。</p><h2 id="中国剩余定理介绍"><a href="#中国剩余定理介绍" class="headerlink" title="中国剩余定理介绍"></a>中国剩余定理介绍</h2><p>在《孙子算经》中有这样一个问题：“今有物不知其数，三三数之剩二（除以3余2），五五数之剩三（除以5余3），七七数之剩二（除以7余2），问物几何？”这个问题称为“孙子问题”，该问题的一般解法国际上称为“中国剩余定理”。具体解法分三步：</p><p>找出三个数：从3和5的公倍数中找出被7除余1的最小数15，从3和7的公倍数中找出被5除余1 的最小数21，最后从5和7的公倍数中找出除3余1的最小数70。<br>用15乘以2（2为最终结果除以7的余数），用21乘以3（3为最终结果除以5的余数），同理，用70乘以2（2为最终结果除以3的余数），然后把三个乘积相加（15<em>2+21</em>3+70*2）得到和233。<br>用233除以3，5，7三个数的最小公倍数105，得到余数23，即233%105=23。这个余数23就是符合条件的最小数。</p><p>就这么简单。我们在感叹神奇的同时不禁想知道古人是如何想到这个方法的，有什么基本的数学依据吗？</p><h2 id="中国剩余定理分析"><a href="#中国剩余定理分析" class="headerlink" title="中国剩余定理分析"></a>中国剩余定理分析</h2><p>我们将“孙子问题”拆分成几个简单的小问题，从零开始，试图揣测古人是如何推导出这个解法的。</p><p>首先，我们假设n1是满足除以3余2的一个数，比如2，5，8等等，也就是满足3*k+2（k&gt;=0）的一个任意数。同样，我们假设n2是满足除以5余3的一个数，n3是满足除以7余2的一个数。</p><p>有了前面的假设，我们先从n1这个角度出发，已知n1满足除以3余2，能不能使得 n1+n2 的和仍然满足除以3余2？进而使得n1+n2+n3的和仍然满足除以3余2？</p><p>这就牵涉到一个最基本数学定理，如果有a%b=c,则有(a+kb)%b=c(k为非零整数)，换句话说，如果一个除法运算的余数为c，那么被除数与k倍的除数相加（或相减）的和（差）再与除数相除，余数不变。这个是很好证明的。</p><p>以此定理为依据，如果n2是3的倍数，n1+n2就依然满足除以3余2。同理，如果n3也是3的倍数，那么n1+n2+n3的和就满足除以3余2。这是从n1的角度考虑的，再从n2，n3的角度出发，我们可推导出以下三点：</p><ul><li>为使n1+n2+n3的和满足除以3余2，n2和n3必须是3的倍数。</li><li>为使n1+n2+n3的和满足除以5余3，n1和n3必须是5的倍数。</li><li>为使n1+n2+n3的和满足除以7余2，n1和n2必须是7的倍数。</li></ul><p>因此，为使n1+n2+n3的和作为“孙子问题”的一个最终解，需满足：</p><ul><li>n1除以3余2，且是5和7的公倍数。</li><li>n2除以5余3，且是3和7的公倍数。</li><li>n3除以7余2，且是3和5的公倍数。</li></ul><p>所以，孙子问题解法的本质是从5和7的公倍数中找一个除以3余2的数n1，从3和7的公倍数中找一个除以5余3的数n2，从3和5的公倍数中找一个除以7余2的数n3，再将三个数相加得到解。在求n1，n2，n3时又用了一个小技巧，以n1为例，并非从5和7的公倍数中直接找一个除以3余2的数，而是先找一个除以3余1的数，再乘以2。</p><p>这里又有一个数学公式，如果a%b=c，那么（a*k）%b=a%b+a%b+…+a%b=c+c+…+c=kc（k&gt;0）,也就是说，如果一个除法的余数为c，那么被除数的k倍与除数相除的余数为kc。展开式中已证明。</p><p>最后，我们还要清楚一点，n1+n2+n3只是问题的一个解，并不是最小的解。如何得到最小解？我们只需要从中最大限度的减掉掉3，5，7的公倍数105即可。道理就是前面讲过的定理“如果a%b=c,则有(a-kb)%b=c”。所以（n1+n2+n3）%105就是最终的最小解。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过分析发现，中国剩余定理的孙子解法并没有什么高深的技巧，就是以下两个基本数学定理的灵活运用：</p><ul><li>如果 a%b=c , 则有 (a+kb)%b=c (k为非零整数)。</li><li>如果 a%b=c，那么 (a*k)%b=kc (k为大于零的整数)。</li></ul><p>再看我们这道题，读入p,e,i,d 4个整数</p><p>已知(n+d)%23=p;   (n+d)%28=e;   (n+d)%33=i ,求n 。</p><p>解法就是：</p><p>已知(n+d)%23=p;   (n+d)%28=e;   (n+d)%33=i</p><p>使33×28×a被23除余1，用33×28×8=5544；</p><p>使23×33×b被28除余1，用23×33×19=14421；</p><p>使23×28×c被33除余1，用23×28×2=1288。</p><p>因此有（5544×p+14421×e+1288×i）% lcm(23,28,33) =n+d</p><p>又23、28、33互质，即lcm(23,28,33)= 21252;</p><p>所以有n=（5544×p+14421×e+1288×i-d）%21252</p><p>本题所求的是最小整数解，避免n为负，因此最后结果为n= [n+21252]% 21252</p><p>那么最终求解n的表达式就是：<br>n=(5544<em>p+14421</em>e+1288*i-d+21252)%21252</p><p>参考：</p><p><a href="http://www.cnblogs.com/walker01/archive/2010/01/23/1654880.html" target="_blank" rel="noopener">http://www.cnblogs.com/walker01/archive/2010/01/23/1654880.html</a></p>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Generate Ctags Files</title>
      <link href="/2013/09/26/generate-ctags-files/"/>
      <url>/2013/09/26/generate-ctags-files/</url>
      <content type="html"><![CDATA[<figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ctags -R --c++-kinds=+p --fields=+iaS --extra=+q .<br></code></pre></td></tr></table></figure><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ctags -I __THROW -I __attribute_pure__ -I __nonnull -I __attribute__ --file-scope=yes --langmap=c:+.h --languages=c,c++ --links=yes --c-kinds=+p --c++-kinds=+p --fields=+iaS --extra=+q  -f ~/.vim/systags /usr/include/* /usr/include/sys/* /usr/include/bits/*  /usr/include/netinet/* /usr/include/arpa/* /usr/include/mysql/*<br></code></pre></td></tr></table></figure><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh<br></span><br><span class="hljs-comment"># ./ctags_with_dep.sh file1.c file2.c ... to generate a tags file for these files.</span><br><br>gcc -M $* | sed -e <span class="hljs-string">'s/[\\ ]/\n/g'</span> | \<br>        sed -e <span class="hljs-string">'/^$/d'</span> -e <span class="hljs-string">'/\.o:[ \t]*$/d'</span> | \<br>        ctags -L - --c++-kinds=+p --fields=+iaS --extra=+q<br></code></pre></td></tr></table></figure><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -M -I ~/include $* | sed -e <span class="hljs-string">'s/[\\ ]/\n/g'</span> | \<br>sed -e <span class="hljs-string">'/^$/d'</span> -e <span class="hljs-string">'/\.o:[ \t]*$/d'</span> | \<br>ctags -L - --c++-kinds=+p --fields=+iaS --extra=+q<br></code></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>POJ 1002 电话号码</title>
      <link href="/2013/09/26/poj-1002-%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81/"/>
      <url>/2013/09/26/poj-1002-%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>Input</p><p>输入的格式是，第一行是一个正整数，指定电话号码薄中号码的数量（最多100000）。余下的每行是一个电话号码。每个电话号码由数字，大写字母（除了Q和Z）以及连接符组成。每个电话号码中只会刚好有7个数字或者字母。<br>Output</p><p>对于每个出现重复的号码产生一行输出，输出是号码的标准格式紧跟一个空格然后是它的重复次数。如果存在多个重复的号码，则按照号码的字典升序输出。如果输入数据中没有重复的号码，输出一行：</p><p>No duplicates.</p><p><a href="http://poj.org/problem?id=1002" target="_blank" rel="noopener">http://poj.org/problem?id=1002</a></p><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIZE 10000000</span><br><span class="hljs-keyword">int</span> num[SIZE];<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">trans</span><span class="hljs-params">(<span class="hljs-keyword">char</span> x)</span><br></span>&#123;<br>    <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-string">'0'</span> &amp;&amp; x &lt;= <span class="hljs-string">'9'</span>) <span class="hljs-keyword">return</span> x - <span class="hljs-string">'0'</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'A'</span> || x == <span class="hljs-string">'B'</span> || x == <span class="hljs-string">'C'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'D'</span> || x == <span class="hljs-string">'E'</span> || x == <span class="hljs-string">'F'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'G'</span> || x == <span class="hljs-string">'H'</span> || x == <span class="hljs-string">'I'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'J'</span> || x == <span class="hljs-string">'K'</span> || x == <span class="hljs-string">'L'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'M'</span> || x == <span class="hljs-string">'N'</span> || x == <span class="hljs-string">'O'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'P'</span> || x == <span class="hljs-string">'R'</span> || x == <span class="hljs-string">'S'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'T'</span> || x == <span class="hljs-string">'U'</span> || x == <span class="hljs-string">'V'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-string">'W'</span> || x == <span class="hljs-string">'X'</span> || x == <span class="hljs-string">'Y'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">9</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> n;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);<br><br>    <span class="hljs-keyword">int</span> i, j;<br>    <span class="hljs-keyword">char</span> x[<span class="hljs-number">1000</span>];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, x);<br>        <span class="hljs-keyword">int</span> base =<span class="hljs-number">1</span>, sum = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-built_in">strlen</span>(x) - <span class="hljs-number">1</span>; j &gt;= <span class="hljs-number">0</span>; j--)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (x[j] == <span class="hljs-string">'-'</span>) <span class="hljs-keyword">continue</span>;<br>            sum += base * trans(x[j]);<br>            base = base * <span class="hljs-number">10</span>;<br>        &#125;<br>        num[sum]++;<br>    &#125;<br><br>    <span class="hljs-keyword">int</span> p = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; SIZE; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (num[i] &gt; <span class="hljs-number">1</span>)<br>        &#123;<br>            p = <span class="hljs-number">1</span>;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%03d-%04d %d\n"</span>, i / <span class="hljs-number">10000</span>, i % <span class="hljs-number">10000</span>, num[i]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!p) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"No duplicates.\n"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>POJ 1001 求高精度幂</title>
      <link href="/2013/09/25/poj-1001-%E6%B1%82%E9%AB%98%E7%B2%BE%E5%BA%A6%E5%B9%82/"/>
      <url>/2013/09/25/poj-1001-%E6%B1%82%E9%AB%98%E7%B2%BE%E5%BA%A6%E5%B9%82/</url>
      <content type="html"><![CDATA[<p>问题：对一个实数R( 0.0 &lt; R &lt; 99.999 )，要求写程序精确计算 R 的 n 次方(Rn)，其中n 是整数并且 0 &lt; n &lt;= 25。</p><h2 id="计算结果位数的确定"><a href="#计算结果位数的确定" class="headerlink" title="计算结果位数的确定"></a>计算结果位数的确定</h2><ul><li>两数之和的最大为较大的数的位数加1</li><li>乘积的位数最大为两个因子的位数之和</li><li>阶乘：lgn! = lgn + lg(n-1) + … + lg1 = lnn/ln10 + ln(n-1)/ln10 + … + ln1/ln10 = trunc(1/ln10 * (lnn + ln(n-1) + … + ln1))</li><li>乘方：lg(a^b) = trunc(lg(a^b)) + 1 = trunc(b * lga) + 1 = trunc(b * lna/ln10) + 1</li></ul><a id="more"></a><h2 id="高精度加法"><a href="#高精度加法" class="headerlink" title="高精度加法"></a>高精度加法</h2><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">ncarry = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= len; i++)<br>&#123;<br>    k = a[i] + b[i] + ncarry;<br>    a[i+<span class="hljs-number">1</span>] += k/N;<br>    ncarry = k%N;<br>&#125;<br><span class="hljs-comment">//当最后 ncarry &gt; 0 时，len会变化</span><br></code></pre></td></tr></table></figure><h2 id="高精度减法"><a href="#高精度减法" class="headerlink" title="高精度减法"></a>高精度减法</h2><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//先比较大小，大的为a</span><br>ncarry = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= len; i++)<br>&#123;<br>    <span class="hljs-keyword">if</span> (a[i] - b[i] - ncarry) &gt;= <span class="hljs-number">0</span>)<br>        a[i] = a[i] - b[i] - ncarry, ncarry = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span><br>        a[i] = a[i] + N - b[i] - ncarry, ncarry = <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="高精度乘法"><a href="#高精度乘法" class="headerlink" title="高精度乘法"></a>高精度乘法</h2><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= lena; i++)<br>    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt;= lenb; j++)<br>        c[i+j] += a[i] * b[j];<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= lena + lenb; i++)<br>&#123;<br>    c[i+<span class="hljs-number">1</span>] += c[i]/N;<br>    c[i] = c[i]/N;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="hljs highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*<br>POJ-1001<br>提交状态：<br>Accepted    244K 0MS   C++    2039B<br>解题思路：<br>1、首先要保证两个整数的乘法运算是正确的<br>2、接受数据之后，先去掉小数点，并且根据幂指数确定小数点的位数，此时要注意的是如果出现1.0000这样有无效零的情况，先将0去掉。<br>3、多次调用高精度乘法函数得到整数结果<br>4、补上小数点并输出，因为在2中已经去掉了无效零，于是结果中便不会出现小数点右边末尾出现零的情况。<br>5、还有就是如果小数点的总位数大于等于结果的长度，应该先输出"."<br>*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIZE 1000</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">int</span> *point)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reverse</span><span class="hljs-params">(<span class="hljs-keyword">char</span> t[], <span class="hljs-keyword">int</span> n)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">check</span><span class="hljs-params">( <span class="hljs-keyword">int</span> tmp[], <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">char</span> result[])</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mul</span><span class="hljs-params">(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">char</span> t[], <span class="hljs-keyword">char</span> result[])</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">(<span class="hljs-keyword">int</span> point, <span class="hljs-keyword">char</span> result[])</span></span>;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span><br></span>&#123;<br>    <span class="hljs-keyword">char</span> s[SIZE];<br>    <span class="hljs-keyword">int</span> n;<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%d"</span>, s, &amp;n) != EOF) &#123;<br>        <span class="hljs-keyword">int</span> i, point = <span class="hljs-number">0</span>;<br>        process(s, &amp;point);<br>        <span class="hljs-keyword">char</span> result[SIZE * <span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">char</span> tmp[SIZE];<br>        <span class="hljs-built_in">strcpy</span>(result, s);<br>        <span class="hljs-built_in">strcpy</span>(tmp, s);<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) &#123;<br>            <span class="hljs-built_in">strcpy</span>(s, tmp);<br>            mul(s, result, result);<br>        &#125;<br>        show(point * n, result);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">int</span> *point)</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(s);<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (s[i] != <span class="hljs-string">'\0'</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'.'</span>) <span class="hljs-keyword">break</span>;<br>        ++i;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (s[len - <span class="hljs-number">1</span>] == <span class="hljs-string">'0'</span>) --len;<br>    s[len] = <span class="hljs-string">'\0'</span>;<br>    *point = i &lt; len ? (len - i - <span class="hljs-number">1</span>) : <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (i &lt; len) &#123;<br>        s[i] = s[i + <span class="hljs-number">1</span>];<br>        ++i;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reverse</span><span class="hljs-params">(<span class="hljs-keyword">char</span> t[], <span class="hljs-keyword">int</span> n)</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = n - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">char</span> tmp;<br>    <span class="hljs-keyword">while</span> (i &lt; j)<br>    &#123;<br>        tmp = t[i];<br>        t[i] = t[j];<br>        t[j] = tmp;<br>        ++i, --j;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tmp[], <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">char</span> result[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> i, j, k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; ++i)<br>    &#123;<br>        tmp[i + <span class="hljs-number">1</span>] += tmp[i] / <span class="hljs-number">10</span>;<br>        tmp[i] = tmp[i] % <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (tmp[i] == <span class="hljs-number">0</span>) --i;<br>    <span class="hljs-keyword">for</span> (j = i; j &gt;= <span class="hljs-number">0</span>; j--)<br>        result[k++] = tmp[j] + <span class="hljs-string">'0'</span>;<br>    result[k] = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mul</span><span class="hljs-params">(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">char</span> t[], <span class="hljs-keyword">char</span> result[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> ls = <span class="hljs-built_in">strlen</span>(s);<br>    <span class="hljs-keyword">int</span> lt = <span class="hljs-built_in">strlen</span>(t);<br>    reverse(s, ls);<br>    reverse(t, lt);<br>    <span class="hljs-keyword">int</span> tmp[SIZE * <span class="hljs-number">2</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-keyword">int</span> i, j, k;<br>    <span class="hljs-keyword">int</span> a = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ls; i++)<br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; lt; j++)<br>            tmp [i + j] += (<span class="hljs-keyword">int</span>)(s[i] - <span class="hljs-string">'0'</span>)*(<span class="hljs-keyword">int</span>)(t[j] - <span class="hljs-string">'0'</span>);<br>    check(tmp, i + j, result);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">(<span class="hljs-keyword">int</span> point, <span class="hljs-keyword">char</span> result[])</span><br></span>&#123;<br>    <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(result);<br>    <span class="hljs-keyword">if</span> (point &gt;= len)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"."</span>);<br>    <span class="hljs-keyword">while</span> (point &gt; len)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"0"</span>);<br>        point--;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c"</span>, result[i]);<br>        <span class="hljs-keyword">if</span> (i == len - <span class="hljs-number">1</span> - point &amp;&amp; point != <span class="hljs-number">0</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"."</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> poj </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python 中的装饰器(decorator)</title>
      <link href="/2013/09/16/python-%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8(decorator)/"/>
      <url>/2013/09/16/python-%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8(decorator)/</url>
      <content type="html"><![CDATA[<p>decorator可作用于函数和类，功能有两个：</p><ul><li>Call proxy</li><li>Interface proxy<a id="more"></a></li></ul><h2 id="Function-Decorator"><a href="#Function-Decorator" class="headerlink" title="Function Decorator"></a>Function Decorator</h2><p>语法：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@decorator</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">F</span><span class="hljs-params">(arg)</span>:</span><br>    …<br><br>F(<span class="hljs-number">99</span>)<br></code></pre></td></tr></table></figure><p>效果：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">F</span><span class="hljs-params">(arg)</span>:</span><br>    …<br><br>F = decorator(F)<br>F(<span class="hljs-number">99</span>)<br></code></pre></td></tr></table></figure><p>Call proxy示例：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span><span class="hljs-params">(F)</span>:</span><br>    <span class="hljs-comment"># Process function F</span><br>    <span class="hljs-keyword">return</span> F<br><br><span class="hljs-meta">@decorator</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span><span class="hljs-params">()</span>:</span> …<br></code></pre></td></tr></table></figure><p>Interface proxy示例：</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span><span class="hljs-params">(F)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span><span class="hljs-params">(*args)</span>:</span><br>        <span class="hljs-comment"># Use F and args</span><br>        <span class="hljs-comment"># F(*args) calls original function</span><br>    <span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-meta">@decorator</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span><span class="hljs-params">(x, y)</span>:</span><br>    …<br><br>func(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>)    <span class="hljs-comment"># 6, 7 are passed to wrapper's *args</span><br></code></pre></td></tr></table></figure><p>decorator class:</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">decorator</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, func)</span>:</span><br>        self.func = func<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span><span class="hljs-params">(self, *args)</span>:</span><br>        <span class="hljs-comment"># Use self.func and args</span><br>        <span class="hljs-comment"># self.func(*args) calls original function</span><br><br><span class="hljs-meta">@decorator</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span><span class="hljs-params">(x, y)</span>:</span><br>    …<br><br>func(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>)<br></code></pre></td></tr></table></figure><h2 id="Class-Decorator"><a href="#Class-Decorator" class="headerlink" title="Class Decorator"></a>Class Decorator</h2><p>语法与function decorator类似</p><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span><span class="hljs-params">(cls)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wrapper</span>:</span><br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, *args)</span>:</span><br>            self.wrapped = cls(*args)<br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getattr__</span><span class="hljs-params">(self, name)</span>:</span><br>            <span class="hljs-keyword">return</span> getattr(self.wrapped, name)<br>    <span class="hljs-keyword">return</span> Wrapper<br><br><span class="hljs-meta">@decorator</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, x, y)</span>:</span><br>        self.attr = <span class="hljs-string">'spam'</span><br><br>x = C(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>)<br>print(x.attr)<br></code></pre></td></tr></table></figure><h2 id="Decorator-参数"><a href="#Decorator-参数" class="headerlink" title="Decorator 参数"></a>Decorator 参数</h2><figure class="hljs highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span><span class="hljs-params">(A, B)</span>:</span><br>    <span class="hljs-comment"># save or use A, B</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">actualDecorator</span><span class="hljs-params">(F)</span>:</span><br>        <span class="hljs-comment"># Save or use function F</span><br>        <span class="hljs-comment"># Return a callable: nested def, class with __call__, etc.</span><br>        <span class="hljs-keyword">return</span> callable<br>    <span class="hljs-keyword">return</span> actualDecorator<br></code></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zsh与oh-my-zsh</title>
      <link href="/2013/09/15/zsh%E4%B8%8Eoh-my-zsh/"/>
      <url>/2013/09/15/zsh%E4%B8%8Eoh-my-zsh/</url>
      <content type="html"><![CDATA[<p>zsh 介绍  <a href="http://foocoder.com/blog/wo-zai-yong-de-macruan-jian-2.html/" target="_blank" rel="noopener">http://foocoder.com/blog/wo-zai-yong-de-macruan-jian-2.html/</a></p><h2 id="安装-zsh-与-oh-my-zsh"><a href="#安装-zsh-与-oh-my-zsh" class="headerlink" title="安装 zsh 与 oh-my-zsh"></a>安装 zsh 与 oh-my-zsh</h2><pre><code>brew install zshcurl -L https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh | sh</code></pre><p>修改/etc/shells，添加/usr/local/bin/zsh</p><p>更改默认 shell 为 zsh</p><pre><code>chsh -s /usr/local/bin/zsh</code></pre><h2 id="配置-iTerm2-的主题与字体"><a href="#配置-iTerm2-的主题与字体" class="headerlink" title="配置 iTerm2 的主题与字体"></a>配置 iTerm2 的主题与字体</h2><p>iTerm2 主页<a href="http://www.iterm2.com/" target="_blank" rel="noopener">http://www.iterm2.com/</a></p><p>iTerm2 Solarized主题<a href="https://github.com/altercation/solarized/tree/master/iterm2-colors-solarized" target="_blank" rel="noopener">https://github.com/altercation/solarized/tree/master/iterm2-colors-solarized</a></p><p>在此我们使用 Solarized Dark主题，OMZ 里有一个与之配合的主题agnoster，修改~/.zshrc</p><pre><code>export ZSH_THEME=&quot;agnoster&quot;DEFAULT_USER=&quot;xilaideng&quot;</code></pre><p>zsh powerline 主题</p><p><a href="https://github.com/jeremyFreeAgent/oh-my-zsh-powerline-theme" target="_blank" rel="noopener">https://github.com/jeremyFreeAgent/oh-my-zsh-powerline-theme</a></p><p><a href="https://github.com/milkbikis/powerline-shell" target="_blank" rel="noopener">https://github.com/milkbikis/powerline-shell</a></p><p>zsh主题列表<a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes" target="_blank" rel="noopener">https://github.com/robbyrussell/oh-my-zsh/wiki/themes</a></p><p>下载 zsh agnoster theme 所需要的字体</p><p><a href="https://gist.github.com/qrush/1595572/raw/417a3fa36e35ca91d6d23ac961071094c26e5fad/Menlo-Powerline.otf" target="_blank" rel="noopener">https://gist.github.com/qrush/1595572/raw/417a3fa36e35ca91d6d23ac961071094c26e5fad/Menlo-Powerline.otf</a></p><p><a href="https://github.com/Lokaltog/powerline-fonts" target="_blank" rel="noopener">https://github.com/Lokaltog/powerline-fonts</a></p>]]></content>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
  
  
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
  
</search>
